<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="MUSST – A modern Fortran MUltiScale Simulation Tribology solver">
    
    <meta name="author" content="Noël Brunetière - Arthur Francisco" >
    <link rel="icon" href="../favicon.png">

    <title>mod_ms_film.f90 &ndash; MUSST</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    
    <link href="../css/user.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">MUSST </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>mod_ms_film.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     <li><i class="fa fa-pencil"></i> Noël Brunetiere, Arthur Francisco</li>
     
     
    <li><i class="fa fa-calendar-o"></i> February, 15 2017</li>
     
     
     
    <li><i class="fa fa-barcode"></i> 1.0.0</li>
    
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 4.9% of total for source files.">470 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/mod_ms_film.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">mod_ms_film.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/ms_film.html">ms_film</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_ms_film.f90.html#src">mod_ms_film.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~mod_ms_film.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemod_ms_filmf90EfferentGraph" width="641pt" height="440pt"
 viewBox="0.00 0.00 641.00 440.24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph" class="graph" transform="scale(0.974164 0.974164) rotate(0) translate(4 447.919)">
<title>sourcefile~~mod_ms_film.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-447.919 654,-447.919 654,4 -4,4"/>
<!-- sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node1" class="node"><title>sourcefile~mod_ms_film.f90</title>
<polygon fill="none" stroke="black" points="650,-115 556,-115 556,-91 650,-91 650,-115"/>
<text text-anchor="middle" x="603" y="-100.6" font-family="Helvetica,sans-Serif" font-size="10.50">mod_ms_film.f90</text>
</g>
<!-- sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node2" class="node"><title>sourcefile~mod_mesh.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mod_mesh.f90.html" xlink:title="mod_mesh.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="383,-392 299,-392 299,-368 383,-368 383,-392"/>
<text text-anchor="middle" x="341" y="-377.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_mesh.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_mesh.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-380C447.951,-390.038 417.981,-390.771 393.032,-388.668"/>
<polygon fill="#ff0000" stroke="#ff0000" points="393.333,-385.181 383.031,-387.654 392.627,-392.145 393.333,-385.181"/>
</g>
<!-- sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node3" class="node"><title>sourcefile~mod_solver.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mod_solver.f90.html" xlink:title="mod_solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-308 298,-308 298,-284 384,-284 384,-308"/>
<text text-anchor="middle" x="341" y="-293.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-380C426.893,-398.476 379.446,-347.09 356.364,-316.658"/>
<polygon fill="#ff0000" stroke="#ff0000" points="359.003,-314.338 350.265,-308.346 353.359,-318.479 359.003,-314.338"/>
</g>
<!-- sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node4" class="node"><title>sourcefile~mod_film.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/mod_film.f90.html" xlink:title="mod_film.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="511,-166 437,-166 437,-142 511,-142 511,-166"/>
<text text-anchor="middle" x="474" y="-151.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_film.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M571.903,-115.086C554.788,-121.959 533.147,-130.649 514.661,-138.073"/>
<polygon fill="#ff0000" stroke="#ff0000" points="513.297,-134.849 505.321,-141.824 515.905,-141.345 513.297,-134.849"/>
</g>
<!-- sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node5" class="node"><title>sourcefile~mod_surfile.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/mod_surfile.f90.html" xlink:title="mod_surfile.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-228 298,-228 298,-204 384,-204 384,-228"/>
<text text-anchor="middle" x="341" y="-213.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_surfile.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge4" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M601.581,-115.324C599.178,-163.252 583.037,-336.707 475,-380"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-380C418.29,-401.923 429.062,-320.827 392,-275 381.266,-261.727 368.861,-247.085 359.092,-235.708"/>
<polygon fill="#ff0000" stroke="#ff0000" points="361.687,-233.357 352.507,-228.067 356.384,-237.927 361.687,-233.357"/>
</g>
<!-- sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node6" class="node"><title>sourcefile~mod_fluid.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/mod_fluid.f90.html" xlink:title="mod_fluid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="236.5,-106 159.5,-106 159.5,-82 236.5,-82 236.5,-106"/>
<text text-anchor="middle" x="198" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_fluid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge5" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M579.872,-90.9931C555.151,-78.3336 513.53,-59.2399 475,-52"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-52C392.541,-36.8814 368.143,-6.58988 290,-31 262.574,-39.5672 236.14,-59.6204 218.896,-74.8186"/>
<polygon fill="#ff0000" stroke="#ff0000" points="216.246,-72.4987 211.206,-81.8179 220.957,-77.6757 216.246,-72.4987"/>
</g>
<!-- sourcefile~mod_bspline.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node7" class="node"><title>sourcefile~mod_bspline.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/mod_bspline.f90.html" xlink:title="mod_bspline.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="519.5,-24 428.5,-24 428.5,-0 519.5,-0 519.5,-24"/>
<text text-anchor="middle" x="474" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_bspline.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_bspline.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge6" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_bspline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M587.968,-90.8341C572.013,-77.252 544.938,-54.9549 520,-38 515.635,-35.0323 510.915,-32.0633 506.23,-29.2484"/>
<polygon fill="#ff0000" stroke="#ff0000" points="507.767,-26.0924 497.367,-24.0664 504.233,-32.1353 507.767,-26.0924"/>
</g>
<!-- sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node8" class="node"><title>sourcefile~mod_num_par.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/mod_num_par.f90.html" xlink:title="mod_num_par.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="391,-64 291,-64 291,-40 391,-40 391,-64"/>
<text text-anchor="middle" x="341" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_num_par.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge7" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_num_par.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-52C449.837,-47.6476 423.961,-46.8189 401.363,-47.3743"/>
<polygon fill="#ff0000" stroke="#ff0000" points="401.108,-43.8808 391.233,-47.7192 401.346,-50.8768 401.108,-43.8808"/>
</g>
<!-- sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node9" class="node"><title>sourcefile~mod_data.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/mod_data.f90.html" xlink:title="mod_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="380.5,-106 301.5,-106 301.5,-82 380.5,-82 380.5,-106"/>
<text text-anchor="middle" x="341" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge8" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-52C463.962,-50.3017 418.381,-65.8496 383.5,-78.5065"/>
<polygon fill="#ff0000" stroke="#ff0000" points="382.177,-75.2638 373.985,-81.983 384.579,-81.8387 382.177,-75.2638"/>
</g>
<!-- sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node10" class="node"><title>sourcefile~mod_data_arch.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/mod_data_arch.f90.html" xlink:title="mod_data_arch.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-186 7.10543e-15,-186 7.10543e-15,-162 106,-162 106,-186"/>
<text text-anchor="middle" x="53" y="-171.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_data_arch.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge9" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M473,-380C358.762,-425.778 309.837,-473.488 199,-420"/>
</g>
<!-- sourcefile~mod_mesh.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge10" class="edge"><title>sourcefile~mod_mesh.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M313.503,-392C278.584,-407.048 219.224,-429.759 199,-420"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M197,-420C173.708,-408.76 160.624,-418.944 142,-401 82.3716,-343.55 62.4713,-241.099 56.4139,-196.161"/>
<polygon fill="#ff0000" stroke="#ff0000" points="59.8625,-195.53 55.1563,-186.037 52.9158,-196.393 59.8625,-195.53"/>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge16" class="edge"><title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M297.684,-285.154C248.171,-272.156 169.461,-250.451 142,-237 117.493,-224.996 92.4698,-206.336 75.4035,-192.435"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="77.6322,-189.736 67.7018,-186.043 73.1618,-195.123 77.6322,-189.736"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node11" class="node"><title>sourcefile~mod_sort_arrays.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/mod_sort_arrays.f90.html" xlink:title="mod_sort_arrays.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-186 142,-186 142,-162 254,-162 254,-186"/>
<text text-anchor="middle" x="198" y="-171.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_sort_arrays.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge11" class="edge"><title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M329.623,-283.735C307.005,-257.009 255.176,-195.831 254,-195 251.882,-193.503 249.643,-192.097 247.329,-190.778"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="248.623,-187.511 238.121,-186.116 245.461,-193.756 248.623,-187.511"/>
</g>
<!-- sourcefile~mod_gen_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node12" class="node"><title>sourcefile~mod_gen_par.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/mod_gen_par.f90.html" xlink:title="mod_gen_par.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="246.5,-228 149.5,-228 149.5,-204 246.5,-204 246.5,-228"/>
<text text-anchor="middle" x="198" y="-213.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_gen_par.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_gen_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge12" class="edge"><title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_gen_par.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M322.254,-283.985C305.121,-272.595 278.275,-255.298 254,-242 248.025,-238.727 241.57,-235.453 235.255,-232.386"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="236.71,-229.202 226.177,-228.065 233.702,-235.523 236.71,-229.202"/>
</g>
<!-- sourcefile~superlu.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node13" class="node"><title>sourcefile~superlu.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/superlu.f90.html" xlink:title="superlu.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="231,-392 165,-392 165,-368 231,-368 231,-392"/>
<text text-anchor="middle" x="198" y="-377.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">superlu.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~superlu.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge13" class="edge"><title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~superlu.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M325.888,-308.191C309.473,-321.915 281.147,-344.223 254,-359 249.736,-361.321 245.161,-363.504 240.536,-365.52"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="238.979,-362.376 231.06,-369.414 241.64,-368.85 238.979,-362.376"/>
</g>
<!-- sourcefile~umfpack.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node14" class="node"><title>sourcefile~umfpack.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/umfpack.f90.html" xlink:title="umfpack.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="233.5,-350 162.5,-350 162.5,-326 233.5,-326 233.5,-350"/>
<text text-anchor="middle" x="198" y="-335.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">umfpack.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~umfpack.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge14" class="edge"><title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~umfpack.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M299.595,-308.036C282.018,-313.271 261.367,-319.423 243.365,-324.785"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="242.258,-321.463 233.673,-327.672 244.256,-328.171 242.258,-321.463"/>
</g>
<!-- sourcefile~dmumps_struc.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node16" class="node"><title>sourcefile~dmumps_struc.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/dmumps_struc.f90.html" xlink:title="dmumps_struc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="248.5,-308 147.5,-308 147.5,-284 248.5,-284 248.5,-308"/>
<text text-anchor="middle" x="198" y="-293.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dmumps_struc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~dmumps_struc.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge15" class="edge"><title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~dmumps_struc.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M297.695,-296C285.534,-296 272.032,-296 259.018,-296"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="258.721,-292.5 248.721,-296 258.721,-299.5 258.721,-292.5"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge18" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_mesh.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M467.933,-166.329C456.267,-194.175 425.893,-263.657 392,-317 382.387,-332.13 369.842,-347.928 359.722,-359.92"/>
<polygon fill="#aaff00" stroke="#aaff00" points="357.024,-357.689 353.17,-367.558 362.338,-362.247 357.024,-357.689"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge17" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_solver.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M461.831,-166.107C439.208,-190.629 387.787,-246.368 360.235,-276.234"/>
<polygon fill="#aaff00" stroke="#aaff00" points="357.349,-274.201 353.141,-283.924 362.494,-278.947 357.349,-274.201"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge19" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M450.169,-166.102C434.057,-174.508 411.885,-185.805 392,-195 388.448,-196.642 384.732,-198.305 380.998,-199.938"/>
<polygon fill="#aaff00" stroke="#aaff00" points="379.568,-196.743 371.763,-203.908 382.333,-203.173 379.568,-196.743"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge20" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M436.879,-148.338C410.583,-144.253 374.103,-138.659 342,-134"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M340,-134C306.359,-129.118 269.431,-118.438 241.808,-109.342"/>
<polygon fill="#aaff00" stroke="#aaff00" points="242.669,-105.939 232.075,-106.075 240.442,-112.575 242.669,-105.939"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge21" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_num_par.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M463.444,-141.812C449.378,-124.543 421.55,-92.8503 392,-73 389.734,-71.4775 387.339,-70.0304 384.874,-68.6613"/>
<polygon fill="#aaff00" stroke="#aaff00" points="386.251,-65.4353 375.747,-64.0487 383.093,-71.6829 386.251,-65.4353"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge23" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M446.49,-141.858C426.692,-132.79 399.422,-120.3 377.705,-110.353"/>
<polygon fill="#aaff00" stroke="#aaff00" points="379.02,-107.106 368.47,-106.124 376.105,-113.47 379.02,-107.106"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge24" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M340,-134C277.983,-125 261.541,-130.03 199,-134"/>
</g>
<!-- sourcefile~mod_elements.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node15" class="node"><title>sourcefile~mod_elements.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/mod_elements.f90.html" xlink:title="mod_elements.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="391.5,-186 290.5,-186 290.5,-162 391.5,-162 391.5,-186"/>
<text text-anchor="middle" x="341" y="-171.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_elements.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_elements.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge22" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_elements.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M436.857,-159.518C425.97,-161.18 413.719,-163.05 401.729,-164.881"/>
<polygon fill="#aaff00" stroke="#aaff00" points="401.11,-161.435 391.753,-166.404 402.167,-168.355 401.11,-161.435"/>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge25" class="edge"><title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M305.242,-203.898C299.909,-201.346 294.641,-198.383 290,-195 270.133,-180.518 274.327,-166.829 254,-153 232.617,-138.453 224.81,-132.362 199,-134"/>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge26" class="edge"><title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M299.595,-203.964C283.96,-199.307 265.895,-193.926 249.424,-189.02"/>
<polygon fill="#00ff00" stroke="#00ff00" points="249.994,-185.538 239.411,-186.037 247.996,-192.246 249.994,-185.538"/>
</g>
<!-- sourcefile~mod_fluid.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge27" class="edge"><title>sourcefile~mod_fluid.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M169.853,-106.119C160.881,-110.312 150.918,-115.175 142,-120 121.057,-131.332 98.1533,-145.444 80.9629,-156.4"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="79.0598,-153.462 72.5349,-161.81 82.841,-159.353 79.0598,-153.462"/>
</g>
<!-- sourcefile~mod_num_par.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge28" class="edge"><title>sourcefile~mod_num_par.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M290.764,-47.5387C248.869,-45.9262 188.302,-48.9024 142,-73 107.214,-91.1041 80.0751,-129.177 65.6008,-153.058"/>
<polygon fill="#0000ff" stroke="#0000ff" points="62.5507,-151.341 60.5179,-161.739 68.5913,-154.878 62.5507,-151.341"/>
</g>
<!-- sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge30" class="edge"><title>sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M301.471,-94C284.567,-94 264.552,-94 246.717,-94"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="246.508,-90.5001 236.508,-94 246.508,-97.5001 246.508,-90.5001"/>
</g>
<!-- sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge29" class="edge"><title>sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M311.204,-106.081C283.148,-116.906 238.996,-131.461 199,-134"/>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M197,-134C160.753,-136.301 121.091,-148.184 92.7509,-158.406"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="91.3856,-155.179 83.2232,-161.934 93.8163,-161.744 91.3856,-155.179"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge31" class="edge"><title>sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M141.712,-174C133.443,-174 124.868,-174 116.462,-174"/>
<polygon fill="#ff0000" stroke="#ff0000" points="116.325,-170.5 106.325,-174 116.325,-177.5 116.325,-170.5"/>
</g>
<!-- sourcefile~mod_gen_par.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge32" class="edge"><title>sourcefile~mod_gen_par.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M156.022,-203.964C140.016,-199.263 121.498,-193.825 104.667,-188.881"/>
<polygon fill="#ffff00" stroke="#ffff00" points="105.565,-185.497 94.984,-186.037 103.592,-192.214 105.565,-185.497"/>
</g>
<!-- sourcefile~mod_elements.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge33" class="edge"><title>sourcefile~mod_elements.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M316.101,-161.882C288.49,-149.15 241.408,-131.308 199,-134"/>
</g>
</g>
</svg>
</div><script>var pansourcefilemod_ms_filmf90EfferentGraph = svgPanZoom('#sourcefilemod_ms_filmf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~mod_ms_film.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemod_ms_filmf90AfferentGraph" width="480pt" height="52pt"
 viewBox="0.00 0.00 480.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~mod_ms_film.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-48 476,-48 476,4 -4,4"/>
<!-- sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node1" class="node"><title>sourcefile~mod_ms_film.f90</title>
<polygon fill="none" stroke="black" points="94,-44 -7.10543e-15,-44 -7.10543e-15,-20 94,-20 94,-44"/>
<text text-anchor="middle" x="47" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">mod_ms_film.f90</text>
</g>
<!-- sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node2" class="node"><title>sourcefile~mod_test_musst.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/mod_test_musst.f90.html" xlink:title="mod_test_musst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="381.5,-44 272.5,-44 272.5,-20 381.5,-20 381.5,-44"/>
<text text-anchor="middle" x="327" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_test_musst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M272.223,-32.6952C260.297,-32.8221 247.719,-32.9349 236,-33 188.89,-33.2617 177.11,-33.2872 130,-33 121.802,-32.95 113.142,-32.8719 104.644,-32.7809"/>
<polygon fill="#ff0000" stroke="#ff0000" points="104.44,-29.2784 94.4006,-32.6644 104.36,-36.278 104.44,-29.2784"/>
</g>
<!-- sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node3" class="node"><title>sourcefile~mod_inout_files.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/mod_inout_files.f90.html" xlink:title="mod_inout_files.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="236,-24 130,-24 130,-0 236,-0 236,-24"/>
<text text-anchor="middle" x="183" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_inout_files.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge4" class="edge"><title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M272.316,-24.4389C263.848,-23.2463 255.031,-22.0044 246.386,-20.7868"/>
<polygon fill="#00ffff" stroke="#00ffff" points="246.74,-17.3021 236.349,-19.3731 245.763,-24.2337 246.74,-17.3021"/>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M129.808,-19.7898C121.449,-21.0374 112.767,-22.3333 104.316,-23.5946"/>
<polygon fill="#ff0000" stroke="#ff0000" points="103.536,-20.1722 94.1621,-25.1101 104.569,-27.0955 103.536,-20.1722"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node4" class="node"><title>sourcefile~main.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="472,-44 418,-44 418,-20 472,-20 472,-44"/>
<text text-anchor="middle" x="445" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M417.967,-32C410.119,-32 401.134,-32 391.948,-32"/>
<polygon fill="#ff0000" stroke="#ff0000" points="391.946,-28.5001 381.946,-32 391.946,-35.5001 391.946,-28.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/ms_film.html">ms_film</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_ms_film.f90.html#src">mod_ms_film.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!! author: Noël Brunetiere, Arthur Francisco</span>
<a name="ln-2"></a><span class="c">!! version: 1.0.0</span>
<a name="ln-3"></a><span class="c">!! date: February, 15 2017</span>
<a name="ln-4"></a><span class="c">!! summary: Creation and resolution of multi-scale FE film</span>
<a name="ln-5"></a>
<a name="ln-6"></a><span class="c">!&lt; &lt;span style=&quot;color: #337ab7; font-family: cabin; font-size: 1.5em;&quot;&gt;</span>
<a name="ln-7"></a><span class="c">!&lt;       **MultiScale FE solution of the Reynolds equation**</span>
<a name="ln-8"></a><span class="c">!&lt; &lt;/span&gt;</span>
<a name="ln-9"></a>
<a name="ln-10"></a><span class="c">!&lt;# Description of the film module</span>
<a name="ln-11"></a><span class="c">!&lt; This module can be used for a two-scale solution of the lubrication problems (more particularly for rough surface problems)</span>
<a name="ln-12"></a><span class="c">!</span>
<a name="ln-13"></a>   <span class="c">!&lt;## Definition of MS_FE_film</span>
<a name="ln-14"></a>      <span class="c">!&lt; [[MS_FE_FILM]] is a data structure containing a [[FE_FILM]] which is the Top Scale or macro-scale of the problem and a table of [[FE_FILM]] which is the Bottom Scale or micro-scale</span>
<a name="ln-15"></a>   <span class="c">!&lt;## Solution procedure</span>
<a name="ln-16"></a>      <span class="c">!&lt; This module can be used to create a [[MS_FE_FILM]], assemble the [[MS_FE_FILM]], and solve it. Some post-treatements like fluxes, forces are available.</span>
<a name="ln-17"></a>
<a name="ln-18"></a><span class="k">module </span><span class="n">ms_film</span>
<a name="ln-19"></a><span class="k">use </span><span class="n">data_arch</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">I4</span><span class="p">,</span> <span class="n">R8</span><span class="p">,</span> <span class="n">NB_THREADS_MAX</span>
<a name="ln-20"></a><span class="k">use </span><span class="n">film</span>
<a name="ln-21"></a><span class="k">use </span><span class="n">mesh</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">MAX_NNC</span><span class="p">,</span> <span class="n">MAX_NBS</span>
<a name="ln-22"></a><span class="k">use </span><span class="n">solver</span>
<a name="ln-23"></a><span class="k">use </span><span class="n">omp_lib</span>
<a name="ln-24"></a><span class="k">use </span><span class="n">bspline</span>
<a name="ln-25"></a><span class="k">use </span><span class="n">surfile</span>
<a name="ln-26"></a><span class="k">use </span><span class="n">data_film_hd</span>
<a name="ln-27"></a><span class="k">use </span><span class="n">num_param</span>
<a name="ln-28"></a><span class="k">use </span><span class="n">fluid_law</span>
<a name="ln-29"></a><span class="k">implicit none</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="k">private</span>
<a name="ln-32"></a>
<a name="ln-33"></a><span class="c">! multi scale fe fluid film type</span>
<a name="ln-34"></a><span class="k">type </span><span class="n">MS_FE_FILM</span>
<a name="ln-35"></a><span class="c">!! &lt;span style=&quot;color:green&quot;&gt;</span>
<a name="ln-36"></a><span class="c">!!   *MS_FE_FILM* is the top-scale [[FE_FILM]] plus all of the bottom-scale [[FE_FILM]]</span>
<a name="ln-37"></a><span class="c">!! &lt;/span&gt;</span>
<a name="ln-38"></a>   <span class="k">type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ts_fe_f</span>                              <span class="c">!! *top-scale fe_film*</span>
<a name="ln-39"></a>   <span class="k">type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bs_fe_f</span>   <span class="c">!! *bottom-scale fe_film*</span>
<a name="ln-40"></a>
<a name="ln-41"></a>   <span class="k">contains</span>
<a name="ln-42"></a><span class="k">      procedure</span> <span class="kd">::</span> <span class="n">ms_fx</span> <span class="c">!! *force computation along \(x\)*</span>
<a name="ln-43"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">ms_fy</span> <span class="c">!! *force computation along \(y\)*</span>
<a name="ln-44"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">ms_fz</span> <span class="c">!! *force computation along \(z\)*</span>
<a name="ln-45"></a><span class="n">endtype</span> <span class="n">ms_fe_film</span>
<a name="ln-46"></a>
<a name="ln-47"></a><span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal_tmp</span> <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-48"></a>
<a name="ln-49"></a><span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">SMOOTH_MS</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!! *at the end of the iterative process, the pressure field can be smoothed*</span>
<a name="ln-50"></a>
<a name="ln-51"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">MS_FE_FILM</span><span class="p">,</span> <span class="n">multi_scale_create_rect_fe_film</span><span class="p">,</span> <span class="n">multi_scale_solve_fe_film</span><span class="p">,</span> <span class="n">save_ms_field</span><span class="p">,</span> <span class="n">ms_fe_f_2_mat</span>
<a name="ln-52"></a>
<a name="ln-53"></a><span class="k">contains</span>
<a name="ln-54"></a>
<a name="ln-55"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-56"></a>   <span class="c">!&lt; @note Subroutine to create a [[MS_FE_FILM]]</span>
<a name="ln-57"></a>   <span class="c">!  @endnote</span>
<a name="ln-58"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-59"></a>   <span class="k">subroutine </span><span class="n">multi_scale_create_rect_fe_film</span><span class="p">(</span><span class="n">data_f</span><span class="p">,</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">,</span> <span class="n">num_pts</span><span class="p">,</span> <span class="n">num_pbs</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-60"></a>   <span class="k">implicit none</span>
<a name="ln-61"></a><span class="k">   type</span><span class="p">(</span><span class="n">DATA_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">data_f</span>     <span class="c">!! *data of the film*</span>
<a name="ln-62"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">bs_nx</span>      <span class="c">!! *number of nodes in \(x\) direction for the bottom scale*</span>
<a name="ln-63"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">bs_ny</span>      <span class="c">!! *number of nodes in \(y\) direction for the bottom scale*</span>
<a name="ln-64"></a>   <span class="k">type</span><span class="p">(</span><span class="n">NUM_PAR</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">num_pts</span>    <span class="c">!! *numerical parameters for iterative solution, top scale*</span>
<a name="ln-65"></a>   <span class="k">type</span><span class="p">(</span><span class="n">NUM_PAR</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">num_pbs</span>    <span class="c">!! *numerical parameters for iterative solution, bottom scale*</span>
<a name="ln-66"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>    <span class="c">!! *MS FE film*</span>
<a name="ln-67"></a>
<a name="ln-68"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i3</span>
<a name="ln-69"></a>
<a name="ln-70"></a>      <span class="c">! creation of the top scale fe film</span>
<a name="ln-71"></a>      <span class="k">call </span><span class="n">create_rect_FE_film</span><span class="p">(</span><span class="n">data_f</span> <span class="o">=</span> <span class="n">data_f</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-72"></a>                                <span class="n">num_p</span> <span class="o">=</span> <span class="n">num_pts</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-73"></a>                                 <span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">)</span>
<a name="ln-74"></a>
<a name="ln-75"></a>      <span class="c">! allocation of the bottom scale table</span>
<a name="ln-76"></a>      <span class="n">ne</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-77"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">ne</span><span class="p">))</span>
<a name="ln-78"></a>
<a name="ln-79"></a>      <span class="c">! creation of the bottom scale fe_film</span>
<a name="ln-80"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-81"></a>         <span class="n">i1</span>    <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-82"></a>         <span class="n">i3</span>    <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-83"></a>
<a name="ln-84"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">=</span> <span class="n">bs_nx</span>
<a name="ln-85"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">=</span> <span class="n">bs_ny</span>
<a name="ln-86"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-87"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zy</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-88"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">lx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zx</span>
<a name="ln-89"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ly</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">i3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zy</span>
<a name="ln-90"></a>         <span class="k">call </span><span class="n">create_rect_FE_film</span><span class="p">(</span><span class="n">data_f</span> <span class="o">=</span> <span class="n">data_f</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-91"></a>                                   <span class="n">num_p</span> <span class="o">=</span> <span class="n">num_pbs</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-92"></a>                                    <span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-93"></a>      <span class="n">enddo</span>
<a name="ln-94"></a>   <span class="k">return</span>
<a name="ln-95"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">multi_scale_create_rect_fe_film</span>
<a name="ln-96"></a>
<a name="ln-97"></a>
<a name="ln-98"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-99"></a>   <span class="c">!&lt; @note Subroutine to solve a [[MS_FE_FILM]]</span>
<a name="ln-100"></a>   <span class="c">!  @endnote</span>
<a name="ln-101"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-102"></a>   <span class="k">subroutine </span><span class="n">multi_scale_solve_fe_film</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">ms_mat</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-103"></a>   <span class="k">implicit none</span>
<a name="ln-104"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">ms_fe_f</span>   <span class="c">!! *multi-scale FE film*</span>
<a name="ln-105"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MS_MAT_SOLV</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">ms_mat</span>    <span class="c">!! *multi-scale solver matrices*</span>
<a name="ln-106"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>        <span class="c">!! *boundary conditions at the corners*</span>
<a name="ln-107"></a>
<a name="ln-108"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">decomp</span>
<a name="ln-109"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">fluid</span>
<a name="ln-110"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">conv</span><span class="p">,</span> <span class="n">ts_init</span>
<a name="ln-111"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">error</span><span class="p">,</span> <span class="n">relax</span>
<a name="ln-112"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ass_c</span>
<a name="ln-113"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compt</span>
<a name="ln-114"></a>
<a name="ln-115"></a>      <span class="n">relax</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">relax</span>
<a name="ln-116"></a>      <span class="n">fluid</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span>
<a name="ln-117"></a>
<a name="ln-118"></a>      <span class="n">VERBOSE</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">VERBOSE</span><span class="o">/</span><span class="mi">1</span><span class="mf">0.</span><span class="p">)</span>
<a name="ln-119"></a>
<a name="ln-120"></a>      <span class="c">! open mp instructions (parallele computation)</span>
<a name="ln-121"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nb_threads_max&#39;</span><span class="p">,</span> <span class="n">NB_THREADS_MAX</span>
<a name="ln-122"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">NB_THREADS_MAX</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">NB_THREADS_MAX</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-123"></a>
<a name="ln-124"></a>      <span class="c">!$ call omp_set_num_threads(NB_THREADS_MAX)</span>
<a name="ln-125"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nb_threads_used&#39;</span><span class="p">,</span> <span class="n">NB_THREADS_MAX</span>
<a name="ln-126"></a>
<a name="ln-127"></a>
<a name="ln-128"></a>      <span class="c">! check of matrices allocation</span>
<a name="ln-129"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span><span class="p">))</span>
<a name="ln-130"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(:)%</span><span class="n">slv_t</span> <span class="o">=</span> <span class="n">SOLVER_BS</span>
<a name="ln-131"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(:)%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-132"></a>
<a name="ln-133"></a>      <span class="c">! solution parameters</span>
<a name="ln-134"></a>      <span class="n">ass_c</span>  <span class="o">=</span> <span class="n">ASS</span>
<a name="ln-135"></a>      <span class="n">decomp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span>
<a name="ln-136"></a>
<a name="ln-137"></a>      <span class="c">! update fluid properties</span>
<a name="ln-138"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-139"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-140"></a>                                                                      <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-141"></a>
<a name="ln-142"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-143"></a>                                                                            <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-144"></a>      <span class="n">enddo</span>
<a name="ln-145"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;fluid properties updated&#39;</span>
<a name="ln-146"></a>
<a name="ln-147"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">slv_t</span> <span class="o">=</span> <span class="n">SOLVER_TS</span>
<a name="ln-148"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-149"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nn</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-150"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">ne</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-151"></a>
<a name="ln-152"></a>      <span class="c">! matrices allocation</span>
<a name="ln-153"></a>      <span class="n">compt</span><span class="p">(:)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-154"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-155"></a>         <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_n</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>       <span class="c">! for each element, the number of lines is added</span>
<a name="ln-156"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-157"></a>            <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>   <span class="c">! &quot; &quot;, for each node, the number of contributions is added</span>
<a name="ln-158"></a>         <span class="n">enddo</span>
<a name="ln-159"></a>      <span class="n">enddo</span>
<a name="ln-160"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nvar</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-161"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nt</span>   <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-162"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">eltvar</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nvar</span>  <span class="p">)</span> <span class="p">)</span>
<a name="ln-163"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">a_elt</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nt</span>    <span class="p">)</span> <span class="p">)</span>
<a name="ln-164"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">ne</span> <span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-165"></a>
<a name="ln-166"></a>      <span class="c">! check of precomputed tables allocation</span>
<a name="ln-167"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">))</span> <span class="k">call </span><span class="n">init_prc_tab</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">)</span>
<a name="ln-168"></a>
<a name="ln-169"></a>      <span class="c">! convergence is false at zero iteration</span>
<a name="ln-170"></a>      <span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-171"></a>      <span class="n">it</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-172"></a>
<a name="ln-173"></a>      <span class="n">ts_init</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-174"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ts_init</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-175"></a><span class="k">         call </span><span class="n">solve_FE_film</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-176"></a>                             <span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-177"></a>                              <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-178"></a>                        <span class="n">flag_ass</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-179"></a>      <span class="k">else</span>
<a name="ln-180"></a>         <span class="c">! apply boundary conditions</span>
<a name="ln-181"></a>         <span class="k">call </span><span class="n">apply_bc_FE_film_simple</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-182"></a>                                        <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-183"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;bc applied&#39;</span>
<a name="ln-184"></a>         <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-185"></a>                        <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;ini&#39;</span><span class="p">)</span>
<a name="ln-186"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;TS solver initialized&#39;</span>
<a name="ln-187"></a>      <span class="n">endif</span>
<a name="ln-188"></a>
<a name="ln-189"></a>      <span class="k">if</span> <span class="p">(</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(:)%</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_NBS</span> <span class="p">)</span> <span class="k">stop</span> <span class="s1">&#39;MAX_NBS under estimated&#39;</span>
<a name="ln-190"></a>
<a name="ln-191"></a>      <span class="c">! solution loop</span>
<a name="ln-192"></a>      <span class="k">do</span>
<a name="ln-193"></a><span class="k">         if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;loop MS *******************&quot;</span><span class="p">,</span> <span class="n">it</span>
<a name="ln-194"></a>
<a name="ln-195"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">conv</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-196"></a><span class="k">            do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-197"></a>               <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-198"></a>                              <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a name="ln-199"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Matrix BS released, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-200"></a>            <span class="n">enddo</span>
<a name="ln-201"></a>            <span class="k">exit</span>
<a name="ln-202"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-203"></a>
<a name="ln-204"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">SMOOTH_MS</span><span class="p">)</span> <span class="k">call </span><span class="n">smooth_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">P_N</span><span class="p">,</span> <span class="n">nodal</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-205"></a>
<a name="ln-206"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">BC_SPLINE</span><span class="p">)</span> <span class="k">call </span><span class="n">interp_ts_bs_splin</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-207"></a>
<a name="ln-208"></a>         <span class="c">! assembly of the system</span>
<a name="ln-209"></a>         <span class="k">call </span><span class="n">multi_scale_assembly_fe_film_reynolds</span><span class="p">(</span><span class="n">ms_fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-210"></a>                                                    <span class="n">ms_mat</span>  <span class="o">=</span> <span class="n">ms_mat</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-211"></a>                                                      <span class="n">ass_c</span> <span class="o">=</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-212"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ms reynolds assembled&#39;</span>
<a name="ln-213"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ass_c&#39;</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span>
<a name="ln-214"></a>
<a name="ln-215"></a><span class="c">!~          if (ass_c == ASS) then</span>
<a name="ln-216"></a>            <span class="c">! some stuff can be saved here, provided the reloading of jptr, irow, ... (instead of convert_matrice_format)</span>
<a name="ln-217"></a>            <span class="k">call </span><span class="n">convert_matrice_format</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">)</span>
<a name="ln-218"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS formated, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-219"></a><span class="c">!~          endif</span>
<a name="ln-220"></a>
<a name="ln-221"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">            call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-223"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;ana&#39;</span><span class="p">)</span>
<a name="ln-224"></a>            <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-225"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS analyzed, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-226"></a>         <span class="n">endif</span>
<a name="ln-227"></a>
<a name="ln-228"></a>         <span class="c">! solution of the system</span>
<a name="ln-229"></a><span class="c">!~          if (ass_c == ASS) then</span>
<a name="ln-230"></a>            <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-231"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;fac&#39;</span><span class="p">)</span>
<a name="ln-232"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS factorized, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-233"></a><span class="c">!~          endif</span>
<a name="ln-234"></a>         <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-235"></a>                        <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;sol&#39;</span><span class="p">)</span>
<a name="ln-236"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;System TS solved, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-237"></a>
<a name="ln-238"></a>         <span class="c">!if (ass_c == ASS) then</span>
<a name="ln-239"></a>            <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-240"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;fre&#39;</span><span class="p">)</span>
<a name="ln-241"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix factors freed, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-242"></a>         <span class="c">!endif</span>
<a name="ln-243"></a>
<a name="ln-244"></a>         <span class="c">! error computation</span>
<a name="ln-245"></a>         <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<a name="ln-246"></a>         <span class="n">it</span> <span class="o">=</span> <span class="n">it</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-247"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Iteration &#39;</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="s1">&#39;error TS&#39;</span><span class="p">,</span> <span class="n">error</span>
<a name="ln-248"></a>
<a name="ln-249"></a>         <span class="c">! convergence check</span>
<a name="ln-250"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">eps</span><span class="p">)</span> <span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-251"></a>
<a name="ln-252"></a>         <span class="c">! update of variables</span>
<a name="ln-253"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">fluid</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-254"></a><span class="k">            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-255"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-256"></a><span class="k">                  </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">*</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">relax</span>
<a name="ln-257"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-258"></a><span class="k">                      </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span><span class="o">/</span><span class="mi">100</span>
<a name="ln-259"></a>                  <span class="k">else</span>
<a name="ln-260"></a><span class="k">                      </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">pres</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-261"></a>                                                                                     <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-262"></a>                  <span class="n">endif</span>
<a name="ln-263"></a>               <span class="k">else</span>
<a name="ln-264"></a><span class="k">                  </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">relax</span>
<a name="ln-265"></a>               <span class="n">endif</span>
<a name="ln-266"></a>            <span class="n">enddo</span>
<a name="ln-267"></a>         <span class="k">else</span>
<a name="ln-268"></a><span class="k">            </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span> <span class="o">*</span> <span class="n">relax</span>
<a name="ln-269"></a>         <span class="n">endif</span>
<a name="ln-270"></a>
<a name="ln-271"></a>         <span class="c">! check pressure</span>
<a name="ln-272"></a>         <span class="k">if</span> <span class="p">(</span> <span class="n">fluid</span> <span class="o">==</span> <span class="n">GP</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-273"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0._R8</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;MS p negative&#39;</span>
<a name="ln-274"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0._R8</span><span class="p">)</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span> <span class="o">/</span> <span class="mf">1.e2_R8</span>
<a name="ln-275"></a>         <span class="n">endif</span>
<a name="ln-276"></a>
<a name="ln-277"></a>         <span class="c">! update fluid properties</span>
<a name="ln-278"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-279"></a>            <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-280"></a>                                                                          <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-281"></a>
<a name="ln-282"></a>            <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-283"></a>                                                                                <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-284"></a>         <span class="n">enddo</span>
<a name="ln-285"></a>
<a name="ln-286"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">&gt;=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">it_max</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-287"></a><span class="k">            </span><span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-288"></a>            <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;maximum number of iteration reached before convergence&#39;</span>
<a name="ln-289"></a>         <span class="n">endif</span>
<a name="ln-290"></a>
<a name="ln-291"></a>
<a name="ln-292"></a>      <span class="n">enddo</span>
<a name="ln-293"></a>
<a name="ln-294"></a>      <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-295"></a>                     <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a name="ln-296"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS released, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-297"></a>
<a name="ln-298"></a>   <span class="k">return</span>
<a name="ln-299"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">multi_scale_solve_fe_film</span>
<a name="ln-300"></a>
<a name="ln-301"></a>
<a name="ln-302"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-303"></a>   <span class="c">!&lt; @note Subroutine to interpolate the top-scale nodes for the bottom-scale boundaries</span>
<a name="ln-304"></a>   <span class="c">!  @endnote</span>
<a name="ln-305"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-306"></a>   <span class="k">subroutine </span><span class="n">interp_ts_bs_splin</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-307"></a>   <span class="k">implicit none</span>
<a name="ln-308"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-309"></a>
<a name="ln-310"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">inbvx</span><span class="p">,</span> <span class="n">inbvy</span><span class="p">,</span> <span class="n">iloy</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ed</span><span class="p">,</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">,</span> <span class="n">n_edg</span><span class="p">,</span> <span class="n">n_nod</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">node_number</span>
<a name="ln-311"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">val</span>
<a name="ln-312"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">log_press</span>
<a name="ln-313"></a>
<a name="ln-314"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">coeff</span>
<a name="ln-315"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tx</span> <span class="c">! x knots</span>
<a name="ln-316"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ty</span> <span class="c">! y knots</span>
<a name="ln-317"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span>  <span class="n">x</span>
<a name="ln-318"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span>  <span class="n">y</span>
<a name="ln-319"></a>
<a name="ln-320"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">deg</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-321"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mixture</span>
<a name="ln-322"></a>
<a name="ln-323"></a>      <span class="n">mixture</span> <span class="o">=</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span>
<a name="ln-324"></a>
<a name="ln-325"></a>      <span class="n">ts_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span>
<a name="ln-326"></a>      <span class="n">ts_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span>
<a name="ln-327"></a>
<a name="ln-328"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-329"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_nx</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>  <span class="p">&amp;</span>
<a name="ln-330"></a>                <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_ny</span> <span class="o">+</span><span class="n">deg</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-331"></a>      <span class="k">allocate</span><span class="p">(</span>  <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span> <span class="n">ts_nx</span>    <span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-332"></a>                 <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span> <span class="n">ts_ny</span>    <span class="p">)</span> <span class="p">)</span>
<a name="ln-333"></a>
<a name="ln-334"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">log_press</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-335"></a>      <span class="n">log_press</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-336"></a>
<a name="ln-337"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="n">log_press</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">log_press</span><span class="p">)</span>
<a name="ln-338"></a>
<a name="ln-339"></a>      <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span>
<a name="ln-340"></a>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-341"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span><span class="o">*</span><span class="p">(</span><span class="n">ts_ny</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span>
<a name="ln-342"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-343"></a>         <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-344"></a>      <span class="n">enddo</span>
<a name="ln-345"></a>
<a name="ln-346"></a>      <span class="n">iflag</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-347"></a>      <span class="k">call </span><span class="n">db2ink</span><span class="p">(</span>   <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">),</span>                    <span class="p">&amp;</span> <span class="c">! Array of x abcissae. Must be strictly increasing.</span>
<a name="ln-348"></a>                    <span class="n">nx</span> <span class="o">=</span> <span class="n">ts_nx</span><span class="p">,</span>                         <span class="p">&amp;</span> <span class="c">! Number of x abcissae</span>
<a name="ln-349"></a>                     <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>                    <span class="p">&amp;</span> <span class="c">! Array of y abcissae. Must be strictly increasing.</span>
<a name="ln-350"></a>                    <span class="n">ny</span> <span class="o">=</span> <span class="n">ts_ny</span><span class="p">,</span>                         <span class="p">&amp;</span> <span class="c">! Number of y abcissae</span>
<a name="ln-351"></a>                   <span class="n">fcn</span> <span class="o">=</span> <span class="n">log_press</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>   <span class="p">&amp;</span> <span class="c">! Array of function values to interpolate. fcn(i,j) should</span>
<a name="ln-352"></a>                                                          <span class="c">!    contain the function value at the point (x(i),y(j))</span>
<a name="ln-353"></a>                    <span class="n">kx</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                           <span class="p">&amp;</span> <span class="c">! The order of spline pieces in x (&gt;= 2, &lt; nx). (order = polynomial degree + 1)</span>
<a name="ln-354"></a>                    <span class="n">ky</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                           <span class="p">&amp;</span> <span class="c">! The order of spline pieces in y (&gt;= 2, &lt; ny). (order = polynomial degree + 1)</span>
<a name="ln-355"></a>                    <span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_nx</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>            <span class="p">&amp;</span> <span class="c">! The knots in the x direction for the spline interpolant.</span>
<a name="ln-356"></a>                                                          <span class="c">!    If iflag=0 these are chosen by [[db2ink]].</span>
<a name="ln-357"></a>                                                          <span class="c">!    If iflag=1 these are specified by the user.</span>
<a name="ln-358"></a>                                                          <span class="c">!    Must be non-decreasing.</span>
<a name="ln-359"></a>                    <span class="n">ty</span> <span class="o">=</span> <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_ny</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>            <span class="p">&amp;</span> <span class="c">! The knots in the y direction for the spline interpolant.</span>
<a name="ln-360"></a>                                                          <span class="c">!    If iflag=0 these are chosen by [[db2ink]].</span>
<a name="ln-361"></a>                                                          <span class="c">!    If iflag=1 these are specified by the user.</span>
<a name="ln-362"></a>                                                          <span class="c">!    Must be non-decreasing.</span>
<a name="ln-363"></a>                 <span class="n">bcoef</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>       <span class="p">&amp;</span> <span class="c">! Array of coefficients of the b-spline interpolant.</span>
<a name="ln-364"></a>                 <span class="n">iflag</span> <span class="o">=</span> <span class="n">iflag</span><span class="p">)</span>                           <span class="c">! **on input:**  0 = knot sequence chosen by [[db2ink]].</span>
<a name="ln-365"></a>                                                          <span class="c">!                1 = knot sequence chosen by user.</span>
<a name="ln-366"></a>                                                          <span class="c">! **on output:** 1 = successful execution.</span>
<a name="ln-367"></a>                                                          <span class="c">!                2 = iflag out of range.</span>
<a name="ln-368"></a>                                                          <span class="c">!                3 = nx out of range.</span>
<a name="ln-369"></a>                                                          <span class="c">!                4 = kx out of range.</span>
<a name="ln-370"></a>                                                          <span class="c">!                5 = x not strictly increasing.</span>
<a name="ln-371"></a>                                                          <span class="c">!                6 = tx not non-decreasing.</span>
<a name="ln-372"></a>                                                          <span class="c">!                7 = ny out of range.</span>
<a name="ln-373"></a>                                                          <span class="c">!                8 = ky out of range.</span>
<a name="ln-374"></a>                                                          <span class="c">!                9 = y not strictly increasing.</span>
<a name="ln-375"></a>                                                          <span class="c">!               10 = ty not non-decreasing.</span>
<a name="ln-376"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="n">error</span> <span class="k">stop</span> <span class="s1">&#39;error calling db2ink&#39;</span>
<a name="ln-377"></a>
<a name="ln-378"></a>      <span class="n">inbvx</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-379"></a>      <span class="n">inbvy</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-380"></a>      <span class="n">iloy</span>  <span class="o">=</span> <span class="mi">1</span>
<a name="ln-381"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-382"></a>         <span class="n">bs_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span>
<a name="ln-383"></a>         <span class="n">bs_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span>
<a name="ln-384"></a>         <span class="n">n_edg</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ned</span>
<a name="ln-385"></a>         <span class="k">do </span><span class="n">ed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_edg</span>
<a name="ln-386"></a>            <span class="n">n_nod</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">ed</span><span class="p">)%</span><span class="n">n</span>
<a name="ln-387"></a>            <span class="k">do </span><span class="n">nn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_nod</span>
<a name="ln-388"></a>               <span class="n">node_number</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">ed</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
<a name="ln-389"></a>               <span class="n">x_n</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">node_number</span><span class="p">)</span>
<a name="ln-390"></a>               <span class="n">y_n</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">node_number</span><span class="p">)</span>
<a name="ln-391"></a>
<a name="ln-392"></a>               <span class="k">call </span><span class="n">db2val</span><span class="p">(</span><span class="n">xval</span> <span class="o">=</span> <span class="n">x_n</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! xval     !! x coordinate of evaluation point.</span>
<a name="ln-393"></a>                           <span class="n">yval</span> <span class="o">=</span> <span class="n">y_n</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! yval     !! y coordinate of evaluation point.</span>
<a name="ln-394"></a>                            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>                        <span class="p">&amp;</span>  <span class="c">! idx      !! x derivative of piecewise polynomial to evaluate.</span>
<a name="ln-395"></a>                            <span class="n">idy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>                        <span class="p">&amp;</span>  <span class="c">! idy      !! y derivative of piecewise polynomial to evaluate.</span>
<a name="ln-396"></a>                             <span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_nx</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>       <span class="p">&amp;</span>  <span class="c">! tx       !! sequence of knots defining the piecewise polynomial in the x direction. (same as in last call to [[db2ink]])</span>
<a name="ln-397"></a>                             <span class="n">ty</span> <span class="o">=</span> <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_ny</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>       <span class="p">&amp;</span>  <span class="c">! ty       !! sequence of knots defining the piecewise polynomial in the y direction. (same as in last call to [[db2ink]])</span>
<a name="ln-398"></a>                             <span class="n">nx</span> <span class="o">=</span> <span class="n">ts_nx</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! nx       !! the number of interpolation points in x. (same as in last call to [[db2ink]])</span>
<a name="ln-399"></a>                             <span class="n">ny</span> <span class="o">=</span> <span class="n">ts_ny</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! ny       !! the number of interpolation points in y. (same as in last call to [[db2ink]])</span>
<a name="ln-400"></a>                             <span class="n">kx</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! kx       !! order of polynomial pieces in x. (same as in last call to [[db2ink]])</span>
<a name="ln-401"></a>                             <span class="n">ky</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! ky       !! order of polynomial pieces in y. (same as in last call to [[db2ink]])</span>
<a name="ln-402"></a>                          <span class="n">bcoef</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>  <span class="p">&amp;</span>  <span class="c">! bcoef    !! the b-spline coefficients computed by [[db2ink]].</span>
<a name="ln-403"></a>                              <span class="n">f</span> <span class="o">=</span> <span class="n">val</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! f        !! interpolated value &amp;</span>
<a name="ln-404"></a>                          <span class="n">iflag</span> <span class="o">=</span> <span class="n">iflag</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! iflag    !! status flag: 0 : no errors, /=0 : error</span>
<a name="ln-405"></a>                          <span class="n">inbvx</span> <span class="o">=</span> <span class="n">inbvx</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! inbvx    !! initialization parameter which must be set to 1 the first time this routine is called, and must not be changed by the user.</span>
<a name="ln-406"></a>                          <span class="n">inbvy</span> <span class="o">=</span> <span class="n">inbvy</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! inbvy    !! initialization parameter which must be set to 1 the first time this routine is called, and must not be changed by the user.</span>
<a name="ln-407"></a>                           <span class="n">iloy</span> <span class="o">=</span> <span class="n">iloy</span><span class="p">)</span>                        <span class="c">! iloy     !! initialization parameter which must be set to 1 the first time this routine is called, and must not be changed by the user.</span>
<a name="ln-408"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="n">error</span> <span class="k">stop</span> <span class="s1">&#39;error&#39;</span>
<a name="ln-409"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="n">val</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-410"></a>
<a name="ln-411"></a>               <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">vn</span><span class="p">(</span><span class="n">node_number</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-412"></a>               <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">bc</span><span class="p">(</span><span class="n">node_number</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-413"></a>            <span class="n">enddo</span>
<a name="ln-414"></a>         <span class="n">enddo</span>
<a name="ln-415"></a>      <span class="n">enddo</span>
<a name="ln-416"></a>
<a name="ln-417"></a>      <span class="k">deallocate</span><span class="p">(</span> <span class="n">log_press</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
<a name="ln-418"></a>
<a name="ln-419"></a>   <span class="k">return</span>
<a name="ln-420"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">interp_ts_bs_splin</span>
<a name="ln-421"></a>
<a name="ln-422"></a>
<a name="ln-423"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-424"></a>   <span class="c">!&lt; @note Subroutine to save the information controlled by *code* of the whole mesh.</span>
<a name="ln-425"></a>   <span class="c">!</span>
<a name="ln-426"></a>   <span class="c">!        The genertaed file is a ```.sur``` file.</span>
<a name="ln-427"></a>   <span class="c">!  @endnote</span>
<a name="ln-428"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-429"></a>   <span class="k">subroutine </span><span class="n">save_ms_field</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">)</span>
<a name="ln-430"></a>   <span class="k">implicit none</span>
<a name="ln-431"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-432"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">file_name</span>    <span class="c">!! *filename like &quot;./out/pressure.sur&quot;*</span>
<a name="ln-433"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">code</span>         <span class="c">!! *saved information like P_N*</span>
<a name="ln-434"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nodal</span>        <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-435"></a>
<a name="ln-436"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span>
<a name="ln-437"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_z</span><span class="p">,</span> <span class="n">string</span>
<a name="ln-438"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-439"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">mat</span>
<a name="ln-440"></a>
<a name="ln-441"></a>      <span class="k">call </span><span class="n">ms_fe_f_2_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-442"></a>
<a name="ln-443"></a>      <span class="n">nnx</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-444"></a>      <span class="n">nny</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-445"></a>
<a name="ln-446"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">unit_z</span><span class="p">)</span>
<a name="ln-447"></a>
<a name="ln-448"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-449"></a><span class="k">         </span><span class="n">string</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
<a name="ln-450"></a>      <span class="k">else</span>
<a name="ln-451"></a><span class="k">         </span><span class="n">string</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
<a name="ln-452"></a>      <span class="n">endif</span>
<a name="ln-453"></a>
<a name="ln-454"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-455"></a>      <span class="n">i2</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-456"></a>      <span class="n">unit_z</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">i1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">i2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-457"></a>
<a name="ln-458"></a>      <span class="k">call </span><span class="n">init_scal</span><span class="p">(</span><span class="n">scal</span> <span class="o">=</span> <span class="n">scal_tmp</span><span class="p">,</span>                   <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-459"></a>                       <span class="n">nx</span> <span class="o">=</span> <span class="n">nnx</span><span class="p">,</span>                        <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-460"></a>                       <span class="n">ny</span> <span class="o">=</span> <span class="n">nny</span><span class="p">,</span>                        <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-461"></a>                       <span class="n">lx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">lx</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">! default unit : m</span>
<a name="ln-462"></a>                       <span class="n">ly</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ly</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-463"></a>                   <span class="n">unit_z</span> <span class="o">=</span> <span class="n">unit_z</span>                      <span class="p">)</span> <span class="c">!</span>
<a name="ln-464"></a>
<a name="ln-465"></a>      <span class="k">call </span><span class="n">write_surf</span><span class="p">(</span><span class="n">nom_fic</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span>  <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-466"></a>                        <span class="n">tab_s</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>        <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-467"></a>                         <span class="n">scal</span> <span class="o">=</span> <span class="n">scal_tmp</span>    <span class="p">)</span>
<a name="ln-468"></a>
<a name="ln-469"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="ln-470"></a>
<a name="ln-471"></a>   <span class="k">return</span>
<a name="ln-472"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">save_ms_field</span>
<a name="ln-473"></a>
<a name="ln-474"></a>
<a name="ln-475"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-476"></a>   <span class="c">!&lt; @note Subroutine to transform a MS_FE_FILM information into a matrix</span>
<a name="ln-477"></a>   <span class="c">!  @endnote</span>
<a name="ln-478"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-479"></a>   <span class="k">subroutine </span><span class="n">ms_fe_f_2_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-480"></a>   <span class="k">implicit none</span>
<a name="ln-481"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>              <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-482"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>              <span class="kd">::</span> <span class="n">code</span>        <span class="c">!! *saved information like P_N*</span>
<a name="ln-483"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>              <span class="kd">::</span> <span class="n">nodal</span>       <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-484"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">mat</span><span class="p">(:,:)</span>    <span class="c">!! *output matrix containing the information*</span>
<a name="ln-485"></a>
<a name="ln-486"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ne_x</span><span class="p">,</span> <span class="n">ne_y</span><span class="p">,</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span><span class="p">,</span> <span class="n">c</span>
<a name="ln-487"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span>
<a name="ln-488"></a>
<a name="ln-489"></a>      <span class="n">ts_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-490"></a>      <span class="n">ts_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-491"></a>
<a name="ln-492"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">),</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">))</span>
<a name="ln-493"></a>
<a name="ln-494"></a>      <span class="n">bs_nx</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-495"></a>      <span class="n">bs_ny</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-496"></a>
<a name="ln-497"></a>      <span class="n">nnx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_nx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-498"></a>      <span class="n">nny</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_ny</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-499"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-500"></a><span class="k">         </span><span class="n">nnx</span> <span class="o">=</span> <span class="n">nnx</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-501"></a>         <span class="n">nny</span> <span class="o">=</span> <span class="n">nny</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-502"></a>      <span class="n">endif</span>
<a name="ln-503"></a>
<a name="ln-504"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nnx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nny</span><span class="p">)</span> <span class="p">)</span> <span class="p">;</span> <span class="n">mat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<a name="ln-505"></a>
<a name="ln-506"></a>      <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-507"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-508"></a>      <span class="k">do </span><span class="n">ey</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_ny</span>
<a name="ln-509"></a>      <span class="k">do </span><span class="n">ex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span>
<a name="ln-510"></a>         <span class="n">e</span>    <span class="o">=</span> <span class="n">ts_nx</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">ex</span>
<a name="ln-511"></a>         <span class="n">ne_x</span> <span class="o">=</span> <span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ex</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-512"></a>         <span class="n">ne_y</span> <span class="o">=</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-513"></a>         <span class="n">mat</span><span class="p">(</span> <span class="n">ne_x</span><span class="p">:(</span> <span class="n">ne_x</span> <span class="o">+</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-514"></a>              <span class="n">ne_y</span><span class="p">:(</span> <span class="n">ne_y</span> <span class="o">+</span><span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">code</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-515"></a>      <span class="n">enddo</span>
<a name="ln-516"></a>      <span class="n">enddo</span>
<a name="ln-517"></a>
<a name="ln-518"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">)</span>
<a name="ln-519"></a>   <span class="k">return</span>
<a name="ln-520"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">ms_fe_f_2_mat</span>
<a name="ln-521"></a>
<a name="ln-522"></a>
<a name="ln-523"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-524"></a>   <span class="c">!&lt; @note Subroutine to transform a matrix into a MS_FE_FILM</span>
<a name="ln-525"></a>   <span class="c">!  @endnote</span>
<a name="ln-526"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-527"></a>   <span class="k">subroutine </span><span class="n">mat_2_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-528"></a>   <span class="k">implicit none</span>
<a name="ln-529"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-530"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                 <span class="kd">::</span> <span class="n">code</span>     <span class="c">!! *saved information like P_N*</span>
<a name="ln-531"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                 <span class="kd">::</span> <span class="n">nodal</span>    <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-532"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">mat</span>      <span class="c">!! *input matrix containing the information*</span>
<a name="ln-533"></a>
<a name="ln-534"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ne_x</span><span class="p">,</span> <span class="n">ne_y</span><span class="p">,</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span><span class="p">,</span> <span class="n">c</span>
<a name="ln-535"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span>
<a name="ln-536"></a>
<a name="ln-537"></a>      <span class="n">ts_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-538"></a>      <span class="n">ts_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-539"></a>
<a name="ln-540"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">),</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">))</span>
<a name="ln-541"></a>
<a name="ln-542"></a>      <span class="n">bs_nx</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-543"></a>      <span class="n">bs_ny</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-544"></a>
<a name="ln-545"></a>      <span class="n">nnx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_nx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-546"></a>      <span class="n">nny</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_ny</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-547"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-548"></a><span class="k">         </span><span class="n">nnx</span> <span class="o">=</span> <span class="n">nnx</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-549"></a>         <span class="n">nny</span> <span class="o">=</span> <span class="n">nny</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-550"></a>      <span class="n">endif</span>
<a name="ln-551"></a>
<a name="ln-552"></a>      <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-553"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-554"></a>      <span class="k">do </span><span class="n">ey</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_ny</span>
<a name="ln-555"></a>      <span class="k">do </span><span class="n">ex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span>
<a name="ln-556"></a>         <span class="n">e</span>    <span class="o">=</span> <span class="n">ts_nx</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">ex</span>
<a name="ln-557"></a>         <span class="n">ne_x</span> <span class="o">=</span> <span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ex</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-558"></a>         <span class="n">ne_y</span> <span class="o">=</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-559"></a>
<a name="ln-560"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">code</span><span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">mat</span><span class="p">(</span> <span class="n">ne_x</span><span class="p">:(</span> <span class="n">ne_x</span> <span class="o">+</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-561"></a>                                                        <span class="n">ne_y</span><span class="p">:(</span> <span class="n">ne_y</span> <span class="o">+</span><span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-562"></a>      <span class="n">enddo</span>
<a name="ln-563"></a>      <span class="n">enddo</span>
<a name="ln-564"></a>
<a name="ln-565"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">)</span>
<a name="ln-566"></a>   <span class="k">return</span>
<a name="ln-567"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">mat_2_ms_fe_f</span>
<a name="ln-568"></a>
<a name="ln-569"></a>
<a name="ln-570"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-571"></a>   <span class="c">!&lt; @note Subroutine to smooth a MS_FE_FILM field, the pressure for instance.</span>
<a name="ln-572"></a>   <span class="c">!</span>
<a name="ln-573"></a>   <span class="c">!        By default, the smoothing kernel is a 5x5 Gaussian filter</span>
<a name="ln-574"></a>   <span class="c">!  @endnote</span>
<a name="ln-575"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-576"></a>   <span class="k">subroutine </span><span class="n">smooth_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">)</span>
<a name="ln-577"></a>   <span class="k">implicit none</span>
<a name="ln-578"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-579"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">code</span>      <span class="c">!! *saved information like P_N*</span>
<a name="ln-580"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">nodal</span>     <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-581"></a>
<a name="ln-582"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-583"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">mat</span>
<a name="ln-584"></a>
<a name="ln-585"></a>      <span class="k">call </span><span class="n">ms_fe_f_2_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-586"></a>      <span class="n">nx</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-587"></a>
<a name="ln-588"></a>      <span class="k">call </span><span class="n">smooth_mat</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-589"></a>
<a name="ln-590"></a>      <span class="k">call </span><span class="n">mat_2_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-591"></a>
<a name="ln-592"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="ln-593"></a>   <span class="k">return</span>
<a name="ln-594"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">smooth_ms_fe_f</span>
<a name="ln-595"></a>
<a name="ln-596"></a>
<a name="ln-597"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-598"></a>   <span class="c">!&lt; @note Subroutine to smooth a matrix form field, the pressure for instance.</span>
<a name="ln-599"></a>   <span class="c">!  @endnote</span>
<a name="ln-600"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-601"></a>   <span class="k">subroutine </span><span class="n">smooth_mat</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<a name="ln-602"></a>   <span class="k">implicit none</span>
<a name="ln-603"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nx</span>    <span class="c">!! *matrix x size*</span>
<a name="ln-604"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ny</span>    <span class="c">!! *matrix y size*</span>
<a name="ln-605"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">s</span>     <span class="c">!! *kernel size*</span>
<a name="ln-606"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mat</span>   <span class="c">!! *matrix*</span>
<a name="ln-607"></a>
<a name="ln-608"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">kernel3</span>
<a name="ln-609"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="kd">::</span> <span class="n">kernel5</span>
<a name="ln-610"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mi_mat</span>
<a name="ln-611"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">mat_tmp</span>
<a name="ln-612"></a>
<a name="ln-613"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-614"></a>
<a name="ln-615"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">mat_tmp</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-616"></a>
<a name="ln-617"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-618"></a><span class="k">         </span><span class="n">kernel3</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">((</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-619"></a>                                       <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-620"></a>                                       <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">/</span><span class="p">))</span>
<a name="ln-621"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-622"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-623"></a>            <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-624"></a>            <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">kernel3</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="mf">6.</span>
<a name="ln-625"></a>         <span class="n">enddo</span>
<a name="ln-626"></a>         <span class="n">enddo</span>
<a name="ln-627"></a>
<a name="ln-628"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-629"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-630"></a>            <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-631"></a>         <span class="n">enddo</span>
<a name="ln-632"></a>         <span class="n">enddo</span>
<a name="ln-633"></a>
<a name="ln-634"></a>      <span class="n">endif</span>
<a name="ln-635"></a>
<a name="ln-636"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mi">5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-637"></a><span class="k">         </span><span class="n">kernel5</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">((</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-638"></a>                                        <span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-639"></a>                                        <span class="mi">6</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-640"></a>                                        <span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-641"></a>                                        <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="o">/</span><span class="p">))</span>
<a name="ln-642"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-643"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-644"></a>            <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-645"></a>            <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">kernel5</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mi">25</span><span class="mf">6.</span>
<a name="ln-646"></a>         <span class="n">enddo</span>
<a name="ln-647"></a>         <span class="n">enddo</span>
<a name="ln-648"></a>
<a name="ln-649"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-650"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-651"></a>            <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-652"></a>         <span class="n">enddo</span>
<a name="ln-653"></a>         <span class="n">enddo</span>
<a name="ln-654"></a>
<a name="ln-655"></a>      <span class="n">endif</span>
<a name="ln-656"></a>
<a name="ln-657"></a>
<a name="ln-658"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">mat_tmp</span><span class="p">)</span>
<a name="ln-659"></a>
<a name="ln-660"></a>   <span class="k">return</span>
<a name="ln-661"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">smooth_mat</span>
<a name="ln-662"></a>
<a name="ln-663"></a>
<a name="ln-664"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-665"></a>   <span class="c">!&lt; @note Subroutine to assemble the top-scale system, all of the bottom-scale systems being solved.</span>
<a name="ln-666"></a>   <span class="c">!  @endnote</span>
<a name="ln-667"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-668"></a>   <span class="k">subroutine </span><span class="n">multi_scale_assembly_fe_film_reynolds</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">ms_mat</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-669"></a>   <span class="k">implicit none</span>
<a name="ln-670"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>     <span class="c">!!</span>
<a name="ln-671"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MS_MAT_SOLV</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_mat</span>      <span class="c">!! *solver type matrices table*</span>
<a name="ln-672"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">ass_c</span>       <span class="c">!! *assembly type*</span>
<a name="ln-673"></a>
<a name="ln-674"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ke_ij</span>
<a name="ln-675"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(:,:)</span>  <span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span>  <span class="n">be_i</span>
<a name="ln-676"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:)</span>  <span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ind_e</span>
<a name="ln-677"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">compt</span>
<a name="ln-678"></a>
<a name="ln-679"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-680"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">val_t</span>
<a name="ln-681"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">first_assembly</span>
<a name="ln-682"></a>
<a name="ln-683"></a>      <span class="n">ne</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-684"></a>
<a name="ln-685"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-686"></a>      <span class="k">allocate</span><span class="p">(</span>  <span class="n">be_i</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-687"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ind_e</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-688"></a>
<a name="ln-689"></a>      <span class="c">! assembly</span>
<a name="ln-690"></a>      <span class="n">compt</span><span class="p">(:)</span>        <span class="o">=</span> <span class="mi">1</span>
<a name="ln-691"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">b</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-692"></a>
<a name="ln-693"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-694"></a><span class="k">         allocate</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">(</span><span class="n">ne</span><span class="p">))</span>
<a name="ln-695"></a>         <span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-696"></a>      <span class="n">endif</span>
<a name="ln-697"></a>
<a name="ln-698"></a>      <span class="c">! check for first assembly: save the assembly location in ass_loc_in_mat</span>
<a name="ln-699"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-700"></a><span class="k">         </span><span class="n">first_assembly</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-701"></a>         <span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-702"></a>      <span class="k">else</span>
<a name="ln-703"></a><span class="k">         </span><span class="n">first_assembly</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-704"></a>      <span class="n">endif</span>
<a name="ln-705"></a>
<a name="ln-706"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-707"></a>         <span class="c">! copy of the boundary conditions</span>
<a name="ln-708"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-709"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-710"></a>            <span class="n">be_i</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span>
<a name="ln-711"></a>         <span class="n">enddo</span>
<a name="ln-712"></a>      <span class="n">enddo</span>
<a name="ln-713"></a>
<a name="ln-714"></a>      <span class="c">! elementary matrices calculation</span>
<a name="ln-715"></a>      <span class="c">!-------------------------------------------</span>
<a name="ln-716"></a>      <span class="c">!open mp instructions (parallele computation)</span>
<a name="ln-717"></a>      <span class="c">!$omp parallel</span>
<a name="ln-718"></a>      <span class="c">!$omp do schedule(runtime)</span>
<a name="ln-719"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-720"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;MS elements &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s1">&#39; thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-721"></a>
<a name="ln-722"></a>         <span class="k">call </span><span class="n">elementary_full_domain_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-723"></a>                                                       <span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>   <span class="p">&amp;</span>
<a name="ln-724"></a>                                                     <span class="n">ke_ij</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:),</span>     <span class="p">&amp;</span>
<a name="ln-725"></a>                                                      <span class="n">be_i</span> <span class="o">=</span> <span class="n">be_i</span><span class="p">(</span> <span class="n">e</span><span class="p">,</span> <span class="p">:),</span>        <span class="p">&amp;</span>
<a name="ln-726"></a>                                                     <span class="n">ind_e</span> <span class="o">=</span> <span class="n">ind_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:))</span>
<a name="ln-727"></a>      <span class="n">enddo</span>
<a name="ln-728"></a>      <span class="c">!$OMP end do</span>
<a name="ln-729"></a>      <span class="c">!$OMP end parallel</span>
<a name="ln-730"></a>      <span class="c">!end open mp instructions</span>
<a name="ln-731"></a>      <span class="c">!-------------------------------------------</span>
<a name="ln-732"></a>
<a name="ln-733"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-734"></a>         <span class="c">! consideration of the bc condition</span>
<a name="ln-735"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-736"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-737"></a>            <span class="n">ind_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ii</span>
<a name="ln-738"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">bc</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-739"></a><span class="k">               </span><span class="n">val_t</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-740"></a>               <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-741"></a>               <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">val_t</span>
<a name="ln-742"></a>               <span class="n">be_i</span><span class="p">(</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-743"></a>            <span class="n">endif</span>
<a name="ln-744"></a>         <span class="n">enddo</span>
<a name="ln-745"></a>         <span class="c">! copy of the rhs member</span>
<a name="ln-746"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-747"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-748"></a>            <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">+</span> <span class="n">be_i</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-749"></a>         <span class="n">enddo</span>
<a name="ln-750"></a>      <span class="n">enddo</span>
<a name="ln-751"></a>
<a name="ln-752"></a>      <span class="c">! assembly of the elemental matrix in the solver matrix</span>
<a name="ln-753"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-754"></a>
<a name="ln-755"></a><span class="k">         do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-756"></a>
<a name="ln-757"></a>            <span class="k">call </span><span class="n">assemble_in_mat_sol</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-758"></a>                                     <span class="n">num</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-759"></a>                                    <span class="n">nelt</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-760"></a>                                   <span class="n">nline</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-761"></a>                                    <span class="n">tind</span> <span class="o">=</span> <span class="n">ind_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:),</span>        <span class="p">&amp;</span>
<a name="ln-762"></a>                                   <span class="n">m_elt</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:),</span>     <span class="p">&amp;</span>
<a name="ln-763"></a>                                   <span class="n">compt</span> <span class="o">=</span> <span class="n">compt</span><span class="p">)</span>
<a name="ln-764"></a>         <span class="n">enddo</span>
<a name="ln-765"></a>         <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-766"></a>
<a name="ln-767"></a>      <span class="n">endif</span>
<a name="ln-768"></a>
<a name="ln-769"></a>      <span class="k">deallocate</span><span class="p">(</span> <span class="n">ke_ij</span><span class="p">,</span> <span class="n">be_i</span><span class="p">,</span> <span class="n">ind_e</span> <span class="p">)</span>
<a name="ln-770"></a>
<a name="ln-771"></a>   <span class="k">return</span>
<a name="ln-772"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">multi_scale_assembly_fe_film_reynolds</span>
<a name="ln-773"></a>
<a name="ln-774"></a>
<a name="ln-775"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-776"></a>   <span class="c">!&lt; @note Function to calculate the generated load in a fluid MS film</span>
<a name="ln-777"></a>   <span class="c">!        \( \int_\Omega p d\Omega \)</span>
<a name="ln-778"></a>   <span class="c">!  @endnote</span>
<a name="ln-779"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-780"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">ms_fz</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-781"></a>   <span class="k">implicit none</span>
<a name="ln-782"></a><span class="k">   class</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span> <span class="c">!! *MS FE film*</span>
<a name="ln-783"></a>
<a name="ln-784"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-785"></a>      <span class="n">ms_fz</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-786"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-787"></a>          <span class="n">ms_fz</span> <span class="o">=</span> <span class="n">ms_fz</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">fz</span><span class="p">()</span>
<a name="ln-788"></a>      <span class="n">enddo</span>
<a name="ln-789"></a>   <span class="k">return</span>
<a name="ln-790"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">ms_fz</span>
<a name="ln-791"></a>
<a name="ln-792"></a>
<a name="ln-793"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-794"></a>   <span class="c">!&lt; @note Function to calculate the friction force along \(x\) in a fluid MS film</span>
<a name="ln-795"></a>   <span class="c">!        \( \int_\Omega \tau_{xz} d\Omega \)</span>
<a name="ln-796"></a>   <span class="c">!  @endnote</span>
<a name="ln-797"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-798"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">ms_fx</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-799"></a>   <span class="k">implicit none</span>
<a name="ln-800"></a><span class="k">   class</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-801"></a>
<a name="ln-802"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-803"></a>      <span class="n">ms_fx</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-804"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-805"></a>         <span class="n">ms_fx</span> <span class="o">=</span> <span class="n">ms_fx</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">fx</span><span class="p">()</span>
<a name="ln-806"></a>      <span class="n">enddo</span>
<a name="ln-807"></a>   <span class="k">return</span>
<a name="ln-808"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">ms_fx</span>
<a name="ln-809"></a>
<a name="ln-810"></a>
<a name="ln-811"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-812"></a>   <span class="c">!&lt; @note Function to calculate the friction force along \(y\) in a fluid MS film</span>
<a name="ln-813"></a>   <span class="c">!        \( \int_\Omega \tau_{yz} d\Omega \)</span>
<a name="ln-814"></a>   <span class="c">!  @endnote</span>
<a name="ln-815"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-816"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">ms_fy</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-817"></a>   <span class="k">implicit none</span>
<a name="ln-818"></a><span class="k">   class</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-819"></a>
<a name="ln-820"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-821"></a>      <span class="n">ms_fy</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-822"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-823"></a>         <span class="n">ms_fy</span> <span class="o">=</span> <span class="n">ms_fy</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">fy</span><span class="p">()</span>
<a name="ln-824"></a>      <span class="n">enddo</span>
<a name="ln-825"></a>   <span class="k">return</span>
<a name="ln-826"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">ms_fy</span>
<a name="ln-827"></a>
<a name="ln-828"></a><span class="n">endmodule</span> <span class="n">ms_film</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-04-16 16:00  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> MUSST was developed by Noël Brunetière - Arthur Francisco</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>