<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="MUSST – A modern Fortran MUltiScale Simulation Tribology solver">
    
    <meta name="author" content="Noël Brunetière - Arthur Francisco" >
    <link rel="icon" href="../favicon.png">

    <title>mod_ms_film.f90 &ndash; MUSST</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    
    <link href="../css/user.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">MUSST </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>mod_ms_film.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     <li><i class="fa fa-pencil"></i> Noël Brunetiere, Arthur Francisco</li>
     
     
    <li><i class="fa fa-calendar-o"></i> February, 15 2017</li>
     
     
     
    <li><i class="fa fa-barcode"></i> 1.0.0</li>
    
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 4.9% of total for source files.">469 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/mod_ms_film.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">mod_ms_film.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/ms_film.html">ms_film</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_ms_film.f90.html#src">mod_ms_film.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~mod_ms_film.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemod_ms_filmf90EfferentGraph" width="641pt" height="522pt"
 viewBox="0.00 0.00 641.00 522.03" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph" class="graph" transform="scale(.9938 .9938) rotate(0) translate(4 521.2856)">
<title>sourcefile~~mod_ms_film.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-521.2856 641,-521.2856 641,4 -4,4"/>
<!-- sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~mod_ms_film.f90</title>
<polygon fill="none" stroke="#000000" points="637,-232 546,-232 546,-208 637,-208 637,-232"/>
<text text-anchor="middle" x="591.5" y="-217.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">mod_ms_film.f90</text>
</g>
<!-- sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~mod_fluid.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mod_fluid.f90.html" xlink:title="mod_fluid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="232.5,-353 157.5,-353 157.5,-329 232.5,-329 232.5,-353"/>
<text text-anchor="middle" x="195" y="-338.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_fluid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-422C395.2907,-460.8131 361.311,-430.6416 286,-403 259.6273,-393.3204 233.5463,-374.3236 216.1124,-359.896"/>
<polygon fill="#ff0000" stroke="#ff0000" points="218.1709,-357.0522 208.2851,-353.2413 213.6367,-362.3852 218.1709,-357.0522"/>
</g>
<!-- sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mod_num_par.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mod_num_par.f90.html" xlink:title="mod_num_par.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-352 287,-352 287,-328 384,-328 384,-352"/>
<text text-anchor="middle" x="335.5" y="-337.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_num_par.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_num_par.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M588.4092,-232.0935C578.2708,-268.8973 542.187,-379.6059 465.5,-422"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-422C426.214,-443.7181 423.8475,-383.493 385,-361 382.2129,-359.3862 379.2779,-357.826 376.2857,-356.3343"/>
<polygon fill="#ff0000" stroke="#ff0000" points="377.7666,-353.163 367.2274,-352.0791 374.7903,-359.4988 377.7666,-353.163"/>
</g>
<!-- sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~mod_surfile.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/mod_surfile.f90.html" xlink:title="mod_surfile.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-192 293.5,-192 293.5,-168 377.5,-168 377.5,-192"/>
<text text-anchor="middle" x="335.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_surfile.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-180C440.4458,-174.0338 411.897,-173.3866 387.9473,-174.5018"/>
<polygon fill="#ff0000" stroke="#ff0000" points="387.4231,-171.0263 377.6433,-175.1012 387.8297,-178.0145 387.4231,-171.0263"/>
</g>
<!-- sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~mod_mesh.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/mod_mesh.f90.html" xlink:title="mod_mesh.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="376.5,-474 294.5,-474 294.5,-450 376.5,-450 376.5,-474"/>
<text text-anchor="middle" x="335.5" y="-459.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_mesh.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_mesh.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-422C441.0701,-435.5053 411.4822,-445.0672 386.709,-451.4478"/>
<polygon fill="#ff0000" stroke="#ff0000" points="385.637,-448.1074 376.7697,-453.9059 387.3176,-454.9027 385.637,-448.1074"/>
</g>
<!-- sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~mod_data_arch.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/mod_data_arch.f90.html" xlink:title="mod_data_arch.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="104,-250 0,-250 0,-226 104,-226 104,-250"/>
<text text-anchor="middle" x="52" y="-235.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_data_arch.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-422C426.1807,-443.6576 426.7854,-466.5975 385,-483 306.0027,-514.0097 274.5506,-531.5613 195,-502"/>
</g>
<!-- sourcefile~mod_bspline.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~mod_bspline.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/mod_bspline.f90.html" xlink:title="mod_bspline.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="510,-152 421,-152 421,-128 510,-128 510,-152"/>
<text text-anchor="middle" x="465.5" y="-137.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_bspline.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_bspline.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_bspline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M573.8808,-207.9104C557.4989,-196.7696 532.3324,-179.9072 510,-166 505.4641,-163.1754 500.6229,-160.2537 495.8656,-157.434"/>
<polygon fill="#ff0000" stroke="#ff0000" points="497.3196,-154.2292 486.9229,-152.1896 493.7784,-160.2675 497.3196,-154.2292"/>
</g>
<!-- sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~mod_solver.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/mod_solver.f90.html" xlink:title="mod_solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="378,-150 293,-150 293,-126 378,-126 378,-150"/>
<text text-anchor="middle" x="335.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M558.1854,-207.9435C533.0009,-199.1929 497.427,-187.6028 465.5,-180"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-180C435.6593,-172.894 402.7899,-162.2483 377.5683,-153.4531"/>
<polygon fill="#ff0000" stroke="#ff0000" points="378.5483,-150.0875 367.9535,-150.061 376.2193,-156.6887 378.5483,-150.0875"/>
</g>
<!-- sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~mod_film.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/mod_film.f90.html" xlink:title="mod_film.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="501.5,-272 429.5,-272 429.5,-248 501.5,-248 501.5,-272"/>
<text text-anchor="middle" x="465.5" y="-257.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_film.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M553.6958,-232.0013C540.3965,-236.2233 525.3036,-241.0147 511.4103,-245.4253"/>
<polygon fill="#ff0000" stroke="#ff0000" points="510.0208,-242.1942 501.5486,-248.556 512.1389,-248.8661 510.0208,-242.1942"/>
</g>
<!-- sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~mod_data.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/mod_data.f90.html" xlink:title="mod_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-394 297,-394 297,-370 374,-370 374,-394"/>
<text text-anchor="middle" x="335.5" y="-379.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M465.5,-422C448.9008,-431.1764 401.944,-413.0855 369.2652,-398.3349"/>
<polygon fill="#ff0000" stroke="#ff0000" points="370.5956,-395.0943 360.0481,-394.0938 367.6695,-401.4535 370.5956,-395.0943"/>
</g>
<!-- sourcefile~mod_fluid.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~mod_fluid.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M178.3162,-328.983C153.4784,-311.0928 106.5846,-277.3162 77.4488,-256.3302"/>
<polygon fill="#ff0000" stroke="#ff0000" points="79.1807,-253.2643 69.0208,-250.2597 75.0895,-258.9443 79.1807,-253.2643"/>
</g>
<!-- sourcefile~mod_num_par.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~mod_num_par.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M324.0562,-327.9523C301.6625,-305.7075 249.4627,-260.2364 195,-258"/>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M309.5785,-192.0158C301.7532,-196.061 293.3056,-200.8635 286,-206 268.2443,-218.4838 268.6469,-227.8912 250,-239 227.782,-252.2362 220.8402,-259.0611 195,-258"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M195,-258C168.3632,-256.9062 139.1792,-253.2697 114.1612,-249.3918"/>
<polygon fill="#aaff00" stroke="#aaff00" points="114.5021,-245.902 104.0752,-247.7812 113.3982,-252.8144 114.5021,-245.902"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~mod_sort_arrays.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/mod_sort_arrays.f90.html" xlink:title="mod_sort_arrays.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="250,-230 140,-230 140,-206 250,-206 250,-230"/>
<text text-anchor="middle" x="195" y="-215.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_sort_arrays.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M293.3454,-191.4013C279.5537,-195.1314 264.0323,-199.3293 249.4657,-203.2691"/>
<polygon fill="#aaff00" stroke="#aaff00" points="248.306,-199.9569 239.5667,-205.9464 250.1336,-206.7141 248.306,-199.9569"/>
</g>
<!-- sourcefile~mod_mesh.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~mod_mesh.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M307.855,-474.0486C273.1574,-488.4447 215.6828,-509.6858 195,-502"/>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M292.9662,-148.9483C252.9653,-159.686 191.672,-177.2815 140,-197 121.3079,-204.1331 101.03,-213.4663 84.6557,-221.4257"/>
<polygon fill="#0000ff" stroke="#0000ff" points="82.9354,-218.3713 75.5074,-225.9263 86.0254,-224.6524 82.9354,-218.3713"/>
</g>
<!-- sourcefile~mod_gen_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~mod_gen_par.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/mod_gen_par.f90.html" xlink:title="mod_gen_par.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="243,-24 147,-24 147,0 243,0 243,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_gen_par.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_gen_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_gen_par.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M328.5986,-125.8802C315.7597,-104.3337 286.1943,-59.1725 250,-33 247.8983,-31.4803 245.6729,-30.0555 243.369,-28.7217"/>
<polygon fill="#0000ff" stroke="#0000ff" points="244.6849,-25.4634 234.1887,-24.0207 241.4943,-31.694 244.6849,-25.4634"/>
</g>
<!-- sourcefile~superlu.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~superlu.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/superlu.f90.html" xlink:title="superlu.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="227,-150 163,-150 163,-126 227,-126 227,-150"/>
<text text-anchor="middle" x="195" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">superlu.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~superlu.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~superlu.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M292.9641,-138C275.2748,-138 254.7935,-138 237.1456,-138"/>
<polygon fill="#0000ff" stroke="#0000ff" points="237.1248,-134.5001 227.1248,-138 237.1248,-141.5001 237.1248,-134.5001"/>
</g>
<!-- sourcefile~dmumps_struc.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~dmumps_struc.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/dmumps_struc.f90.html" xlink:title="dmumps_struc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="243.5,-108 146.5,-108 146.5,-84 243.5,-84 243.5,-108"/>
<text text-anchor="middle" x="195" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dmumps_struc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~dmumps_struc.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~dmumps_struc.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M295.2383,-125.9645C279.6591,-121.3074 261.6576,-115.9261 245.2453,-111.0199"/>
<polygon fill="#0000ff" stroke="#0000ff" points="245.8511,-107.5481 235.2675,-108.0373 243.8462,-114.2548 245.8511,-107.5481"/>
</g>
<!-- sourcefile~umfpack.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~umfpack.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/umfpack.f90.html" xlink:title="umfpack.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="229.5,-66 160.5,-66 160.5,-42 229.5,-42 229.5,-66"/>
<text text-anchor="middle" x="195" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">umfpack.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~umfpack.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~umfpack.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M321.4823,-125.8026C305.1749,-112.072 277.024,-89.7591 250,-75 246.517,-73.0978 242.8253,-71.2895 239.0683,-69.5904"/>
<polygon fill="#0000ff" stroke="#0000ff" points="240.2492,-66.2893 229.6767,-65.6005 237.512,-72.732 240.2492,-66.2893"/>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M302.737,-150.0244C296.9819,-152.6568 291.1818,-155.667 286,-159 267.7451,-170.7418 268.0142,-179.8922 250,-192 245.0021,-195.3592 239.5023,-198.5117 233.9721,-201.3831"/>
<polygon fill="#0000ff" stroke="#0000ff" points="232.1463,-198.3807 224.7195,-205.9367 235.2373,-204.6613 232.1463,-198.3807"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M429.2998,-270.84C381.1523,-285.2575 295.9331,-310.776 242.6176,-326.7411"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="241.3009,-323.4818 232.7253,-329.7033 243.309,-330.1876 241.3009,-323.4818"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_num_par.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M448.571,-272.1315C432.5133,-283.4511 407.5544,-300.5642 385,-314 379.8178,-317.0871 374.2348,-320.2074 368.7509,-323.163"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="366.9083,-320.1781 359.7038,-327.9464 370.1802,-326.3663 366.9083,-320.1781"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M448.571,-247.8685C432.5133,-236.5489 407.5544,-219.4358 385,-206 379.8178,-202.9129 374.2348,-199.7926 368.7509,-196.837"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="370.1802,-193.6337 359.7038,-192.0536 366.9083,-199.8219 370.1802,-193.6337"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_mesh.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M459.5436,-272.3168C447.0834,-297.6529 416.7777,-357.0839 385,-403 375.4483,-416.8014 363.3619,-431.2541 353.5232,-442.4008"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="350.8914,-440.0932 346.8248,-449.8765 356.1048,-444.7645 350.8914,-440.0932"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M429.4199,-248.4914C415.6692,-244.6622 399.7558,-240.893 385,-239 341.3577,-233.4012 329.7672,-234.4796 286,-239 244.902,-243.2447 236.2818,-259.6952 195,-258"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_solver.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M458.5838,-247.804C446.2485,-227.015 418.5705,-184.4965 385,-159 383.1879,-157.6238 381.2722,-156.3192 379.2889,-155.0852"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="380.7216,-151.8786 370.2733,-150.1226 377.3461,-158.011 380.7216,-151.8786"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M458.5838,-272.196C446.2485,-292.985 418.5705,-335.5035 385,-361 383.1879,-362.3762 381.2722,-363.6808 379.2889,-364.9148"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="377.3461,-361.989 370.2733,-369.8774 380.7216,-368.1214 377.3461,-361.989"/>
</g>
<!-- sourcefile~mod_elements.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~mod_elements.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/mod_elements.f90.html" xlink:title="mod_elements.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="385,-272 286,-272 286,-248 385,-248 385,-272"/>
<text text-anchor="middle" x="335.5" y="-257.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_elements.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_elements.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_elements.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M429.2878,-260C418.7122,-260 406.8625,-260 395.2388,-260"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="395.1198,-256.5001 385.1198,-260 395.1197,-263.5001 395.1198,-256.5001"/>
</g>
<!-- sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M296.7358,-370.688C280.0327,-365.8138 260.3353,-360.0658 242.7433,-354.9322"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="243.2474,-351.4334 232.6673,-351.9919 241.2864,-358.1531 243.2474,-351.4334"/>
</g>
<!-- sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M325.8322,-394.2998C299.479,-427.139 226.272,-513.6208 195,-502"/>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M195,-502C94.4537,-464.6367 63.1532,-316.7582 54.7421,-260.1782"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="58.1906,-259.5644 53.3513,-250.1393 51.2568,-260.525 58.1906,-259.5644"/>
</g>
<!-- sourcefile~mod_gen_par.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~mod_gen_par.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M152.636,-24.0344C148.0311,-26.5029 143.6865,-29.4607 140,-33 86.1409,-84.7081 63.4963,-174.785 55.5961,-216.1251"/>
<polygon fill="#ff0000" stroke="#ff0000" points="52.1497,-215.5156 53.8197,-225.978 59.0386,-216.7577 52.1497,-215.5156"/>
</g>
<!-- sourcefile~mod_elements.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~mod_elements.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M285.739,-259.9407C258.8592,-259.745 225.1022,-259.2361 195,-258"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M139.7125,-225.7325C131.4429,-226.8891 122.8679,-228.0884 114.4622,-229.264"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="113.7439,-225.8303 104.3251,-230.6818 114.7135,-232.7629 113.7439,-225.8303"/>
</g>
</g>
</svg>
</div><script>var pansourcefilemod_ms_filmf90EfferentGraph = svgPanZoom('#sourcefilemod_ms_filmf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65,-24 0,-24 0,0 65,0 65,-24"/>
<text text-anchor="middle" x="32.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="180,-24 83,-24 83,0 180,0 180,-24"/>
<text text-anchor="middle" x="131.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~mod_ms_film.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemod_ms_filmf90AfferentGraph" width="470pt" height="52pt"
 viewBox="0.00 0.00 470.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~mod_ms_film.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 466,-48 466,4 -4,4"/>
<!-- sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~mod_ms_film.f90</title>
<polygon fill="none" stroke="#000000" points="91,-44 0,-44 0,-20 91,-20 91,-44"/>
<text text-anchor="middle" x="45.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">mod_ms_film.f90</text>
</g>
<!-- sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~mod_inout_files.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/mod_inout_files.f90.html" xlink:title="mod_inout_files.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="230,-24 127,-24 127,0 230,0 230,-24"/>
<text text-anchor="middle" x="178.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_inout_files.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M126.6979,-19.7898C118.4012,-21.0374 109.7832,-22.3333 101.3962,-23.5946"/>
<polygon fill="#ff0000" stroke="#ff0000" points="100.6859,-20.1619 91.3176,-25.1101 101.7269,-27.0841 100.6859,-20.1619"/>
</g>
<!-- sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~mod_test_musst.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/mod_test_musst.f90.html" xlink:title="mod_test_musst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="372,-44 266,-44 266,-20 372,-20 372,-44"/>
<text text-anchor="middle" x="319" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_test_musst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M265.8208,-32.6952C254.0266,-32.8221 241.5891,-32.9349 230,-33 184.2229,-33.2572 172.7769,-33.2808 127,-33 118.6603,-32.9488 109.8408,-32.8682 101.2045,-32.7744"/>
<polygon fill="#ff0000" stroke="#ff0000" points="101.2297,-29.2746 91.1901,-32.6593 101.1492,-36.2741 101.2297,-29.2746"/>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M265.883,-24.4389C257.5049,-23.2463 248.7807,-22.0044 240.2275,-20.7868"/>
<polygon fill="#ff0000" stroke="#ff0000" points="240.6898,-17.3174 230.2963,-19.3731 239.7032,-24.2476 240.6898,-17.3174"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~mod_ms_film.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="462,-44 408,-44 408,-20 462,-20 462,-44"/>
<text text-anchor="middle" x="435" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_ms_film.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M407.8032,-32C400.0185,-32 391.1908,-32 382.1952,-32"/>
<polygon fill="#00ffff" stroke="#00ffff" points="382.0141,-28.5001 372.014,-32 382.014,-35.5001 382.0141,-28.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65,-24 0,-24 0,0 65,0 65,-24"/>
<text text-anchor="middle" x="32.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="180,-24 83,-24 83,0 180,0 180,-24"/>
<text text-anchor="middle" x="131.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/ms_film.html">ms_film</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_ms_film.f90.html#src">mod_ms_film.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!! author: Noël Brunetiere, Arthur Francisco</span>
<a name="ln-2"></a><span class="c">!! version: 1.0.0</span>
<a name="ln-3"></a><span class="c">!! date: February, 15 2017</span>
<a name="ln-4"></a><span class="c">!! summary: Creation and resolution of multi-scale FE film</span>
<a name="ln-5"></a>
<a name="ln-6"></a><span class="c">!&lt; &lt;span style=&quot;color: #337ab7; font-family: cabin; font-size: 1.5em;&quot;&gt;</span>
<a name="ln-7"></a><span class="c">!&lt;       **MultiScale FE solution of the Reynolds equation**</span>
<a name="ln-8"></a><span class="c">!&lt; &lt;/span&gt;</span>
<a name="ln-9"></a>
<a name="ln-10"></a><span class="c">!&lt;# Description of the film module</span>
<a name="ln-11"></a><span class="c">!&lt; This module can be used for a two-scale solution of the lubrication problems (more particularly for rough surface problems)</span>
<a name="ln-12"></a><span class="c">!</span>
<a name="ln-13"></a>   <span class="c">!&lt;## Definition of MS_FE_film</span>
<a name="ln-14"></a>      <span class="c">!&lt; [[MS_FE_FILM]] is a data structure containing a [[FE_FILM]] which is the Top Scale or macro-scale of the problem and a table of [[FE_FILM]] which is the Bottom Scale or micro-scale</span>
<a name="ln-15"></a>   <span class="c">!&lt;## Solution procedure</span>
<a name="ln-16"></a>      <span class="c">!&lt; This module can be used to create a [[MS_FE_FILM]], assemble the [[MS_FE_FILM]], and solve it. Some post-treatements like fluxes, forces are available.</span>
<a name="ln-17"></a>
<a name="ln-18"></a><span class="k">module </span><span class="n">ms_film</span>
<a name="ln-19"></a><span class="k">use </span><span class="n">data_arch</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">I4</span><span class="p">,</span> <span class="n">R8</span><span class="p">,</span> <span class="n">NB_THREADS_MAX</span>
<a name="ln-20"></a><span class="k">use </span><span class="n">film</span>
<a name="ln-21"></a><span class="k">use </span><span class="n">mesh</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">MAX_NNC</span><span class="p">,</span> <span class="n">MAX_NBS</span>
<a name="ln-22"></a><span class="k">use </span><span class="n">solver</span>
<a name="ln-23"></a><span class="k">use </span><span class="n">omp_lib</span>
<a name="ln-24"></a><span class="k">use </span><span class="n">bspline</span>
<a name="ln-25"></a><span class="k">use </span><span class="n">surfile</span>
<a name="ln-26"></a><span class="k">use </span><span class="n">data_film_hd</span>
<a name="ln-27"></a><span class="k">use </span><span class="n">num_param</span>
<a name="ln-28"></a><span class="k">use </span><span class="n">fluid_law</span>
<a name="ln-29"></a><span class="k">implicit none</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="k">private</span>
<a name="ln-32"></a>
<a name="ln-33"></a><span class="c">! multi scale fe fluid film type</span>
<a name="ln-34"></a><span class="k">type </span><span class="n">MS_FE_FILM</span>
<a name="ln-35"></a><span class="c">!! &lt;span style=&quot;color:green&quot;&gt;</span>
<a name="ln-36"></a><span class="c">!!   *MS_FE_FILM* is the top-scale [[FE_FILM]] plus all of the bottom-scale [[FE_FILM]]</span>
<a name="ln-37"></a><span class="c">!! &lt;/span&gt;</span>
<a name="ln-38"></a>   <span class="k">type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ts_fe_f</span>                              <span class="c">!! *top-scale fe_film*</span>
<a name="ln-39"></a>   <span class="k">type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bs_fe_f</span>   <span class="c">!! *bottom-scale fe_film*</span>
<a name="ln-40"></a>
<a name="ln-41"></a>   <span class="k">contains</span>
<a name="ln-42"></a><span class="k">      procedure</span> <span class="kd">::</span> <span class="n">ms_fx</span> <span class="c">!! *force computation along \(x\)*</span>
<a name="ln-43"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">ms_fy</span> <span class="c">!! *force computation along \(y\)*</span>
<a name="ln-44"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">ms_fz</span> <span class="c">!! *force computation along \(z\)*</span>
<a name="ln-45"></a><span class="n">endtype</span> <span class="n">ms_fe_film</span>
<a name="ln-46"></a>
<a name="ln-47"></a><span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal_tmp</span> <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-48"></a>
<a name="ln-49"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">MS_FE_FILM</span><span class="p">,</span> <span class="n">multi_scale_create_rect_fe_film</span><span class="p">,</span> <span class="n">multi_scale_solve_fe_film</span><span class="p">,</span> <span class="n">save_ms_field</span>
<a name="ln-50"></a>
<a name="ln-51"></a><span class="k">contains</span>
<a name="ln-52"></a>
<a name="ln-53"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-54"></a>   <span class="c">!&lt; @note Subroutine to create a [[MS_FE_FILM]]</span>
<a name="ln-55"></a>   <span class="c">!  @endnote</span>
<a name="ln-56"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-57"></a>   <span class="k">subroutine </span><span class="n">multi_scale_create_rect_fe_film</span><span class="p">(</span><span class="n">data_f</span><span class="p">,</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">,</span> <span class="n">num_pts</span><span class="p">,</span> <span class="n">num_pbs</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-58"></a>   <span class="k">implicit none</span>
<a name="ln-59"></a><span class="k">   type</span><span class="p">(</span><span class="n">DATA_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">data_f</span>     <span class="c">!! *data of the film*</span>
<a name="ln-60"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">bs_nx</span>      <span class="c">!! *number of nodes in \(x\) direction for the bottom scale*</span>
<a name="ln-61"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">bs_ny</span>      <span class="c">!! *number of nodes in \(y\) direction for the bottom scale*</span>
<a name="ln-62"></a>   <span class="k">type</span><span class="p">(</span><span class="n">NUM_PAR</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">num_pts</span>    <span class="c">!! *numerical parameters for iterative solution, top scale*</span>
<a name="ln-63"></a>   <span class="k">type</span><span class="p">(</span><span class="n">NUM_PAR</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">num_pbs</span>    <span class="c">!! *numerical parameters for iterative solution, bottom scale*</span>
<a name="ln-64"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>    <span class="c">!! *MS FE film*</span>
<a name="ln-65"></a>
<a name="ln-66"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i3</span>
<a name="ln-67"></a>
<a name="ln-68"></a>      <span class="c">! creation of the top scale fe film</span>
<a name="ln-69"></a>      <span class="k">call </span><span class="n">create_rect_FE_film</span><span class="p">(</span><span class="n">data_f</span> <span class="o">=</span> <span class="n">data_f</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-70"></a>                                <span class="n">num_p</span> <span class="o">=</span> <span class="n">num_pts</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-71"></a>                                 <span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">)</span>
<a name="ln-72"></a>
<a name="ln-73"></a>      <span class="c">! allocation of the bottom scale table</span>
<a name="ln-74"></a>      <span class="n">ne</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-75"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">ne</span><span class="p">))</span>
<a name="ln-76"></a>
<a name="ln-77"></a>      <span class="c">! creation of the bottom scale fe_film</span>
<a name="ln-78"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-79"></a>         <span class="n">i1</span>    <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-80"></a>         <span class="n">i3</span>    <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-81"></a>
<a name="ln-82"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">=</span> <span class="n">bs_nx</span>
<a name="ln-83"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">=</span> <span class="n">bs_ny</span>
<a name="ln-84"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-85"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zy</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-86"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">lx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zx</span>
<a name="ln-87"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ly</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">i3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">zy</span>
<a name="ln-88"></a>         <span class="k">call </span><span class="n">create_rect_FE_film</span><span class="p">(</span><span class="n">data_f</span> <span class="o">=</span> <span class="n">data_f</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-89"></a>                                   <span class="n">num_p</span> <span class="o">=</span> <span class="n">num_pbs</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-90"></a>                                    <span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-91"></a>      <span class="n">enddo</span>
<a name="ln-92"></a>   <span class="k">return</span>
<a name="ln-93"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">multi_scale_create_rect_fe_film</span>
<a name="ln-94"></a>
<a name="ln-95"></a>
<a name="ln-96"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-97"></a>   <span class="c">!&lt; @note Subroutine to solve a [[MS_FE_FILM]]</span>
<a name="ln-98"></a>   <span class="c">!  @endnote</span>
<a name="ln-99"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-100"></a>   <span class="k">subroutine </span><span class="n">multi_scale_solve_fe_film</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">ms_mat</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-101"></a>   <span class="k">implicit none</span>
<a name="ln-102"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">ms_fe_f</span>   <span class="c">!! *multi-scale FE film*</span>
<a name="ln-103"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MS_MAT_SOLV</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">ms_mat</span>    <span class="c">!! *multi-scale solver matrices*</span>
<a name="ln-104"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>        <span class="c">!! *boundary conditions at the corners*</span>
<a name="ln-105"></a>
<a name="ln-106"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">decomp</span>
<a name="ln-107"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">fluid</span>
<a name="ln-108"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">conv</span><span class="p">,</span> <span class="n">ts_init</span>
<a name="ln-109"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">error</span><span class="p">,</span> <span class="n">relax</span>
<a name="ln-110"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ass_c</span>
<a name="ln-111"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compt</span>
<a name="ln-112"></a>
<a name="ln-113"></a>      <span class="n">relax</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">relax</span>
<a name="ln-114"></a>      <span class="n">fluid</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span>
<a name="ln-115"></a>
<a name="ln-116"></a>      <span class="n">VERBOSE</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">VERBOSE</span><span class="o">/</span><span class="mi">1</span><span class="mf">0.</span><span class="p">)</span>
<a name="ln-117"></a>
<a name="ln-118"></a>      <span class="c">! open mp instructions (parallele computation)</span>
<a name="ln-119"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nb_threads_max&#39;</span><span class="p">,</span> <span class="n">NB_THREADS_MAX</span>
<a name="ln-120"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">NB_THREADS_MAX</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">NB_THREADS_MAX</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-121"></a>
<a name="ln-122"></a>      <span class="c">!$ call omp_set_num_threads(NB_THREADS_MAX)</span>
<a name="ln-123"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nb_threads_used&#39;</span><span class="p">,</span> <span class="n">NB_THREADS_MAX</span>
<a name="ln-124"></a>
<a name="ln-125"></a>
<a name="ln-126"></a>      <span class="c">! check of matrices allocation</span>
<a name="ln-127"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span><span class="p">))</span>
<a name="ln-128"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(:)%</span><span class="n">slv_t</span> <span class="o">=</span> <span class="n">SOLVER_BS</span>
<a name="ln-129"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(:)%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-130"></a>
<a name="ln-131"></a>      <span class="c">! solution parameters</span>
<a name="ln-132"></a>      <span class="n">ass_c</span>  <span class="o">=</span> <span class="n">ASS</span>
<a name="ln-133"></a>      <span class="n">decomp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span>
<a name="ln-134"></a>
<a name="ln-135"></a>      <span class="c">! update fluid properties</span>
<a name="ln-136"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-137"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-138"></a>                                                                      <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-139"></a>
<a name="ln-140"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-141"></a>                                                                            <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-142"></a>      <span class="n">enddo</span>
<a name="ln-143"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;fluid properties updated&#39;</span>
<a name="ln-144"></a>
<a name="ln-145"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">slv_t</span> <span class="o">=</span> <span class="n">SOLVER_TS</span>
<a name="ln-146"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-147"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nn</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-148"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">ne</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-149"></a>
<a name="ln-150"></a>      <span class="c">! matrices allocation</span>
<a name="ln-151"></a>      <span class="n">compt</span><span class="p">(:)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-152"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-153"></a>         <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_n</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>       <span class="c">! for each element, the number of lines is added</span>
<a name="ln-154"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-155"></a>            <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>   <span class="c">! &quot; &quot;, for each node, the number of contributions is added</span>
<a name="ln-156"></a>         <span class="n">enddo</span>
<a name="ln-157"></a>      <span class="n">enddo</span>
<a name="ln-158"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nvar</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-159"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nt</span>   <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-160"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">eltvar</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nvar</span>  <span class="p">)</span> <span class="p">)</span>
<a name="ln-161"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">a_elt</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">nt</span>    <span class="p">)</span> <span class="p">)</span>
<a name="ln-162"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">ne</span> <span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-163"></a>
<a name="ln-164"></a>      <span class="c">! check of precomputed tables allocation</span>
<a name="ln-165"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">))</span> <span class="k">call </span><span class="n">init_prc_tab</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">)</span>
<a name="ln-166"></a>
<a name="ln-167"></a>      <span class="c">! convergence is false at zero iteration</span>
<a name="ln-168"></a>      <span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-169"></a>      <span class="n">it</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-170"></a>
<a name="ln-171"></a>      <span class="n">ts_init</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-172"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ts_init</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-173"></a><span class="k">         call </span><span class="n">solve_FE_film</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-174"></a>                             <span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-175"></a>                              <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-176"></a>                        <span class="n">flag_ass</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-177"></a>      <span class="k">else</span>
<a name="ln-178"></a>         <span class="c">! apply boundary conditions</span>
<a name="ln-179"></a>         <span class="k">call </span><span class="n">apply_bc_FE_film_simple</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-180"></a>                                        <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-181"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;bc applied&#39;</span>
<a name="ln-182"></a>         <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-183"></a>                        <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;ini&#39;</span><span class="p">)</span>
<a name="ln-184"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;TS solver initialized&#39;</span>
<a name="ln-185"></a>      <span class="n">endif</span>
<a name="ln-186"></a>
<a name="ln-187"></a>      <span class="k">if</span> <span class="p">(</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(:)%</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_NBS</span> <span class="p">)</span> <span class="k">stop</span> <span class="s1">&#39;MAX_NBS under estimated&#39;</span>
<a name="ln-188"></a>
<a name="ln-189"></a>      <span class="c">! solution loop</span>
<a name="ln-190"></a>      <span class="k">do</span>
<a name="ln-191"></a><span class="k">         if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;loop MS *******************&quot;</span><span class="p">,</span> <span class="n">it</span>
<a name="ln-192"></a>
<a name="ln-193"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">conv</span><span class="p">)</span> <span class="k">then</span> <span class="c">!ù</span>
<a name="ln-194"></a>            <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-195"></a>               <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-196"></a>                              <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a name="ln-197"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Matrix BS released, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span><span class="c">!ù</span>
<a name="ln-198"></a>            <span class="n">enddo</span>
<a name="ln-199"></a>            <span class="k">exit</span>
<a name="ln-200"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-201"></a>
<a name="ln-202"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">SMOOTH_MS</span><span class="p">)</span> <span class="k">call </span><span class="n">smooth_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">P_N</span><span class="p">,</span> <span class="n">nodal</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-203"></a>
<a name="ln-204"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">BC_SPLINE</span><span class="p">)</span> <span class="k">call </span><span class="n">interp_ts_bs_splin</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-205"></a>
<a name="ln-206"></a>         <span class="c">! assembly of the system</span>
<a name="ln-207"></a>         <span class="k">call </span><span class="n">multi_scale_assembly_fe_film_reynolds</span><span class="p">(</span><span class="n">ms_fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-208"></a>                                                    <span class="n">ms_mat</span>  <span class="o">=</span> <span class="n">ms_mat</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-209"></a>                                                      <span class="n">ass_c</span> <span class="o">=</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-210"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ms reynolds assembled&#39;</span>
<a name="ln-211"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ass_c&#39;</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span>
<a name="ln-212"></a>
<a name="ln-213"></a><span class="c">!~          if (ass_c == ASS) then</span>
<a name="ln-214"></a>            <span class="c">! some stuff can be saved here, provided the reloading of jptr, irow, ... (instead of convert_matrice_format)</span>
<a name="ln-215"></a>            <span class="k">call </span><span class="n">convert_matrice_format</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">)</span>
<a name="ln-216"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS formated, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-217"></a><span class="c">!~          endif</span>
<a name="ln-218"></a>
<a name="ln-219"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-220"></a><span class="k">            call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-221"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;ana&#39;</span><span class="p">)</span>
<a name="ln-222"></a>            <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!ù</span>
<a name="ln-223"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS analyzed, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-224"></a>         <span class="n">endif</span>
<a name="ln-225"></a>
<a name="ln-226"></a>         <span class="c">! solution of the system</span>
<a name="ln-227"></a><span class="c">!~          if (ass_c == ASS) then</span>
<a name="ln-228"></a>            <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-229"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;fac&#39;</span><span class="p">)</span>
<a name="ln-230"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS factorized, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-231"></a><span class="c">!~          endif</span>
<a name="ln-232"></a>         <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-233"></a>                        <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;sol&#39;</span><span class="p">)</span>
<a name="ln-234"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;System TS solved, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-235"></a>
<a name="ln-236"></a>         <span class="c">!if (ass_c == ASS) then</span>
<a name="ln-237"></a>            <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-238"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;fre&#39;</span><span class="p">)</span>
<a name="ln-239"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix factors freed, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-240"></a>         <span class="c">!endif</span>
<a name="ln-241"></a>
<a name="ln-242"></a>         <span class="c">! error computation</span>
<a name="ln-243"></a>         <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<a name="ln-244"></a>         <span class="n">it</span> <span class="o">=</span> <span class="n">it</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-245"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Iteration &#39;</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="s1">&#39;error TS&#39;</span><span class="p">,</span> <span class="n">error</span>
<a name="ln-246"></a>
<a name="ln-247"></a>         <span class="c">! convergence check</span>
<a name="ln-248"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">eps</span><span class="p">)</span> <span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-249"></a>
<a name="ln-250"></a>         <span class="c">! update of variables</span>
<a name="ln-251"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">fluid</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-252"></a><span class="k">            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-253"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-254"></a><span class="k">                  </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">*</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">relax</span>
<a name="ln-255"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-256"></a><span class="k">                      </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span><span class="o">/</span><span class="mi">100</span>
<a name="ln-257"></a>                  <span class="k">else</span>
<a name="ln-258"></a><span class="k">                      </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">pres</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-259"></a>                                                                                     <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-260"></a>                  <span class="n">endif</span>
<a name="ln-261"></a>               <span class="k">else</span>
<a name="ln-262"></a><span class="k">                  </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">relax</span>
<a name="ln-263"></a>               <span class="n">endif</span>
<a name="ln-264"></a>            <span class="n">enddo</span>
<a name="ln-265"></a>         <span class="k">else</span>
<a name="ln-266"></a><span class="k">            </span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">x</span> <span class="o">*</span> <span class="n">relax</span>
<a name="ln-267"></a>         <span class="n">endif</span>
<a name="ln-268"></a>
<a name="ln-269"></a>         <span class="c">! check pressure</span>
<a name="ln-270"></a>         <span class="k">if</span> <span class="p">(</span> <span class="n">fluid</span> <span class="o">==</span> <span class="n">GP</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-271"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0._R8</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;MS p negative&#39;</span>
<a name="ln-272"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0._R8</span><span class="p">)</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span> <span class="o">/</span> <span class="mf">1.e2_R8</span>
<a name="ln-273"></a>         <span class="n">endif</span>
<a name="ln-274"></a>
<a name="ln-275"></a>         <span class="c">! update fluid properties</span>
<a name="ln-276"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-277"></a>            <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-278"></a>                                                                          <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>            <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-281"></a>                                                                                <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-282"></a>         <span class="n">enddo</span>
<a name="ln-283"></a>
<a name="ln-284"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">&gt;=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">it_max</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-285"></a><span class="k">            </span><span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-286"></a>            <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;maximum number of iteration reached before convergence&#39;</span>
<a name="ln-287"></a>         <span class="n">endif</span>
<a name="ln-288"></a>
<a name="ln-289"></a>
<a name="ln-290"></a>      <span class="n">enddo</span>
<a name="ln-291"></a>
<a name="ln-292"></a>      <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-293"></a>                     <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a name="ln-294"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix TS released, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-295"></a>
<a name="ln-296"></a>   <span class="k">return</span>
<a name="ln-297"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">multi_scale_solve_fe_film</span>
<a name="ln-298"></a>
<a name="ln-299"></a>
<a name="ln-300"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-301"></a>   <span class="c">!&lt; @note Subroutine to interpolate the top-scale nodes for the bottom-scale boundaries</span>
<a name="ln-302"></a>   <span class="c">!  @endnote</span>
<a name="ln-303"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-304"></a>   <span class="k">subroutine </span><span class="n">interp_ts_bs_splin</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-305"></a>   <span class="k">implicit none</span>
<a name="ln-306"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-307"></a>
<a name="ln-308"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">inbvx</span><span class="p">,</span> <span class="n">inbvy</span><span class="p">,</span> <span class="n">iloy</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ed</span><span class="p">,</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">,</span> <span class="n">n_edg</span><span class="p">,</span> <span class="n">n_nod</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">node_number</span>
<a name="ln-309"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">val</span>
<a name="ln-310"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">log_press</span>
<a name="ln-311"></a>
<a name="ln-312"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">coeff</span>
<a name="ln-313"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tx</span> <span class="c">! x knots</span>
<a name="ln-314"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ty</span> <span class="c">! y knots</span>
<a name="ln-315"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span>  <span class="n">x</span>
<a name="ln-316"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span>  <span class="n">y</span>
<a name="ln-317"></a>
<a name="ln-318"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">deg</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-319"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mixture</span>
<a name="ln-320"></a>
<a name="ln-321"></a>      <span class="n">mixture</span> <span class="o">=</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span>
<a name="ln-322"></a>
<a name="ln-323"></a>      <span class="n">ts_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span>
<a name="ln-324"></a>      <span class="n">ts_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span>
<a name="ln-325"></a>
<a name="ln-326"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-327"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_nx</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>  <span class="p">&amp;</span>
<a name="ln-328"></a>                <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_ny</span> <span class="o">+</span><span class="n">deg</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-329"></a>      <span class="k">allocate</span><span class="p">(</span>  <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span> <span class="n">ts_nx</span>    <span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-330"></a>                 <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span> <span class="n">ts_ny</span>    <span class="p">)</span> <span class="p">)</span>
<a name="ln-331"></a>
<a name="ln-332"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">log_press</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-333"></a>      <span class="n">log_press</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-334"></a>
<a name="ln-335"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="n">log_press</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">log_press</span><span class="p">)</span>
<a name="ln-336"></a>
<a name="ln-337"></a>      <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span>
<a name="ln-338"></a>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-339"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span><span class="o">*</span><span class="p">(</span><span class="n">ts_ny</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span>
<a name="ln-340"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-341"></a>         <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-342"></a>      <span class="n">enddo</span>
<a name="ln-343"></a>
<a name="ln-344"></a>      <span class="n">iflag</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-345"></a>      <span class="k">call </span><span class="n">db2ink</span><span class="p">(</span>   <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">),</span>                    <span class="p">&amp;</span> <span class="c">! Array of x abcissae. Must be strictly increasing.</span>
<a name="ln-346"></a>                    <span class="n">nx</span> <span class="o">=</span> <span class="n">ts_nx</span><span class="p">,</span>                         <span class="p">&amp;</span> <span class="c">! Number of x abcissae</span>
<a name="ln-347"></a>                     <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>                    <span class="p">&amp;</span> <span class="c">! Array of y abcissae. Must be strictly increasing.</span>
<a name="ln-348"></a>                    <span class="n">ny</span> <span class="o">=</span> <span class="n">ts_ny</span><span class="p">,</span>                         <span class="p">&amp;</span> <span class="c">! Number of y abcissae</span>
<a name="ln-349"></a>                   <span class="n">fcn</span> <span class="o">=</span> <span class="n">log_press</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>   <span class="p">&amp;</span> <span class="c">! Array of function values to interpolate. fcn(i,j) should</span>
<a name="ln-350"></a>                                                          <span class="c">!    contain the function value at the point (x(i),y(j))</span>
<a name="ln-351"></a>                    <span class="n">kx</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                           <span class="p">&amp;</span> <span class="c">! The order of spline pieces in x (&gt;= 2, &lt; nx). (order = polynomial degree + 1)</span>
<a name="ln-352"></a>                    <span class="n">ky</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                           <span class="p">&amp;</span> <span class="c">! The order of spline pieces in y (&gt;= 2, &lt; ny). (order = polynomial degree + 1)</span>
<a name="ln-353"></a>                    <span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_nx</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>            <span class="p">&amp;</span> <span class="c">! The knots in the x direction for the spline interpolant.</span>
<a name="ln-354"></a>                                                          <span class="c">!    If iflag=0 these are chosen by [[db2ink]].</span>
<a name="ln-355"></a>                                                          <span class="c">!    If iflag=1 these are specified by the user.</span>
<a name="ln-356"></a>                                                          <span class="c">!    Must be non-decreasing.</span>
<a name="ln-357"></a>                    <span class="n">ty</span> <span class="o">=</span> <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_ny</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>            <span class="p">&amp;</span> <span class="c">! The knots in the y direction for the spline interpolant.</span>
<a name="ln-358"></a>                                                          <span class="c">!    If iflag=0 these are chosen by [[db2ink]].</span>
<a name="ln-359"></a>                                                          <span class="c">!    If iflag=1 these are specified by the user.</span>
<a name="ln-360"></a>                                                          <span class="c">!    Must be non-decreasing.</span>
<a name="ln-361"></a>                 <span class="n">bcoef</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>       <span class="p">&amp;</span> <span class="c">! Array of coefficients of the b-spline interpolant.</span>
<a name="ln-362"></a>                 <span class="n">iflag</span> <span class="o">=</span> <span class="n">iflag</span><span class="p">)</span>                           <span class="c">! **on input:**  0 = knot sequence chosen by [[db2ink]].</span>
<a name="ln-363"></a>                                                          <span class="c">!                1 = knot sequence chosen by user.</span>
<a name="ln-364"></a>                                                          <span class="c">! **on output:** 1 = successful execution.</span>
<a name="ln-365"></a>                                                          <span class="c">!                2 = iflag out of range.</span>
<a name="ln-366"></a>                                                          <span class="c">!                3 = nx out of range.</span>
<a name="ln-367"></a>                                                          <span class="c">!                4 = kx out of range.</span>
<a name="ln-368"></a>                                                          <span class="c">!                5 = x not strictly increasing.</span>
<a name="ln-369"></a>                                                          <span class="c">!                6 = tx not non-decreasing.</span>
<a name="ln-370"></a>                                                          <span class="c">!                7 = ny out of range.</span>
<a name="ln-371"></a>                                                          <span class="c">!                8 = ky out of range.</span>
<a name="ln-372"></a>                                                          <span class="c">!                9 = y not strictly increasing.</span>
<a name="ln-373"></a>                                                          <span class="c">!               10 = ty not non-decreasing.</span>
<a name="ln-374"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="n">error</span> <span class="k">stop</span> <span class="s1">&#39;error calling db2ink&#39;</span>
<a name="ln-375"></a>
<a name="ln-376"></a>      <span class="n">inbvx</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-377"></a>      <span class="n">inbvy</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-378"></a>      <span class="n">iloy</span>  <span class="o">=</span> <span class="mi">1</span>
<a name="ln-379"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-380"></a>         <span class="n">bs_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span>
<a name="ln-381"></a>         <span class="n">bs_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span>
<a name="ln-382"></a>         <span class="n">n_edg</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ned</span>
<a name="ln-383"></a>         <span class="k">do </span><span class="n">ed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_edg</span>
<a name="ln-384"></a>            <span class="n">n_nod</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">ed</span><span class="p">)%</span><span class="n">n</span>
<a name="ln-385"></a>            <span class="k">do </span><span class="n">nn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_nod</span>
<a name="ln-386"></a>               <span class="n">node_number</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">ed</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
<a name="ln-387"></a>               <span class="n">x_n</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">node_number</span><span class="p">)</span>
<a name="ln-388"></a>               <span class="n">y_n</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">node_number</span><span class="p">)</span>
<a name="ln-389"></a>
<a name="ln-390"></a>               <span class="k">call </span><span class="n">db2val</span><span class="p">(</span><span class="n">xval</span> <span class="o">=</span> <span class="n">x_n</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! xval     !! x coordinate of evaluation point.</span>
<a name="ln-391"></a>                           <span class="n">yval</span> <span class="o">=</span> <span class="n">y_n</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! yval     !! y coordinate of evaluation point.</span>
<a name="ln-392"></a>                            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>                        <span class="p">&amp;</span>  <span class="c">! idx      !! x derivative of piecewise polynomial to evaluate.</span>
<a name="ln-393"></a>                            <span class="n">idy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>                        <span class="p">&amp;</span>  <span class="c">! idy      !! y derivative of piecewise polynomial to evaluate.</span>
<a name="ln-394"></a>                             <span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_nx</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>       <span class="p">&amp;</span>  <span class="c">! tx       !! sequence of knots defining the piecewise polynomial in the x direction. (same as in last call to [[db2ink]])</span>
<a name="ln-395"></a>                             <span class="n">ty</span> <span class="o">=</span> <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:(</span><span class="n">ts_ny</span> <span class="o">+</span><span class="n">deg</span><span class="p">)),</span>       <span class="p">&amp;</span>  <span class="c">! ty       !! sequence of knots defining the piecewise polynomial in the y direction. (same as in last call to [[db2ink]])</span>
<a name="ln-396"></a>                             <span class="n">nx</span> <span class="o">=</span> <span class="n">ts_nx</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! nx       !! the number of interpolation points in x. (same as in last call to [[db2ink]])</span>
<a name="ln-397"></a>                             <span class="n">ny</span> <span class="o">=</span> <span class="n">ts_ny</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! ny       !! the number of interpolation points in y. (same as in last call to [[db2ink]])</span>
<a name="ln-398"></a>                             <span class="n">kx</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! kx       !! order of polynomial pieces in x. (same as in last call to [[db2ink]])</span>
<a name="ln-399"></a>                             <span class="n">ky</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! ky       !! order of polynomial pieces in y. (same as in last call to [[db2ink]])</span>
<a name="ln-400"></a>                          <span class="n">bcoef</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">),</span>  <span class="p">&amp;</span>  <span class="c">! bcoef    !! the b-spline coefficients computed by [[db2ink]].</span>
<a name="ln-401"></a>                              <span class="n">f</span> <span class="o">=</span> <span class="n">val</span><span class="p">,</span>                      <span class="p">&amp;</span>  <span class="c">! f        !! interpolated value &amp;</span>
<a name="ln-402"></a>                          <span class="n">iflag</span> <span class="o">=</span> <span class="n">iflag</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! iflag    !! status flag: 0 : no errors, /=0 : error</span>
<a name="ln-403"></a>                          <span class="n">inbvx</span> <span class="o">=</span> <span class="n">inbvx</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! inbvx    !! initialization parameter which must be set to 1 the first time this routine is called, and must not be changed by the user.</span>
<a name="ln-404"></a>                          <span class="n">inbvy</span> <span class="o">=</span> <span class="n">inbvy</span><span class="p">,</span>                    <span class="p">&amp;</span>  <span class="c">! inbvy    !! initialization parameter which must be set to 1 the first time this routine is called, and must not be changed by the user.</span>
<a name="ln-405"></a>                           <span class="n">iloy</span> <span class="o">=</span> <span class="n">iloy</span><span class="p">)</span>                        <span class="c">! iloy     !! initialization parameter which must be set to 1 the first time this routine is called, and must not be changed by the user.</span>
<a name="ln-406"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="n">error</span> <span class="k">stop</span> <span class="s1">&#39;error&#39;</span>
<a name="ln-407"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="n">val</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-408"></a>
<a name="ln-409"></a>               <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">vn</span><span class="p">(</span><span class="n">node_number</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-410"></a>               <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">bc</span><span class="p">(</span><span class="n">node_number</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-411"></a>            <span class="n">enddo</span>
<a name="ln-412"></a>         <span class="n">enddo</span>
<a name="ln-413"></a>      <span class="n">enddo</span>
<a name="ln-414"></a>
<a name="ln-415"></a>      <span class="k">deallocate</span><span class="p">(</span> <span class="n">log_press</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
<a name="ln-416"></a>
<a name="ln-417"></a>   <span class="k">return</span>
<a name="ln-418"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">interp_ts_bs_splin</span>
<a name="ln-419"></a>
<a name="ln-420"></a>
<a name="ln-421"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-422"></a>   <span class="c">!&lt; @note Subroutine to save the information controlled by *code* of the whole mesh.</span>
<a name="ln-423"></a>   <span class="c">!</span>
<a name="ln-424"></a>   <span class="c">!        The genertaed file is a ```.sur``` file.</span>
<a name="ln-425"></a>   <span class="c">!  @endnote</span>
<a name="ln-426"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-427"></a>   <span class="k">subroutine </span><span class="n">save_ms_field</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">)</span>
<a name="ln-428"></a>   <span class="k">implicit none</span>
<a name="ln-429"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-430"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">file_name</span>    <span class="c">!! *filename like &quot;./out/pressure.sur&quot;*</span>
<a name="ln-431"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">code</span>         <span class="c">!! *saved information like P_N*</span>
<a name="ln-432"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nodal</span>        <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-433"></a>
<a name="ln-434"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span>
<a name="ln-435"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_z</span><span class="p">,</span> <span class="n">string</span>
<a name="ln-436"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-437"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">mat</span>
<a name="ln-438"></a>
<a name="ln-439"></a>      <span class="k">call </span><span class="n">ms_fe_f_2_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-440"></a>
<a name="ln-441"></a>      <span class="n">nnx</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-442"></a>      <span class="n">nny</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-443"></a>
<a name="ln-444"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">unit_z</span><span class="p">)</span>
<a name="ln-445"></a>
<a name="ln-446"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-447"></a><span class="k">         </span><span class="n">string</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
<a name="ln-448"></a>      <span class="k">else</span>
<a name="ln-449"></a><span class="k">         </span><span class="n">string</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
<a name="ln-450"></a>      <span class="n">endif</span>
<a name="ln-451"></a>
<a name="ln-452"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-453"></a>      <span class="n">i2</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-454"></a>      <span class="n">unit_z</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">i1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">i2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-455"></a>
<a name="ln-456"></a>      <span class="k">call </span><span class="n">init_scal</span><span class="p">(</span><span class="n">scal</span> <span class="o">=</span> <span class="n">scal_tmp</span><span class="p">,</span>                   <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-457"></a>                       <span class="n">nx</span> <span class="o">=</span> <span class="n">nnx</span><span class="p">,</span>                        <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-458"></a>                       <span class="n">ny</span> <span class="o">=</span> <span class="n">nny</span><span class="p">,</span>                        <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-459"></a>                       <span class="n">lx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">lx</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">! default unit : m</span>
<a name="ln-460"></a>                       <span class="n">ly</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ly</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-461"></a>                   <span class="n">unit_z</span> <span class="o">=</span> <span class="n">unit_z</span>                      <span class="p">)</span> <span class="c">!</span>
<a name="ln-462"></a>
<a name="ln-463"></a>      <span class="k">call </span><span class="n">write_surf</span><span class="p">(</span><span class="n">nom_fic</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span>  <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-464"></a>                        <span class="n">tab_s</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>        <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-465"></a>                         <span class="n">scal</span> <span class="o">=</span> <span class="n">scal_tmp</span>    <span class="p">)</span>
<a name="ln-466"></a>
<a name="ln-467"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="ln-468"></a>
<a name="ln-469"></a>   <span class="k">return</span>
<a name="ln-470"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">save_ms_field</span>
<a name="ln-471"></a>
<a name="ln-472"></a>
<a name="ln-473"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-474"></a>   <span class="c">!&lt; @note Subroutine to transform a MS_FE_FILM information into a matrix</span>
<a name="ln-475"></a>   <span class="c">!  @endnote</span>
<a name="ln-476"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-477"></a>   <span class="k">subroutine </span><span class="n">ms_fe_f_2_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-478"></a>   <span class="k">implicit none</span>
<a name="ln-479"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>              <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-480"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>              <span class="kd">::</span> <span class="n">code</span>        <span class="c">!! *saved information like P_N*</span>
<a name="ln-481"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>              <span class="kd">::</span> <span class="n">nodal</span>       <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-482"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">mat</span><span class="p">(:,:)</span>    <span class="c">!! *output matrix containing the information*</span>
<a name="ln-483"></a>
<a name="ln-484"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ne_x</span><span class="p">,</span> <span class="n">ne_y</span><span class="p">,</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span><span class="p">,</span> <span class="n">c</span>
<a name="ln-485"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span>
<a name="ln-486"></a>
<a name="ln-487"></a>      <span class="n">ts_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-488"></a>      <span class="n">ts_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-489"></a>
<a name="ln-490"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">),</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">))</span>
<a name="ln-491"></a>
<a name="ln-492"></a>      <span class="n">bs_nx</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-493"></a>      <span class="n">bs_ny</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-494"></a>
<a name="ln-495"></a>      <span class="n">nnx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_nx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-496"></a>      <span class="n">nny</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_ny</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-497"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-498"></a><span class="k">         </span><span class="n">nnx</span> <span class="o">=</span> <span class="n">nnx</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-499"></a>         <span class="n">nny</span> <span class="o">=</span> <span class="n">nny</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-500"></a>      <span class="n">endif</span>
<a name="ln-501"></a>
<a name="ln-502"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nnx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nny</span><span class="p">)</span> <span class="p">)</span> <span class="p">;</span> <span class="n">mat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<a name="ln-503"></a>
<a name="ln-504"></a>      <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-505"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-506"></a>      <span class="k">do </span><span class="n">ey</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_ny</span>
<a name="ln-507"></a>      <span class="k">do </span><span class="n">ex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span>
<a name="ln-508"></a>         <span class="n">e</span>    <span class="o">=</span> <span class="n">ts_nx</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">ex</span>
<a name="ln-509"></a>         <span class="n">ne_x</span> <span class="o">=</span> <span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ex</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-510"></a>         <span class="n">ne_y</span> <span class="o">=</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-511"></a>         <span class="n">mat</span><span class="p">(</span> <span class="n">ne_x</span><span class="p">:(</span> <span class="n">ne_x</span> <span class="o">+</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-512"></a>              <span class="n">ne_y</span><span class="p">:(</span> <span class="n">ne_y</span> <span class="o">+</span><span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">code</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-513"></a>      <span class="n">enddo</span>
<a name="ln-514"></a>      <span class="n">enddo</span>
<a name="ln-515"></a>
<a name="ln-516"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">)</span>
<a name="ln-517"></a>   <span class="k">return</span>
<a name="ln-518"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">ms_fe_f_2_mat</span>
<a name="ln-519"></a>
<a name="ln-520"></a>
<a name="ln-521"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-522"></a>   <span class="c">!&lt; @note Subroutine to transform a matrix into a MS_FE_FILM</span>
<a name="ln-523"></a>   <span class="c">!  @endnote</span>
<a name="ln-524"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-525"></a>   <span class="k">subroutine </span><span class="n">mat_2_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-526"></a>   <span class="k">implicit none</span>
<a name="ln-527"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-528"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                 <span class="kd">::</span> <span class="n">code</span>     <span class="c">!! *saved information like P_N*</span>
<a name="ln-529"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                 <span class="kd">::</span> <span class="n">nodal</span>    <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-530"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">mat</span>      <span class="c">!! *input matrix containing the information*</span>
<a name="ln-531"></a>
<a name="ln-532"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ts_nx</span><span class="p">,</span> <span class="n">ts_ny</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ne_x</span><span class="p">,</span> <span class="n">ne_y</span><span class="p">,</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span><span class="p">,</span> <span class="n">c</span>
<a name="ln-533"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span>
<a name="ln-534"></a>
<a name="ln-535"></a>      <span class="n">ts_nx</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-536"></a>      <span class="n">ts_ny</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-537"></a>
<a name="ln-538"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">),</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">ts_nx</span><span class="o">*</span><span class="n">ts_ny</span><span class="p">))</span>
<a name="ln-539"></a>
<a name="ln-540"></a>      <span class="n">bs_nx</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-541"></a>      <span class="n">bs_ny</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(:)%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-542"></a>
<a name="ln-543"></a>      <span class="n">nnx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_nx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_nx</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-544"></a>      <span class="n">nny</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">bs_ny</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ts_ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-545"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-546"></a><span class="k">         </span><span class="n">nnx</span> <span class="o">=</span> <span class="n">nnx</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-547"></a>         <span class="n">nny</span> <span class="o">=</span> <span class="n">nny</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-548"></a>      <span class="n">endif</span>
<a name="ln-549"></a>
<a name="ln-550"></a>      <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-551"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-552"></a>      <span class="k">do </span><span class="n">ey</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_ny</span>
<a name="ln-553"></a>      <span class="k">do </span><span class="n">ex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ts_nx</span>
<a name="ln-554"></a>         <span class="n">e</span>    <span class="o">=</span> <span class="n">ts_nx</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">ex</span>
<a name="ln-555"></a>         <span class="n">ne_x</span> <span class="o">=</span> <span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ex</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-556"></a>         <span class="n">ne_y</span> <span class="o">=</span> <span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ey</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-557"></a>
<a name="ln-558"></a>         <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">code</span><span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">mat</span><span class="p">(</span> <span class="n">ne_x</span><span class="p">:(</span> <span class="n">ne_x</span> <span class="o">+</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-559"></a>                                                        <span class="n">ne_y</span><span class="p">:(</span> <span class="n">ne_y</span> <span class="o">+</span><span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">bs_ny</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-560"></a>      <span class="n">enddo</span>
<a name="ln-561"></a>      <span class="n">enddo</span>
<a name="ln-562"></a>
<a name="ln-563"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">bs_nx</span><span class="p">,</span> <span class="n">bs_ny</span><span class="p">)</span>
<a name="ln-564"></a>   <span class="k">return</span>
<a name="ln-565"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">mat_2_ms_fe_f</span>
<a name="ln-566"></a>
<a name="ln-567"></a>
<a name="ln-568"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-569"></a>   <span class="c">!&lt; @note Subroutine to smooth a MS_FE_FILM field, the pressure for instance.</span>
<a name="ln-570"></a>   <span class="c">!</span>
<a name="ln-571"></a>   <span class="c">!        By default, the smoothing kernel is a 5x5 Gaussian filter</span>
<a name="ln-572"></a>   <span class="c">!  @endnote</span>
<a name="ln-573"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-574"></a>   <span class="k">subroutine </span><span class="n">smooth_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">)</span>
<a name="ln-575"></a>   <span class="k">implicit none</span>
<a name="ln-576"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-577"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">code</span>      <span class="c">!! *saved information like P_N*</span>
<a name="ln-578"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">nodal</span>     <span class="c">!! *if false : cell value, if true : nodal value*</span>
<a name="ln-579"></a>
<a name="ln-580"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-581"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">mat</span>
<a name="ln-582"></a>
<a name="ln-583"></a>      <span class="k">call </span><span class="n">ms_fe_f_2_mat</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-584"></a>      <span class="n">nx</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="nb">ubound</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-585"></a>
<a name="ln-586"></a>      <span class="k">call </span><span class="n">smooth_mat</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-587"></a>
<a name="ln-588"></a>      <span class="k">call </span><span class="n">mat_2_ms_fe_f</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
<a name="ln-589"></a>
<a name="ln-590"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="ln-591"></a>   <span class="k">return</span>
<a name="ln-592"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">smooth_ms_fe_f</span>
<a name="ln-593"></a>
<a name="ln-594"></a>
<a name="ln-595"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-596"></a>   <span class="c">!&lt; @note Subroutine to smooth a matrix form field, the pressure for instance.</span>
<a name="ln-597"></a>   <span class="c">!  @endnote</span>
<a name="ln-598"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-599"></a>   <span class="k">subroutine </span><span class="n">smooth_mat</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<a name="ln-600"></a>   <span class="k">implicit none</span>
<a name="ln-601"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nx</span>    <span class="c">!! *matrix x size*</span>
<a name="ln-602"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ny</span>    <span class="c">!! *matrix y size*</span>
<a name="ln-603"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">s</span>     <span class="c">!! *kernel size*</span>
<a name="ln-604"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mat</span>   <span class="c">!! *matrix*</span>
<a name="ln-605"></a>
<a name="ln-606"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">kernel3</span>
<a name="ln-607"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="kd">::</span> <span class="n">kernel5</span>
<a name="ln-608"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mi_mat</span>
<a name="ln-609"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">mat_tmp</span>
<a name="ln-610"></a>
<a name="ln-611"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-612"></a>
<a name="ln-613"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">mat_tmp</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-614"></a>
<a name="ln-615"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-616"></a><span class="k">         </span><span class="n">kernel3</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">((</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-617"></a>                                       <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-618"></a>                                       <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">/</span><span class="p">))</span>
<a name="ln-619"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-620"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-621"></a>            <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-622"></a>            <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">kernel3</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="mf">6.</span>
<a name="ln-623"></a>         <span class="n">enddo</span>
<a name="ln-624"></a>         <span class="n">enddo</span>
<a name="ln-625"></a>
<a name="ln-626"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-627"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-628"></a>            <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-629"></a>         <span class="n">enddo</span>
<a name="ln-630"></a>         <span class="n">enddo</span>
<a name="ln-631"></a>
<a name="ln-632"></a>      <span class="n">endif</span>
<a name="ln-633"></a>
<a name="ln-634"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mi">5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-635"></a><span class="k">         </span><span class="n">kernel5</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">((</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-636"></a>                                        <span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-637"></a>                                        <span class="mi">6</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-638"></a>                                        <span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-639"></a>                                        <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="o">/</span><span class="p">))</span>
<a name="ln-640"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-641"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-642"></a>            <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-643"></a>            <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">mi_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">kernel5</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mi">25</span><span class="mf">6.</span>
<a name="ln-644"></a>         <span class="n">enddo</span>
<a name="ln-645"></a>         <span class="n">enddo</span>
<a name="ln-646"></a>
<a name="ln-647"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-648"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">2</span>
<a name="ln-649"></a>            <span class="n">mat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat_tmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-650"></a>         <span class="n">enddo</span>
<a name="ln-651"></a>         <span class="n">enddo</span>
<a name="ln-652"></a>
<a name="ln-653"></a>      <span class="n">endif</span>
<a name="ln-654"></a>
<a name="ln-655"></a>
<a name="ln-656"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">mat_tmp</span><span class="p">)</span>
<a name="ln-657"></a>
<a name="ln-658"></a>   <span class="k">return</span>
<a name="ln-659"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">smooth_mat</span>
<a name="ln-660"></a>
<a name="ln-661"></a>
<a name="ln-662"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-663"></a>   <span class="c">!&lt; @note Subroutine to assemble the top-scale system, all of the bottom-scale systems being solved.</span>
<a name="ln-664"></a>   <span class="c">!  @endnote</span>
<a name="ln-665"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-666"></a>   <span class="k">subroutine </span><span class="n">multi_scale_assembly_fe_film_reynolds</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">,</span> <span class="n">ms_mat</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-667"></a>   <span class="k">implicit none</span>
<a name="ln-668"></a><span class="k">   type</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>     <span class="c">!!</span>
<a name="ln-669"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MS_MAT_SOLV</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_mat</span>      <span class="c">!! *solver type matrices table*</span>
<a name="ln-670"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">ass_c</span>       <span class="c">!! *assembly type*</span>
<a name="ln-671"></a>
<a name="ln-672"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ke_ij</span>
<a name="ln-673"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(:,:)</span>  <span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span>  <span class="n">be_i</span>
<a name="ln-674"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:)</span>  <span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ind_e</span>
<a name="ln-675"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">compt</span>
<a name="ln-676"></a>
<a name="ln-677"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-678"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">val_t</span>
<a name="ln-679"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">first_assembly</span>
<a name="ln-680"></a>
<a name="ln-681"></a>      <span class="n">ne</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-682"></a>
<a name="ln-683"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-684"></a>      <span class="k">allocate</span><span class="p">(</span>  <span class="n">be_i</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-685"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">ind_e</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-686"></a>
<a name="ln-687"></a>      <span class="c">! assembly</span>
<a name="ln-688"></a>      <span class="n">compt</span><span class="p">(:)</span>        <span class="o">=</span> <span class="mi">1</span>
<a name="ln-689"></a>      <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">b</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-690"></a>
<a name="ln-691"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-692"></a><span class="k">         allocate</span><span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">(</span><span class="n">ne</span><span class="p">))</span>
<a name="ln-693"></a>         <span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-694"></a>      <span class="n">endif</span>
<a name="ln-695"></a>
<a name="ln-696"></a>      <span class="c">! check for first assembly: save the assembly location in ass_loc_in_mat</span>
<a name="ln-697"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-698"></a><span class="k">         </span><span class="n">first_assembly</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-699"></a>         <span class="n">ms_mat</span><span class="p">%</span><span class="n">ass_loc_in_mat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-700"></a>      <span class="k">else</span>
<a name="ln-701"></a><span class="k">         </span><span class="n">first_assembly</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-702"></a>      <span class="n">endif</span>
<a name="ln-703"></a>
<a name="ln-704"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-705"></a>         <span class="c">! copy of the boundary conditions</span>
<a name="ln-706"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-707"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-708"></a>            <span class="n">be_i</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span>
<a name="ln-709"></a>         <span class="n">enddo</span>
<a name="ln-710"></a>      <span class="n">enddo</span>
<a name="ln-711"></a>
<a name="ln-712"></a>      <span class="c">! elementary matrices calculation</span>
<a name="ln-713"></a>      <span class="c">!-------------------------------------------</span>
<a name="ln-714"></a>      <span class="c">!open mp instructions (parallele computation)</span>
<a name="ln-715"></a>      <span class="c">!$omp parallel</span>
<a name="ln-716"></a>      <span class="c">!$omp do schedule(runtime)</span>
<a name="ln-717"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-718"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;MS elements &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s1">&#39; thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-719"></a>
<a name="ln-720"></a>         <span class="k">call </span><span class="n">elementary_full_domain_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-721"></a>                                                       <span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">bs_mat</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>   <span class="p">&amp;</span>
<a name="ln-722"></a>                                                     <span class="n">ke_ij</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:),</span>     <span class="p">&amp;</span>
<a name="ln-723"></a>                                                      <span class="n">be_i</span> <span class="o">=</span> <span class="n">be_i</span><span class="p">(</span> <span class="n">e</span><span class="p">,</span> <span class="p">:),</span>        <span class="p">&amp;</span>
<a name="ln-724"></a>                                                     <span class="n">ind_e</span> <span class="o">=</span> <span class="n">ind_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:))</span>
<a name="ln-725"></a>      <span class="n">enddo</span>
<a name="ln-726"></a>      <span class="c">!$OMP end do</span>
<a name="ln-727"></a>      <span class="c">!$OMP end parallel</span>
<a name="ln-728"></a>      <span class="c">!end open mp instructions</span>
<a name="ln-729"></a>      <span class="c">!-------------------------------------------</span>
<a name="ln-730"></a>
<a name="ln-731"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-732"></a>         <span class="c">! consideration of the bc condition</span>
<a name="ln-733"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-734"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-735"></a>            <span class="n">ind_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ii</span>
<a name="ln-736"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">bc</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-737"></a><span class="k">               </span><span class="n">val_t</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-738"></a>               <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-739"></a>               <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">val_t</span>
<a name="ln-740"></a>               <span class="n">be_i</span><span class="p">(</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-741"></a>            <span class="n">endif</span>
<a name="ln-742"></a>         <span class="n">enddo</span>
<a name="ln-743"></a>         <span class="c">! copy of the rhs member</span>
<a name="ln-744"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-745"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-746"></a>            <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">+</span> <span class="n">be_i</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-747"></a>         <span class="n">enddo</span>
<a name="ln-748"></a>      <span class="n">enddo</span>
<a name="ln-749"></a>
<a name="ln-750"></a>      <span class="c">! assembly of the elemental matrix in the solver matrix</span>
<a name="ln-751"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-752"></a>
<a name="ln-753"></a><span class="k">         do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-754"></a>
<a name="ln-755"></a>            <span class="k">call </span><span class="n">assemble_in_mat_sol</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-756"></a>                                     <span class="n">num</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-757"></a>                                    <span class="n">nelt</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-758"></a>                                   <span class="n">nline</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-759"></a>                                    <span class="n">tind</span> <span class="o">=</span> <span class="n">ind_e</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:),</span>        <span class="p">&amp;</span>
<a name="ln-760"></a>                                   <span class="n">m_elt</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:),</span>     <span class="p">&amp;</span>
<a name="ln-761"></a>                                   <span class="n">compt</span> <span class="o">=</span> <span class="n">compt</span><span class="p">)</span>
<a name="ln-762"></a>         <span class="n">enddo</span>
<a name="ln-763"></a>         <span class="n">ms_mat</span><span class="p">%</span><span class="n">ts_mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-764"></a>
<a name="ln-765"></a>      <span class="n">endif</span>
<a name="ln-766"></a>
<a name="ln-767"></a>      <span class="k">deallocate</span><span class="p">(</span> <span class="n">ke_ij</span><span class="p">,</span> <span class="n">be_i</span><span class="p">,</span> <span class="n">ind_e</span> <span class="p">)</span>
<a name="ln-768"></a>
<a name="ln-769"></a>   <span class="k">return</span>
<a name="ln-770"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">multi_scale_assembly_fe_film_reynolds</span>
<a name="ln-771"></a>
<a name="ln-772"></a>
<a name="ln-773"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-774"></a>   <span class="c">!&lt; @note Function to calculate the generated load in a fluid MS film</span>
<a name="ln-775"></a>   <span class="c">!        \( \int_\Omega p d\Omega \)</span>
<a name="ln-776"></a>   <span class="c">!  @endnote</span>
<a name="ln-777"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-778"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">ms_fz</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-779"></a>   <span class="k">implicit none</span>
<a name="ln-780"></a><span class="k">   class</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span> <span class="c">!! *MS FE film*</span>
<a name="ln-781"></a>
<a name="ln-782"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-783"></a>      <span class="n">ms_fz</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-784"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-785"></a>          <span class="n">ms_fz</span> <span class="o">=</span> <span class="n">ms_fz</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">fz</span><span class="p">()</span>
<a name="ln-786"></a>      <span class="n">enddo</span>
<a name="ln-787"></a>   <span class="k">return</span>
<a name="ln-788"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">ms_fz</span>
<a name="ln-789"></a>
<a name="ln-790"></a>
<a name="ln-791"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-792"></a>   <span class="c">!&lt; @note Function to calculate the friction force along \(x\) in a fluid MS film</span>
<a name="ln-793"></a>   <span class="c">!        \( \int_\Omega \tau_{xz} d\Omega \)</span>
<a name="ln-794"></a>   <span class="c">!  @endnote</span>
<a name="ln-795"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-796"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">ms_fx</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-797"></a>   <span class="k">implicit none</span>
<a name="ln-798"></a><span class="k">   class</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-799"></a>
<a name="ln-800"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-801"></a>      <span class="n">ms_fx</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-802"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-803"></a>         <span class="n">ms_fx</span> <span class="o">=</span> <span class="n">ms_fx</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">fx</span><span class="p">()</span>
<a name="ln-804"></a>      <span class="n">enddo</span>
<a name="ln-805"></a>   <span class="k">return</span>
<a name="ln-806"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">ms_fx</span>
<a name="ln-807"></a>
<a name="ln-808"></a>
<a name="ln-809"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-810"></a>   <span class="c">!&lt; @note Function to calculate the friction force along \(y\) in a fluid MS film</span>
<a name="ln-811"></a>   <span class="c">!        \( \int_\Omega \tau_{yz} d\Omega \)</span>
<a name="ln-812"></a>   <span class="c">!  @endnote</span>
<a name="ln-813"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-814"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">ms_fy</span><span class="p">(</span><span class="n">ms_fe_f</span><span class="p">)</span>
<a name="ln-815"></a>   <span class="k">implicit none</span>
<a name="ln-816"></a><span class="k">   class</span><span class="p">(</span><span class="n">MS_FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ms_fe_f</span>
<a name="ln-817"></a>
<a name="ln-818"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-819"></a>      <span class="n">ms_fy</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-820"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">ts_fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-821"></a>         <span class="n">ms_fy</span> <span class="o">=</span> <span class="n">ms_fy</span> <span class="o">+</span> <span class="n">ms_fe_f</span><span class="p">%</span><span class="n">bs_fe_f</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">fy</span><span class="p">()</span>
<a name="ln-822"></a>      <span class="n">enddo</span>
<a name="ln-823"></a>   <span class="k">return</span>
<a name="ln-824"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">ms_fy</span>
<a name="ln-825"></a>
<a name="ln-826"></a><span class="n">endmodule</span> <span class="n">ms_film</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-04-03 16:35  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> MUSST was developed by Noël Brunetière - Arthur Francisco</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>