<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="MUSST – A modern Fortran MUltiScale Simulation Tribology solver">
    
    <meta name="author" content="Noël Brunetière - Arthur Francisco" >
    <link rel="icon" href="../favicon.png">

    <title>mod_surfile.f90 &ndash; MUSST</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    
    <link href="../css/user.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">MUSST </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>mod_surfile.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 8.8% of total for source files.">849 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/mod_surfile.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">mod_surfile.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/surfile.html">surfile</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_surfile.f90.html#src">mod_surfile.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~mod_surfile.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemod_surfilef90EfferentGraph" width="384pt" height="52pt"
 viewBox="0.00 0.00 384.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~mod_surfile.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-48 380,-48 380,4 -4,4"/>
<!-- sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph_node1" class="node"><title>sourcefile~mod_surfile.f90</title>
<polygon fill="none" stroke="black" points="376,-44 290,-44 290,-20 376,-20 376,-44"/>
<text text-anchor="middle" x="333" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">mod_surfile.f90</text>
</g>
<!-- sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph_node2" class="node"><title>sourcefile~mod_data_arch.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mod_data_arch.f90.html" xlink:title="mod_data_arch.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-44 7.10543e-15,-44 7.10543e-15,-20 106,-20 106,-44"/>
<text text-anchor="middle" x="53" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_data_arch.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M289.901,-32.6385C278.271,-32.788 265.647,-32.9253 254,-33 204.223,-33.3191 191.777,-33.2828 142,-33 133.654,-32.9526 124.863,-32.8799 116.197,-32.7948"/>
<polygon fill="#ff0000" stroke="#ff0000" points="116.151,-29.2942 106.116,-32.6901 116.079,-36.2939 116.151,-29.2942"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph_node3" class="node"><title>sourcefile~mod_sort_arrays.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mod_sort_arrays.f90.html" xlink:title="mod_sort_arrays.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-24 142,-24 142,-0 254,-0 254,-24"/>
<text text-anchor="middle" x="198" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_sort_arrays.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M289.918,-25.6719C281.822,-24.4545 273.166,-23.1528 264.532,-21.8544"/>
<polygon fill="#ff0000" stroke="#ff0000" points="264.85,-18.363 254.441,-20.337 263.809,-25.2852 264.85,-18.363"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_surfile.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M141.712,-19.7325C133.443,-20.8891 124.868,-22.0884 116.462,-23.264"/>
<polygon fill="#00ffff" stroke="#00ffff" points="115.744,-19.8303 106.325,-24.6818 116.714,-26.7629 115.744,-19.8303"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~mod_surfile.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemod_surfilef90AfferentGraph" width="641pt" height="119pt"
 viewBox="0.00 0.00 641.00 119.18" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph" class="graph" transform="scale(0.900281 0.900281) rotate(0) translate(4 128.384)">
<title>sourcefile~~mod_surfile.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-128.384 708,-128.384 708,4 -4,4"/>
<!-- sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_node1" class="node"><title>sourcefile~mod_surfile.f90</title>
<polygon fill="none" stroke="black" points="86,-52.87 0,-52.87 0,-28.87 86,-28.87 86,-52.87"/>
<text text-anchor="middle" x="43" y="-38.47" font-family="Helvetica,sans-Serif" font-size="10.50">mod_surfile.f90</text>
</g>
<!-- sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_node2" class="node"><title>sourcefile~mod_ms_film.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/mod_ms_film.f90.html" xlink:title="mod_ms_film.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="326,-90.87 232,-90.87 232,-66.87 326,-66.87 326,-90.87"/>
<text text-anchor="middle" x="279" y="-76.47" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_ms_film.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M252.568,-90.9306C223.567,-104.069 177.864,-122.741 160,-118.87"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M158,-118.87C119.346,-110.493 83.1803,-80.5348 62.341,-60.28"/>
<polygon fill="#ff0000" stroke="#ff0000" points="64.6732,-57.6622 55.1313,-53.0574 59.719,-62.6075 64.6732,-57.6622"/>
</g>
<!-- sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_node5" class="node"><title>sourcefile~mod_film.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/mod_film.f90.html" xlink:title="mod_film.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="196,-52.87 122,-52.87 122,-28.87 196,-28.87 196,-52.87"/>
<text text-anchor="middle" x="159" y="-38.47" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_film.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge9" class="edge"><title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M240.664,-66.8466C229.697,-63.3149 217.571,-59.4098 206.124,-55.7236"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="206.878,-52.2893 196.286,-52.5554 204.732,-58.9523 206.878,-52.2893"/>
</g>
<!-- sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_node3" class="node"><title>sourcefile~mod_test_musst.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/mod_test_musst.f90.html" xlink:title="mod_test_musst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613.5,-70.87 504.5,-70.87 504.5,-46.87 613.5,-46.87 613.5,-70.87"/>
<text text-anchor="middle" x="559" y="-56.47" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_test_musst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M414,-78.87C373.94,-82.3299 365.601,-92.9046 326,-99.87 252.863,-112.734 232.575,-134.598 160,-118.87"/>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge5" class="edge"><title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M414,-78.87C388.628,-80.6236 360.489,-80.8795 336.573,-80.597"/>
<polygon fill="#ff0000" stroke="#ff0000" points="336.308,-77.0927 326.256,-80.4394 336.201,-84.0918 336.308,-77.0927"/>
</g>
<!-- sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_node4" class="node"><title>sourcefile~mod_inout_files.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/mod_inout_files.f90.html" xlink:title="mod_inout_files.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="468,-50.87 362,-50.87 362,-26.87 468,-26.87 468,-50.87"/>
<text text-anchor="middle" x="415" y="-36.47" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mod_inout_files.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge8" class="edge"><title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M504.316,-51.3089C495.848,-50.1163 487.031,-48.8744 478.386,-47.6569"/>
<polygon fill="#00ffff" stroke="#00ffff" points="478.74,-44.1722 468.349,-46.2432 477.763,-51.1038 478.74,-44.1722"/>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge10" class="edge"><title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M504.246,-68.2738C477.767,-72.437 445.307,-76.8445 416,-78.87"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M414,-78.87C373.886,-81.6424 365.642,-64.5996 326,-57.87 285.924,-51.0668 239.91,-46.6143 206.507,-43.9793"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="206.366,-40.4585 196.129,-43.187 205.833,-47.4382 206.366,-40.4585"/>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M385.62,-26.8313C358.922,-16.474 317.548,-2.88669 280,-0.870047"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M278,-0.870047C213.203,2.61014 139.597,-13.3209 92.5278,-26.1027"/>
<polygon fill="#ff0000" stroke="#ff0000" points="91.3084,-22.8087 82.6093,-28.8565 93.1812,-29.5536 91.3084,-22.8087"/>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge6" class="edge"><title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M373.796,-50.8714C360.141,-54.9474 344.708,-59.5541 330.362,-63.8365"/>
<polygon fill="#ff0000" stroke="#ff0000" points="329.22,-60.5248 320.639,-66.7389 331.223,-67.2323 329.22,-60.5248"/>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge11" class="edge"><title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M278,-0.870047C246.486,0.822536 212.566,-12.4063 189.218,-24.0984"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="187.451,-21.0725 180.203,-28.8006 190.688,-27.2788 187.451,-21.0725"/>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge4" class="edge"><title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M121.93,-40.87C113.772,-40.87 104.949,-40.87 96.2743,-40.87"/>
<polygon fill="#ff0000" stroke="#ff0000" points="96.2065,-37.3701 86.2064,-40.87 96.2064,-44.3701 96.2065,-37.3701"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_node6" class="node"><title>sourcefile~main.f90</title>
<g id="a_sourcefile~~mod_surfile.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="704,-70.87 650,-70.87 650,-46.87 704,-46.87 704,-70.87"/>
<text text-anchor="middle" x="677" y="-56.47" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_surfile.f90~~AfferentGraph_edge7" class="edge"><title>sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M649.967,-58.87C642.119,-58.87 633.134,-58.87 623.948,-58.87"/>
<polygon fill="#7fff00" stroke="#7fff00" points="623.946,-55.3701 613.946,-58.87 623.946,-62.3701 623.946,-55.3701"/>
</g>
</g>
</svg>
</div><script>var pansourcefilemod_surfilef90AfferentGraph = svgPanZoom('#sourcefilemod_surfilef90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/surfile.html">surfile</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_surfile.f90.html#src">mod_surfile.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!&lt; author: Arthur Francisco</span>
<a name="ln-2"></a><span class="c">!  version: 1.0.0</span>
<a name="ln-3"></a><span class="c">!  date: july, 23 2018</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">!  &lt;span style=&quot;color: #337ab7; font-family: cabin; font-size: 1.5em;&quot;&gt;</span>
<a name="ln-6"></a><span class="c">!     **Routines to handle Digital Surf binary format (.sur)**</span>
<a name="ln-7"></a><span class="c">!  &lt;/span&gt;</span>
<a name="ln-8"></a>
<a name="ln-9"></a><span class="k">module </span><span class="n">surfile</span>
<a name="ln-10"></a><span class="k">use</span><span class="p">,</span> <span class="k">intrinsic</span> <span class="kd">::</span> <span class="nb">ISO_C_BINDING</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="kt">C_CHAR</span><span class="p">,</span> <span class="nb">C_NULL_CHAR</span><span class="p">,</span> <span class="kt">C_FLOAT</span><span class="p">,</span> <span class="kt">C_INT</span><span class="p">,</span> <span class="kt">C_SHORT</span>
<a name="ln-11"></a><span class="k">use </span><span class="n">data_arch</span>
<a name="ln-12"></a><span class="k">use </span><span class="n">sort_arrays</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sort_real</span><span class="p">,</span> <span class="n">sort_real_1real</span><span class="p">,</span> <span class="n">sort_real_2real</span>
<a name="ln-13"></a><span class="k">implicit none</span>
<a name="ln-14"></a>
<a name="ln-15"></a><span class="k">private</span>
<a name="ln-16"></a>
<a name="ln-17"></a><span class="c">!&lt; &lt;span style=&quot;color:green&quot;&gt;Surface object: header and heights&lt;/span&gt;</span>
<a name="ln-18"></a><span class="c">! @note</span>
<a name="ln-19"></a><span class="c">!    Adapted from &#39;surffile.c&#39;, &#39;gwyddion&#39; software, Copyright (C) 2005 David Necas, Petr Klapetek.</span>
<a name="ln-20"></a><span class="c">! @endnote</span>
<a name="ln-21"></a><span class="c">! @warning</span>
<a name="ln-22"></a><span class="c">!    Must be 512 bytes long</span>
<a name="ln-23"></a><span class="c">! @endwarning</span>
<a name="ln-24"></a>
<a name="ln-25"></a>
<a name="ln-26"></a><span class="k">type </span><span class="n">SCALE_SURF</span>
<a name="ln-27"></a>   <span class="c">! bytes below: 8+10+2*12+9*16+2*30+34+128 = 408</span>
<a name="ln-28"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">signature</span>
<a name="ln-29"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xlength_unit</span>
<a name="ln-30"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ylength_unit</span>
<a name="ln-31"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zlength_unit</span>
<a name="ln-32"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xaxis</span>
<a name="ln-33"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yaxis</span>
<a name="ln-34"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zaxis</span>
<a name="ln-35"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dx_unit</span>
<a name="ln-36"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dy_unit</span>
<a name="ln-37"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dz_unit</span>
<a name="ln-38"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">30</span><span class="p">)</span> <span class="kd">::</span> <span class="n">object_name</span>
<a name="ln-39"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">30</span><span class="p">)</span> <span class="kd">::</span> <span class="n">operator_name</span>
<a name="ln-40"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span> <span class="kd">::</span> <span class="n">client_zone</span>
<a name="ln-41"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>   <span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">reserved</span>
<a name="ln-42"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">34</span><span class="p">)</span> <span class="kd">::</span> <span class="n">reservedzone</span>
<a name="ln-43"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">obsolete</span>
<a name="ln-44"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span>  <span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">obsolete2</span>
<a name="ln-45"></a>
<a name="ln-46"></a>   <span class="c">! bytes below: 10*4 = 40</span>
<a name="ln-47"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dx</span>
<a name="ln-48"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dy</span>
<a name="ln-49"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dz</span>
<a name="ln-50"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xunit_ratio</span>
<a name="ln-51"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yunit_ratio</span>
<a name="ln-52"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zunit_ratio</span>
<a name="ln-53"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">XOffset</span>
<a name="ln-54"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">YOffset</span>
<a name="ln-55"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ZOffset</span>
<a name="ln-56"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">measurement_duration</span>
<a name="ln-57"></a>
<a name="ln-58"></a>   <span class="c">! bytes below: 5*4 = 20</span>
<a name="ln-59"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zmin</span>
<a name="ln-60"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zmax</span>
<a name="ln-61"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xres</span>
<a name="ln-62"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yres</span>
<a name="ln-63"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nofpoints</span>
<a name="ln-64"></a>
<a name="ln-65"></a>   <span class="c">! bytes below: 22*2 = 44</span>
<a name="ln-66"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="k">format</span>
<a name="ln-67"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">version</span>
<a name="ln-68"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">material_code</span>
<a name="ln-69"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="k">type</span>
<a name="ln-70"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">range</span>
<a name="ln-71"></a><span class="nb">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">special_points</span>
<a name="ln-72"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">absolute</span>
<a name="ln-73"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pointsize</span>
<a name="ln-74"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">imprint</span>
<a name="ln-75"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">inversion</span>
<a name="ln-76"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">leveling</span>
<a name="ln-77"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">seconds</span>
<a name="ln-78"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">minutes</span>
<a name="ln-79"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hours</span>
<a name="ln-80"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">day</span>
<a name="ln-81"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">month</span>
<a name="ln-82"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">year</span>
<a name="ln-83"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dayof</span>
<a name="ln-84"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">comment_size</span>
<a name="ln-85"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">private_size</span>
<a name="ln-86"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nobjects</span>
<a name="ln-87"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">acquisition</span>
<a name="ln-88"></a>
<a name="ln-89"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">lx</span>       <span class="c">!! *surface length*</span>
<a name="ln-90"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ly</span>       <span class="c">!! *surface width*</span>
<a name="ln-91"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">lz</span>       <span class="c">!! *surface height (max -min)*</span>
<a name="ln-92"></a>
<a name="ln-93"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">mu</span>       <span class="c">!! *surface mean height*</span>
<a name="ln-94"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">si</span>       <span class="c">!! *surface mean height*</span>
<a name="ln-95"></a><span class="n">endtype</span> <span class="n">SCALE_SURF</span>
<a name="ln-96"></a>
<a name="ln-97"></a><span class="k">type </span><span class="n">OBJ_SURF</span>
<a name="ln-98"></a>   <span class="c">! bytes below: 8+10+2*12+9*16+2*30+34+128 = 408</span>
<a name="ln-99"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">signature</span>
<a name="ln-100"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xlength_unit</span>
<a name="ln-101"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ylength_unit</span>
<a name="ln-102"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zlength_unit</span>
<a name="ln-103"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xaxis</span>
<a name="ln-104"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yaxis</span>
<a name="ln-105"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zaxis</span>
<a name="ln-106"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dx_unit</span>
<a name="ln-107"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dy_unit</span>
<a name="ln-108"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">16</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dz_unit</span>
<a name="ln-109"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">30</span><span class="p">)</span> <span class="kd">::</span> <span class="n">object_name</span>
<a name="ln-110"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">30</span><span class="p">)</span> <span class="kd">::</span> <span class="n">operator_name</span>
<a name="ln-111"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="kd">::</span> <span class="n">client_zone</span>
<a name="ln-112"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span>  <span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">reserved</span>
<a name="ln-113"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">34</span><span class="p">)</span> <span class="kd">::</span> <span class="n">reservedzone</span>
<a name="ln-114"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">obsolete</span>
<a name="ln-115"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">obsolete2</span>
<a name="ln-116"></a>
<a name="ln-117"></a>   <span class="c">! bytes below: 10*4 = 40</span>
<a name="ln-118"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dx</span>
<a name="ln-119"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dy</span>
<a name="ln-120"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dz</span>
<a name="ln-121"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xunit_ratio</span>
<a name="ln-122"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yunit_ratio</span>
<a name="ln-123"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zunit_ratio</span>
<a name="ln-124"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">XOffset</span>
<a name="ln-125"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">YOffset</span>
<a name="ln-126"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ZOffset</span>
<a name="ln-127"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_FLOAT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">measurement_duration</span>
<a name="ln-128"></a>
<a name="ln-129"></a>   <span class="c">! bytes below: 5*4 = 20</span>
<a name="ln-130"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_INT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zmin</span>
<a name="ln-131"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_INT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">zmax</span>
<a name="ln-132"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_INT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xres</span>
<a name="ln-133"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_INT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yres</span>
<a name="ln-134"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_INT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nofpoints</span>
<a name="ln-135"></a>
<a name="ln-136"></a>   <span class="c">! bytes below: 22*2 = 44</span>
<a name="ln-137"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="k">format</span>
<a name="ln-138"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">version</span>
<a name="ln-139"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">material_code</span>
<a name="ln-140"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="k">type</span>
<a name="ln-141"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">range</span>
<a name="ln-142"></a><span class="nb">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">special_points</span>
<a name="ln-143"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">absolute</span>
<a name="ln-144"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pointsize</span>
<a name="ln-145"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">imprint</span>
<a name="ln-146"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">inversion</span>
<a name="ln-147"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">leveling</span>
<a name="ln-148"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">seconds</span>
<a name="ln-149"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">minutes</span>
<a name="ln-150"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hours</span>
<a name="ln-151"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">day</span>
<a name="ln-152"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">month</span>
<a name="ln-153"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">year</span>
<a name="ln-154"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dayof</span>
<a name="ln-155"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">comment_size</span>
<a name="ln-156"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">private_size</span>
<a name="ln-157"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nobjects</span>
<a name="ln-158"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_SHORT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">acquisition</span>
<a name="ln-159"></a>
<a name="ln-160"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_INT</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">val</span><span class="p">(:)</span> <span class="c">!! *heights*</span>
<a name="ln-161"></a><span class="n">endtype</span> <span class="n">OBJ_SURF</span>
<a name="ln-162"></a>
<a name="ln-163"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">SURF_DAT</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">!! *&#39;.dat&#39; format, txt*</span>
<a name="ln-164"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">SURF_SUR</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!! *&#39;.sur&#39; format, binary*</span>
<a name="ln-165"></a>
<a name="ln-166"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">read_surf</span><span class="p">,</span> <span class="n">write_surf</span><span class="p">,</span> <span class="n">init_scal</span><span class="p">,</span> <span class="n">unit2IUc</span><span class="p">,</span> <span class="n">unit2IUf</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-167"></a>          <span class="n">trans_surf_txt</span><span class="p">,</span> <span class="n">scal2surf</span><span class="p">,</span> <span class="n">surf2scal</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">SCALE_SURF</span><span class="p">,</span> <span class="n">OBJ_SURF</span>
<a name="ln-168"></a>
<a name="ln-169"></a><span class="k">contains</span>
<a name="ln-170"></a>
<a name="ln-171"></a><span class="k">   subroutine </span><span class="n">scal2surf</span><span class="p">(</span><span class="n">scal</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>
<a name="ln-172"></a>   <span class="k">implicit none</span>
<a name="ln-173"></a><span class="k">   type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="p">)</span> <span class="kd">::</span> <span class="n">scal</span> <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-174"></a>   <span class="k">type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">surf</span> <span class="c">!! *object [[OBJ_SURF]]*</span>
<a name="ln-175"></a>
<a name="ln-176"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">signature</span><span class="p">),</span>     <span class="p">&amp;</span>
<a name="ln-177"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">signature</span><span class="p">)</span>
<a name="ln-178"></a>
<a name="ln-179"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-180"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">)</span>
<a name="ln-181"></a>
<a name="ln-182"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-183"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">)</span>
<a name="ln-184"></a>
<a name="ln-185"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-186"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">)</span>
<a name="ln-187"></a>
<a name="ln-188"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">xaxis</span><span class="p">),</span>         <span class="p">&amp;</span>
<a name="ln-189"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">xaxis</span><span class="p">)</span>
<a name="ln-190"></a>
<a name="ln-191"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">yaxis</span><span class="p">),</span>         <span class="p">&amp;</span>
<a name="ln-192"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">yaxis</span><span class="p">)</span>
<a name="ln-193"></a>
<a name="ln-194"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">zaxis</span><span class="p">),</span>         <span class="p">&amp;</span>
<a name="ln-195"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">zaxis</span><span class="p">)</span>
<a name="ln-196"></a>
<a name="ln-197"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">),</span>       <span class="p">&amp;</span>
<a name="ln-198"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">)</span>
<a name="ln-199"></a>
<a name="ln-200"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">),</span>       <span class="p">&amp;</span>
<a name="ln-201"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">)</span>
<a name="ln-202"></a>
<a name="ln-203"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">),</span>       <span class="p">&amp;</span>
<a name="ln-204"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">)</span>
<a name="ln-205"></a>
<a name="ln-206"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">object_name</span><span class="p">),</span>   <span class="p">&amp;</span>
<a name="ln-207"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">object_name</span><span class="p">)</span>
<a name="ln-208"></a>
<a name="ln-209"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">operator_name</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-210"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">operator_name</span><span class="p">)</span>
<a name="ln-211"></a>
<a name="ln-212"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">client_zone</span><span class="p">),</span>   <span class="p">&amp;</span>
<a name="ln-213"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">client_zone</span><span class="p">)</span>
<a name="ln-214"></a>
<a name="ln-215"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">reserved</span><span class="p">),</span>      <span class="p">&amp;</span>
<a name="ln-216"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">reserved</span><span class="p">)</span>
<a name="ln-217"></a>
<a name="ln-218"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-219"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">)</span>
<a name="ln-220"></a>
<a name="ln-221"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">obsolete</span><span class="p">),</span>      <span class="p">&amp;</span>
<a name="ln-222"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">obsolete</span><span class="p">)</span>
<a name="ln-223"></a>
<a name="ln-224"></a>      <span class="k">call </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">),</span>     <span class="p">&amp;</span>
<a name="ln-225"></a>                      <span class="n">cs</span><span class="o">=</span>     <span class="n">surf</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">)</span>
<a name="ln-226"></a>
<a name="ln-227"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">dx</span>                    <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx</span>
<a name="ln-228"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">dy</span>                    <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy</span>
<a name="ln-229"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">dz</span>                    <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dz</span>
<a name="ln-230"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">xunit_ratio</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">xunit_ratio</span>
<a name="ln-231"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">yunit_ratio</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">yunit_ratio</span>
<a name="ln-232"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">zunit_ratio</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">zunit_ratio</span>
<a name="ln-233"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">XOffset</span>               <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">XOffset</span>
<a name="ln-234"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">YOffset</span>               <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">YOffset</span>
<a name="ln-235"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span>               <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">ZOffset</span>
<a name="ln-236"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">measurement_duration</span>  <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">measurement_duration</span>
<a name="ln-237"></a>
<a name="ln-238"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">zmin</span>      <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">zmin</span>
<a name="ln-239"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">zmax</span>      <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">zmax</span>
<a name="ln-240"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">xres</span>      <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">xres</span>
<a name="ln-241"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">yres</span>      <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">yres</span>
<a name="ln-242"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">nofpoints</span>
<a name="ln-243"></a>
<a name="ln-244"></a>      <span class="n">surf</span><span class="p">%</span><span class="k">format</span>          <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="k">format</span>
<a name="ln-245"></a><span class="k">      </span><span class="n">surf</span><span class="p">%</span><span class="n">version</span>         <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">version</span>
<a name="ln-246"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">material_code</span>   <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">material_code</span>
<a name="ln-247"></a>      <span class="n">surf</span><span class="p">%</span><span class="k">type</span>            <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="k">type</span>
<a name="ln-248"></a><span class="k">      </span><span class="n">surf</span><span class="p">%</span><span class="nb">range</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="nb">range</span>
<a name="ln-249"></a><span class="nb">      </span><span class="n">surf</span><span class="p">%</span><span class="n">special_points</span>  <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">special_points</span>
<a name="ln-250"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">absolute</span>        <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">absolute</span>
<a name="ln-251"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">pointsize</span>       <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">pointsize</span>
<a name="ln-252"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">imprint</span>         <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">imprint</span>
<a name="ln-253"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">inversion</span>       <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">inversion</span>
<a name="ln-254"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">leveling</span>        <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">leveling</span>
<a name="ln-255"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">seconds</span>         <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">seconds</span>
<a name="ln-256"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">minutes</span>         <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">minutes</span>
<a name="ln-257"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">hours</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">hours</span>
<a name="ln-258"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">day</span>             <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">day</span>
<a name="ln-259"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">month</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">month</span>
<a name="ln-260"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">year</span>            <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">year</span>
<a name="ln-261"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">dayof</span>           <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dayof</span>
<a name="ln-262"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">comment_size</span>    <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">comment_size</span>
<a name="ln-263"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">private_size</span>    <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">private_size</span>
<a name="ln-264"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">nobjects</span>        <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">nobjects</span>
<a name="ln-265"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">acquisition</span>     <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">acquisition</span>
<a name="ln-266"></a>   <span class="k">return</span>
<a name="ln-267"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">scal2surf</span>
<a name="ln-268"></a>
<a name="ln-269"></a>
<a name="ln-270"></a>   <span class="k">subroutine </span><span class="n">surf2scal</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">scal</span><span class="p">)</span>
<a name="ln-271"></a>   <span class="k">implicit none</span>
<a name="ln-272"></a><span class="k">   type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="p">)</span> <span class="kd">::</span> <span class="n">surf</span> <span class="c">!! *object [[OBJ_SURF]]*</span>
<a name="ln-273"></a>   <span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal</span> <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-274"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-275"></a>
<a name="ln-276"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">signature</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-277"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">signature</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-278"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-281"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-282"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-283"></a>
<a name="ln-284"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-285"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-286"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-287"></a>
<a name="ln-288"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-289"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-290"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-291"></a>
<a name="ln-292"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">xaxis</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-293"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">xaxis</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-294"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-295"></a>
<a name="ln-296"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">yaxis</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-297"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">yaxis</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-298"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-299"></a>
<a name="ln-300"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">zaxis</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-301"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">zaxis</span><span class="p">,</span>         <span class="p">&amp;</span>
<a name="ln-302"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-303"></a>
<a name="ln-304"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-305"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-306"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-307"></a>
<a name="ln-308"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-309"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-310"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-311"></a>
<a name="ln-312"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-313"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-314"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-315"></a>
<a name="ln-316"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">object_name</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-317"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">object_name</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-318"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-319"></a>
<a name="ln-320"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">operator_name</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-321"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">operator_name</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-322"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-323"></a>
<a name="ln-324"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">client_zone</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-325"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">client_zone</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-326"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-327"></a>
<a name="ln-328"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">reserved</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-329"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">reserved</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-330"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-331"></a>
<a name="ln-332"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-333"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-334"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-335"></a>
<a name="ln-336"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">obsolete</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-337"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">obsolete</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-338"></a>                 <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-339"></a>
<a name="ln-340"></a>      <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-341"></a>                      <span class="n">fs</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-342"></a>                 <span class="n">borne_s</span> <span class="o">=</span><span class="n">i</span><span class="p">)</span>
<a name="ln-343"></a>
<a name="ln-344"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">dx</span>                    <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx</span>
<a name="ln-345"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">dy</span>                    <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dy</span>
<a name="ln-346"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">dz</span>                    <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz</span>
<a name="ln-347"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">xunit_ratio</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">xunit_ratio</span>
<a name="ln-348"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">yunit_ratio</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">yunit_ratio</span>
<a name="ln-349"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zunit_ratio</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">zunit_ratio</span>
<a name="ln-350"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">XOffset</span>               <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">XOffset</span>
<a name="ln-351"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">YOffset</span>               <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">YOffset</span>
<a name="ln-352"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">ZOffset</span>               <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span>
<a name="ln-353"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">measurement_duration</span>  <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">measurement_duration</span>
<a name="ln-354"></a>
<a name="ln-355"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zmin</span>      <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmin</span>
<a name="ln-356"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zmax</span>      <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmax</span>
<a name="ln-357"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">xres</span>      <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span>
<a name="ln-358"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">yres</span>      <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">yres</span>
<a name="ln-359"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">nofpoints</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span>
<a name="ln-360"></a>
<a name="ln-361"></a>      <span class="n">scal</span><span class="p">%</span><span class="k">format</span>          <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="k">format</span>
<a name="ln-362"></a><span class="k">      </span><span class="n">scal</span><span class="p">%</span><span class="n">version</span>         <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">version</span>
<a name="ln-363"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">material_code</span>   <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">material_code</span>
<a name="ln-364"></a>      <span class="n">scal</span><span class="p">%</span><span class="k">type</span>            <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="k">type</span>
<a name="ln-365"></a><span class="k">      </span><span class="n">scal</span><span class="p">%</span><span class="nb">range</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="nb">range</span>
<a name="ln-366"></a><span class="nb">      </span><span class="n">scal</span><span class="p">%</span><span class="n">special_points</span>  <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">special_points</span>
<a name="ln-367"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">absolute</span>        <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">absolute</span>
<a name="ln-368"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">pointsize</span>       <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">pointsize</span>
<a name="ln-369"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">imprint</span>         <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">imprint</span>
<a name="ln-370"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">inversion</span>       <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">inversion</span>
<a name="ln-371"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">leveling</span>        <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">leveling</span>
<a name="ln-372"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">seconds</span>         <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">seconds</span>
<a name="ln-373"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">minutes</span>         <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">minutes</span>
<a name="ln-374"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">hours</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">hours</span>
<a name="ln-375"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">day</span>             <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">day</span>
<a name="ln-376"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">month</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">month</span>
<a name="ln-377"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">year</span>            <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">year</span>
<a name="ln-378"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">dayof</span>           <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">dayof</span>
<a name="ln-379"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">comment_size</span>    <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">comment_size</span>
<a name="ln-380"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">private_size</span>    <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">private_size</span>
<a name="ln-381"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">nobjects</span>        <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">nobjects</span>
<a name="ln-382"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">acquisition</span>     <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">acquisition</span>
<a name="ln-383"></a>   <span class="k">return</span>
<a name="ln-384"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">surf2scal</span>
<a name="ln-385"></a>
<a name="ln-386"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-387"></a>   <span class="c">!&gt;@note</span>
<a name="ln-388"></a>   <span class="c">!   Just empties a string</span>
<a name="ln-389"></a>   <span class="c">! @endnote</span>
<a name="ln-390"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-391"></a>   <span class="k">subroutine </span><span class="n">empty</span><span class="p">(</span><span class="n">charinout</span><span class="p">)</span>
<a name="ln-392"></a>   <span class="k">implicit none</span>
<a name="ln-393"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">charinout</span>
<a name="ln-394"></a>      <span class="n">charinout</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">charinout</span><span class="p">))</span>
<a name="ln-395"></a>   <span class="k">return</span>
<a name="ln-396"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">empty</span>
<a name="ln-397"></a>
<a name="ln-398"></a>
<a name="ln-399"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-400"></a>   <span class="c">!&lt; @note</span>
<a name="ln-401"></a>   <span class="c">!   Converts a C string to a Fortran string</span>
<a name="ln-402"></a>   <span class="c">!</span>
<a name="ln-403"></a>   <span class="c">!   A From a memory viewpoint, a C string is like a character vector ending with a ```C_NULL_CHAR```, so as long as</span>
<a name="ln-404"></a>   <span class="c">!   it is not found, the characters are copied one by one in a fortran string</span>
<a name="ln-405"></a>   <span class="c">! @endnote</span>
<a name="ln-406"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-407"></a>   <span class="k">subroutine </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">borne_s</span><span class="p">)</span>
<a name="ln-408"></a>   <span class="k">implicit none</span>
<a name="ln-409"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cs</span>   <span class="c">!! *C string*</span>
<a name="ln-410"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fs</span>                      <span class="c">!! *Fortran string*</span>
<a name="ln-411"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">borne_s</span>                 <span class="c">!! *resulting Fortran string length*</span>
<a name="ln-412"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ucs</span>
<a name="ln-413"></a>      <span class="n">ucs</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="c">! vector length</span>
<a name="ln-414"></a>      <span class="n">borne_s</span> <span class="o">=</span> <span class="n">ucs</span>  <span class="c">! resulting string default length</span>
<a name="ln-415"></a>      <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-416"></a>      <span class="k">do</span>
<a name="ln-417"></a><span class="k">         if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">ucs</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-418"></a><span class="k">         if</span> <span class="p">(</span><span class="n">cs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="nb">C_NULL_CHAR</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! fin de chaîne c rencontrée ; s&#39;il n&#39;y a pas de null_char</span>
<a name="ln-419"></a>            <span class="n">borne_s</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>              <span class="c">! c&#39;est qu&#39;on utilise tout le vecteur</span>
<a name="ln-420"></a>            <span class="k">exit</span>
<a name="ln-421"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-422"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-423"></a>      <span class="n">enddo</span>
<a name="ln-424"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
<a name="ln-425"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">borne_s</span> <span class="c">! the C string is translated into fortran</span>
<a name="ln-426"></a>         <span class="n">fs</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-427"></a>      <span class="n">enddo</span>
<a name="ln-428"></a>   <span class="k">return</span>
<a name="ln-429"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">c_f_string</span>
<a name="ln-430"></a>
<a name="ln-431"></a>
<a name="ln-432"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-433"></a>   <span class="c">!&lt; @note</span>
<a name="ln-434"></a>   <span class="c">!   Converts a Fortran string to a C string</span>
<a name="ln-435"></a>   <span class="c">!</span>
<a name="ln-436"></a>   <span class="c">!   A From a memory viewpoint, a C string is like a character vector ending with a ```C_NULL_CHAR```,</span>
<a name="ln-437"></a>   <span class="c">!   so the characters are copied one by one in a ```C_CHAR``` vector that ends with a ```C_NULL_CHAR```</span>
<a name="ln-438"></a>   <span class="c">! @endnote</span>
<a name="ln-439"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-440"></a>   <span class="k">subroutine </span><span class="n">f_c_string</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
<a name="ln-441"></a>   <span class="k">implicit none</span>
<a name="ln-442"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fs</span>                       <span class="c">!! *fortran string*</span>
<a name="ln-443"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cs</span>  <span class="c">!! *resulting C string*</span>
<a name="ln-444"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ufs</span>
<a name="ln-445"></a>      <span class="n">ufs</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>   <span class="c">! longueur de la chaîne fortran sans les null, les blancs, ...</span>
<a name="ln-446"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>     <span class="c">! si la chaîne est vide</span>
<a name="ln-447"></a>         <span class="n">cs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">C_NULL_CHAR</span>
<a name="ln-448"></a><span class="nb">      </span><span class="k">else</span>
<a name="ln-449"></a><span class="k">         do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ufs</span>
<a name="ln-450"></a>            <span class="n">cs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">fs</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-451"></a>         <span class="n">enddo</span>
<a name="ln-452"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="o">&lt;</span><span class="n">size</span><span class="p">(</span><span class="n">cs</span><span class="p">))</span> <span class="n">cs</span><span class="p">(</span><span class="n">ufs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">C_NULL_CHAR</span> <span class="c">! si la fin du vecteur n&#39;est pas atteinte</span>
<a name="ln-453"></a>      <span class="n">endif</span>
<a name="ln-454"></a>   <span class="k">return</span>
<a name="ln-455"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">f_c_string</span>
<a name="ln-456"></a>
<a name="ln-457"></a>
<a name="ln-458"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-459"></a>   <span class="c">!&gt; @note</span>
<a name="ln-460"></a>   <span class="c">!   [[OBJ_SURF]] initialization, every unit is m</span>
<a name="ln-461"></a>   <span class="c">! @endnote</span>
<a name="ln-462"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-463"></a>   <span class="k">subroutine </span><span class="n">init_scal</span><span class="p">(</span><span class="n">scal</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">unit_z</span><span class="p">)</span>
<a name="ln-464"></a>   <span class="k">implicit none</span>
<a name="ln-465"></a><span class="k">   type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal</span> <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-466"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-467"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-468"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lx</span>
<a name="ln-469"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ly</span>
<a name="ln-470"></a>   <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>     <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_z</span>
<a name="ln-471"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">time_val</span>
<a name="ln-472"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="kd">::</span> <span class="n">string</span>
<a name="ln-473"></a>
<a name="ln-474"></a>      <span class="k">call </span><span class="nb">date_and_time</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">time_val</span><span class="p">)</span>
<a name="ln-475"></a>
<a name="ln-476"></a>      <span class="n">scal</span><span class="p">%</span><span class="k">format</span>                <span class="o">=</span> <span class="mi">0</span>
<a name="ln-477"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">nobjects</span>              <span class="o">=</span> <span class="mi">1</span>
<a name="ln-478"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">version</span>               <span class="o">=</span> <span class="mi">1</span>
<a name="ln-479"></a>      <span class="n">scal</span><span class="p">%</span><span class="k">type</span>                  <span class="o">=</span> <span class="mi">2</span>
<a name="ln-480"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">material_code</span>         <span class="o">=</span> <span class="mi">1</span>
<a name="ln-481"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">acquisition</span>           <span class="o">=</span> <span class="mi">0</span>
<a name="ln-482"></a>      <span class="n">scal</span><span class="p">%</span><span class="nb">range</span>                 <span class="o">=</span> <span class="mi">0</span>
<a name="ln-483"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">special_points</span>        <span class="o">=</span> <span class="mi">0</span>
<a name="ln-484"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">absolute</span>              <span class="o">=</span> <span class="mi">1</span>
<a name="ln-485"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">pointsize</span>             <span class="o">=</span> <span class="mi">32</span>
<a name="ln-486"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zmin</span>                  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-487"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zmax</span>                  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-488"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">xres</span>                  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-489"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">yres</span>                  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-490"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">nofpoints</span>             <span class="o">=</span> <span class="mi">0</span>
<a name="ln-491"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">xunit_ratio</span>           <span class="o">=</span> <span class="mf">1.</span>
<a name="ln-492"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">yunit_ratio</span>           <span class="o">=</span> <span class="mf">1.</span>
<a name="ln-493"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zunit_ratio</span>           <span class="o">=</span> <span class="mf">1.</span>
<a name="ln-494"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">imprint</span>               <span class="o">=</span> <span class="mi">0</span>
<a name="ln-495"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">inversion</span>             <span class="o">=</span> <span class="mi">0</span>
<a name="ln-496"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">leveling</span>              <span class="o">=</span> <span class="mi">0</span>
<a name="ln-497"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">seconds</span>               <span class="o">=</span> <span class="n">time_val</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-498"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">minutes</span>               <span class="o">=</span> <span class="n">time_val</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-499"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">hours</span>                 <span class="o">=</span> <span class="n">time_val</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-500"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">day</span>                   <span class="o">=</span> <span class="n">time_val</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-501"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">month</span>                 <span class="o">=</span> <span class="n">time_val</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-502"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">year</span>                  <span class="o">=</span> <span class="n">time_val</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-503"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">dayof</span>                 <span class="o">=</span> <span class="mi">0</span>
<a name="ln-504"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">measurement_duration</span>  <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-505"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">comment_size</span>          <span class="o">=</span> <span class="mi">0</span>
<a name="ln-506"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">private_size</span>          <span class="o">=</span> <span class="mi">0</span>
<a name="ln-507"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">XOffset</span>               <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-508"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">YOffset</span>               <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-509"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">ZOffset</span>               <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-510"></a>
<a name="ln-511"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">reserved</span><span class="p">)</span>
<a name="ln-512"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">)</span>
<a name="ln-513"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">obsolete</span><span class="p">)</span>
<a name="ln-514"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">)</span>
<a name="ln-515"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">client_zone</span><span class="p">)</span>
<a name="ln-516"></a>
<a name="ln-517"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">object_name</span><span class="p">)</span>
<a name="ln-518"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">signature</span><span class="p">)</span>
<a name="ln-519"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">operator_name</span><span class="p">)</span>
<a name="ln-520"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">object_name</span>     <span class="o">=</span> <span class="s1">&#39;HOME MADE&#39;</span>
<a name="ln-521"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">signature</span>       <span class="o">=</span> <span class="s1">&#39;DIGITAL SURF&#39;</span>
<a name="ln-522"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">operator_name</span>   <span class="o">=</span> <span class="s1">&#39;MOD_SURFILE&#39;</span>
<a name="ln-523"></a>
<a name="ln-524"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">xaxis</span><span class="p">)</span>
<a name="ln-525"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">yaxis</span><span class="p">)</span>
<a name="ln-526"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">zaxis</span><span class="p">)</span>
<a name="ln-527"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">xaxis</span>  <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
<a name="ln-528"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">yaxis</span>  <span class="o">=</span> <span class="s2">&quot;Y&quot;</span>
<a name="ln-529"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zaxis</span>  <span class="o">=</span> <span class="s2">&quot;Z&quot;</span>
<a name="ln-530"></a>
<a name="ln-531"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">)</span>
<a name="ln-532"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">)</span>
<a name="ln-533"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">)</span>
<a name="ln-534"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">)</span>
<a name="ln-535"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">)</span>
<a name="ln-536"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">)</span>
<a name="ln-537"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">xlength_unit</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx_unit</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">)</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-538"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">ylength_unit</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy_unit</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">)</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-539"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dz_unit</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">)</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dz</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-540"></a>
<a name="ln-541"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-542"></a>      <span class="n">scal</span><span class="p">%</span><span class="n">si</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-543"></a>
<a name="ln-544"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span> <span class="n">scal</span><span class="p">%</span><span class="n">xres</span> <span class="o">=</span> <span class="n">nx</span>
<a name="ln-545"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">ny</span><span class="p">))</span> <span class="n">scal</span><span class="p">%</span><span class="n">yres</span> <span class="o">=</span> <span class="n">ny</span>
<a name="ln-546"></a>
<a name="ln-547"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">nx</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">lx</span><span class="p">))</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx</span> <span class="o">=</span> <span class="n">lx</span><span class="o">/</span><span class="n">nx</span>
<a name="ln-548"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">ny</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="nb">present</span><span class="p">(</span><span class="n">ly</span><span class="p">))</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy</span> <span class="o">=</span> <span class="n">ly</span><span class="o">/</span><span class="n">ny</span>
<a name="ln-549"></a>
<a name="ln-550"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">unit_z</span><span class="p">))</span> <span class="k">then</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">unit_z</span><span class="p">)</span>
<a name="ln-551"></a>                                  <span class="n">scal</span><span class="p">%</span><span class="n">dz_unit</span>      <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">unit_z</span><span class="p">)</span> <span class="p">;</span> <span class="n">endif</span>
<a name="ln-552"></a>
<a name="ln-553"></a>   <span class="k">return</span>
<a name="ln-554"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">init_scal</span>
<a name="ln-555"></a>
<a name="ln-556"></a>
<a name="ln-557"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-558"></a>   <span class="c">!&lt; @note</span>
<a name="ln-559"></a>   <span class="c">!   Writes an [[OBJ_SURF]] object in a text file</span>
<a name="ln-560"></a>   <span class="c">!</span>
<a name="ln-561"></a>   <span class="c">!   The object components are first written in a fortran string, then it is written into</span>
<a name="ln-562"></a>   <span class="c">!   the file with a comment</span>
<a name="ln-563"></a>   <span class="c">! @endnote</span>
<a name="ln-564"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-565"></a>   <span class="k">subroutine </span><span class="n">trans_surf_txt</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">fichier</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
<a name="ln-566"></a>   <span class="k">implicit none</span>
<a name="ln-567"></a><span class="k">   type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">surf</span>      <span class="c">!! *object [[OBJ_SURF]]*</span>
<a name="ln-568"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fichier</span>   <span class="c">!! *text file to write*</span>
<a name="ln-569"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xyz</span>       <span class="c">!! *whether to also write the heights (maybe huge)*</span>
<a name="ln-570"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span>
<a name="ln-571"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span> <span class="kd">::</span> <span class="n">string</span><span class="p">,</span> <span class="n">cc</span>
<a name="ln-572"></a>
<a name="ln-573"></a>      <span class="k">call </span><span class="n">get_unit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-574"></a>
<a name="ln-575"></a>      <span class="k">open</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">fichier</span><span class="p">))</span>
<a name="ln-576"></a>
<a name="ln-577"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">signature</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-578"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;signature              &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-579"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="k">format</span>                <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;format                 &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-580"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">nobjects</span>              <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;nobjects               &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-581"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">version</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;version                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-582"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="k">type</span>                  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;type                   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-583"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">object_name</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-584"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;object_name            &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-585"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">operator_name</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-586"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;operator_name          &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-587"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">material_code</span>         <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;material_code          &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-588"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">acquisition</span>           <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;acquisition            &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-589"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="nb">range</span>                 <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;range                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-590"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">special_points</span>        <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;special_points         &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-591"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">absolute</span>              <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;absolute               &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-592"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">reserved</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-593"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;reserved               &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-594"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">pointsize</span>             <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;pointsize              &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-595"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmin</span>                  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;zmin                   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-596"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmax</span>                  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;zmax                   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-597"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span>                  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;xres                   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-598"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">yres</span>                  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;yres                   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-599"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span>             <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;nofpoints              &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-600"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx</span>                    <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dx                     &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-601"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">dy</span>                    <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dy                     &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-602"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz</span>                    <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dz                     &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-603"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-604"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;xaxis                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-605"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-606"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;yaxis                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-607"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-608"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;zaxis                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-609"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-610"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dx_unit                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-611"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-612"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dy_unit                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-613"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-614"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dz_unit                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-615"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-616"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;xlength_unit           &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-617"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-618"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;ylength_unit           &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-619"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-620"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;zlength_unit           &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-621"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">xunit_ratio</span>           <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;xunit_ratio            &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-622"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">yunit_ratio</span>           <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;yunit_ratio            &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-623"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">zunit_ratio</span>           <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;zunit_ratio            &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-624"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">imprint</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;imprint                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-625"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">inversion</span>             <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;inversion              &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-626"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">leveling</span>              <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;leveling               &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-627"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">obsolete</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-628"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;obsolete               &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-629"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">seconds</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;seconds                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-630"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">minutes</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;minutes                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-631"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">hours</span>                 <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;hours                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-632"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">day</span>                   <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;day                    &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-633"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">month</span>                 <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;month                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-634"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">year</span>                  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;year                   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-635"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">dayof</span>                 <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;dayof                  &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-636"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">measurement_duration</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;measurement_duration   &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-637"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-638"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;obsolete2              &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-639"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">comment_size</span>          <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;comment_size           &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-640"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">private_size</span>          <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;private_size           &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-641"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">client_zone</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-642"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;client_zone            &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-643"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">XOffset</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;XOffset                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-644"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">YOffset</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;YOffset                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-645"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span>               <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;ZOffset                &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-646"></a>         <span class="k">call </span><span class="n">c_f_string</span><span class="p">(</span><span class="n">cs</span><span class="o">=</span><span class="n">surf</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">borne_s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<a name="ln-647"></a>         <span class="k">write</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="p">)),</span><span class="s1">&#39;&quot;&#39;</span>  <span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;(1x,a,T130,a)&#39;</span><span class="p">)</span> <span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cc</span><span class="p">)),</span> <span class="s2">&quot;reservedzone           &quot;</span> <span class="p">;</span> <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="ln-648"></a>
<a name="ln-649"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-650"></a><span class="k">            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-651"></a>               <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span><span class="p">)</span><span class="o">*</span><span class="n">surf</span><span class="p">%</span><span class="n">dx</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">surf</span><span class="p">%</span><span class="n">xres</span><span class="p">)</span><span class="o">*</span><span class="n">surf</span><span class="p">%</span><span class="n">dy</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">surf</span><span class="p">%</span><span class="n">dz</span>
<a name="ln-652"></a>            <span class="n">enddo</span>
<a name="ln-653"></a>         <span class="n">endif</span>
<a name="ln-654"></a>
<a name="ln-655"></a>      <span class="k">close</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-656"></a>
<a name="ln-657"></a>   <span class="k">return</span>
<a name="ln-658"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">trans_surf_txt</span>
<a name="ln-659"></a>
<a name="ln-660"></a>
<a name="ln-661"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-662"></a>   <span class="c">!&lt; @note</span>
<a name="ln-663"></a>   <span class="c">!   Subroutine that opens a ```.sur``` file and transfers it contents into an object [[OBJ_SURF]]</span>
<a name="ln-664"></a>   <span class="c">! @endnote</span>
<a name="ln-665"></a>   <span class="c">! @warning</span>
<a name="ln-666"></a>   <span class="c">!    By default here, the heights are not written with ```dump=.true.```</span>
<a name="ln-667"></a>   <span class="c">! @endwarning</span>
<a name="ln-668"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-669"></a>   <span class="k">subroutine </span><span class="n">open_surffile</span><span class="p">(</span><span class="n">fichier</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">scal</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
<a name="ln-670"></a>   <span class="k">implicit none</span>
<a name="ln-671"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fichier</span>         <span class="c">!! *file to be read*</span>
<a name="ln-672"></a>   <span class="k">type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">surf</span>            <span class="c">!! *object that will contain the file infos and heights*</span>
<a name="ln-673"></a>   <span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal</span>            <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-674"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dump</span>   <span class="c">!! *whether to transform the data in a text file*</span>
<a name="ln-675"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-676"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">scal_x</span><span class="p">,</span> <span class="n">scal_y</span><span class="p">,</span> <span class="n">scal_z</span>
<a name="ln-677"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">)</span> <span class="kd">::</span> <span class="n">charact</span>
<a name="ln-678"></a>
<a name="ln-679"></a>      <span class="k">call </span><span class="n">get_unit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-680"></a>      <span class="k">open</span><span class="p">(</span><span class="n">k</span> <span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">fichier</span><span class="p">),</span>     <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-681"></a>               <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-682"></a>               <span class="nb">access</span><span class="o">=</span><span class="s2">&quot;stream&quot;</span><span class="p">,</span>        <span class="p">&amp;</span> <span class="c">! beware the &quot;frecord-marker&quot; in other modes</span>
<a name="ln-683"></a>               <span class="n">action</span><span class="o">=</span><span class="s2">&quot;read&quot;</span><span class="p">,</span>          <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-684"></a>               <span class="n">position</span><span class="o">=</span><span class="s2">&quot;rewind&quot;</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-685"></a>               <span class="n">convert</span><span class="o">=</span><span class="s1">&#39;little_endian&#39;</span><span class="p">,&amp;</span> <span class="c">!</span>
<a name="ln-686"></a>               <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-687"></a>
<a name="ln-688"></a>         <span class="k">read</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>  <span class="n">surf</span><span class="p">%</span><span class="n">signature</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="k">format</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">nobjects</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">version</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="k">type</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">object_name</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-689"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">operator_name</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">material_code</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">acquisition</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="nb">range</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">special_points</span><span class="p">,</span>            <span class="p">&amp;</span>
<a name="ln-690"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">absolute</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">reserved</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">pointsize</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmin</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmax</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">yres</span><span class="p">,</span>             <span class="p">&amp;</span>
<a name="ln-691"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dy</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-692"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-693"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">xunit_ratio</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">yunit_ratio</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zunit_ratio</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">imprint</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">inversion</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">leveling</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-694"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">obsolete</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">seconds</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">minutes</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">hours</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">day</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">month</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">year</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dayof</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-695"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">measurement_duration</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">comment_size</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">private_size</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">client_zone</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-696"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">XOffset</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">YOffset</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">reservedzone</span>
<a name="ln-697"></a>
<a name="ln-698"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">comment_size</span>
<a name="ln-699"></a>            <span class="k">read</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="n">charact</span>
<a name="ln-700"></a>         <span class="n">enddo</span>
<a name="ln-701"></a>
<a name="ln-702"></a>         <span class="k">allocate</span><span class="p">(</span> <span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-703"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span>
<a name="ln-704"></a>            <span class="k">read</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-705"></a>         <span class="n">enddo</span>
<a name="ln-706"></a>
<a name="ln-707"></a>      <span class="k">close</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-708"></a>
<a name="ln-709"></a>      <span class="k">call </span><span class="n">surf2scal</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">scal</span><span class="p">)</span>
<a name="ln-710"></a>
<a name="ln-711"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">dump</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="n">dump</span><span class="p">)</span> <span class="k">call </span><span class="n">trans_surf_txt</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="nb">trim</span><span class="p">(</span><span class="n">fichier</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-712"></a>
<a name="ln-713"></a>   <span class="k">return</span>
<a name="ln-714"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">open_surffile</span>
<a name="ln-715"></a>
<a name="ln-716"></a>
<a name="ln-717"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-718"></a>   <span class="c">!&lt; @note</span>
<a name="ln-719"></a>   <span class="c">!   Converts uppercase to lowercase, adapted from [here](http://fortranwiki.org/fortran/show/String_Functions)</span>
<a name="ln-720"></a>   <span class="c">! @endnote</span>
<a name="ln-721"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-722"></a>   <span class="k">function </span><span class="n">lower</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<a name="ln-723"></a>   <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s1</span>   <span class="c">!! *string to transform to lower case*</span>
<a name="ln-724"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span>  <span class="kd">::</span> <span class="n">s2</span>        <span class="c">!! *result: same string but each character is lower case*</span>
<a name="ln-725"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ch</span>
<a name="ln-726"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">duc</span> <span class="o">=</span> <span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<a name="ln-727"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-728"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<a name="ln-729"></a>         <span class="n">ch</span> <span class="o">=</span> <span class="n">s1</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-730"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">&gt;=</span> <span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">ch</span> <span class="o">&lt;=</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="n">ch</span> <span class="o">=</span> <span class="nb">char</span><span class="p">(</span><span class="nb">ichar</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span><span class="o">-</span><span class="n">duc</span><span class="p">)</span>
<a name="ln-731"></a>         <span class="n">s2</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ch</span>
<a name="ln-732"></a>      <span class="n">enddo</span>
<a name="ln-733"></a>   <span class="k">return</span>
<a name="ln-734"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">lower</span>
<a name="ln-735"></a>
<a name="ln-736"></a>   <span class="k">function </span><span class="n">unit2IUc</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">met</span><span class="p">)</span>
<a name="ln-737"></a>   <span class="k">implicit none</span>
<a name="ln-738"></a><span class="k">   </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">met</span>
<a name="ln-739"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">string</span>
<a name="ln-740"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">chaine</span>
<a name="ln-741"></a>      <span class="n">chaine</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">string</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-742"></a>      <span class="n">met</span>    <span class="o">=</span> <span class="n">unit2IUf</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
<a name="ln-743"></a>   <span class="k">return</span>
<a name="ln-744"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">unit2IUc</span>
<a name="ln-745"></a>
<a name="ln-746"></a>   <span class="k">function </span><span class="n">unit2IUf</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">met</span><span class="p">)</span>
<a name="ln-747"></a>   <span class="k">implicit none</span>
<a name="ln-748"></a><span class="k">   </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">met</span>
<a name="ln-749"></a>   <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">string</span>
<a name="ln-750"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a name="ln-751"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;m &#39;</span><span class="p">)</span>
<a name="ln-752"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e+00_R8</span>
<a name="ln-753"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<a name="ln-754"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e-02_R8</span>
<a name="ln-755"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
<a name="ln-756"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e-03_R8</span>
<a name="ln-757"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;µm&#39;</span><span class="p">)</span>
<a name="ln-758"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e-06_R8</span>
<a name="ln-759"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>
<a name="ln-760"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e-09_R8</span>
<a name="ln-761"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;pm&#39;</span><span class="p">)</span>
<a name="ln-762"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e-12_R8</span>
<a name="ln-763"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
<a name="ln-764"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e+00_R8</span>
<a name="ln-765"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;MP&#39;</span><span class="p">)</span>
<a name="ln-766"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e+06_R8</span>
<a name="ln-767"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;GP&#39;</span><span class="p">)</span>
<a name="ln-768"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e+09_R8</span>
<a name="ln-769"></a>         <span class="k">case </span><span class="n">default</span>
<a name="ln-770"></a>            <span class="n">met</span> <span class="o">=</span> <span class="mf">1.e+00_R8</span>
<a name="ln-771"></a>      <span class="n">endselect</span>
<a name="ln-772"></a>   <span class="k">return</span>
<a name="ln-773"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">unit2IUf</span>
<a name="ln-774"></a>
<a name="ln-775"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-776"></a>   <span class="c">!&lt; @note</span>
<a name="ln-777"></a>   <span class="c">!   Subroutine that writes the heights of an [[OBJ_SURF]] object into a 2D array</span>
<a name="ln-778"></a>   <span class="c">! @endnote</span>
<a name="ln-779"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-780"></a>   <span class="k">subroutine </span><span class="n">trans_surf_tab</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">tab</span><span class="p">)</span>
<a name="ln-781"></a>   <span class="k">implicit none</span>
<a name="ln-782"></a><span class="k">   type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">surf</span>                            <span class="c">!! *object ```OBJ_SURF``` that contains the heights*</span>
<a name="ln-783"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tab</span>  <span class="c">!! *height array*</span>
<a name="ln-784"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">long</span><span class="p">,</span> <span class="n">larg</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-785"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">unit_z</span>
<a name="ln-786"></a>
<a name="ln-787"></a>      <span class="nb">long</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span>
<a name="ln-788"></a>      <span class="n">larg</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">yres</span>
<a name="ln-789"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">long</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">larg</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-790"></a>
<a name="ln-791"></a>      <span class="n">unit_z</span> <span class="o">=</span> <span class="n">unit2IUc</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">)</span>
<a name="ln-792"></a>
<a name="ln-793"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">larg</span>
<a name="ln-794"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">long</span>
<a name="ln-795"></a><span class="nb">         </span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">long</span> <span class="o">+</span><span class="n">i</span>
<a name="ln-796"></a>         <span class="n">tab</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">surf</span><span class="p">%</span><span class="n">dz</span><span class="o">+</span> <span class="n">surf</span><span class="p">%</span><span class="n">Zoffset</span><span class="p">)</span><span class="o">*</span><span class="n">unit_z</span>
<a name="ln-797"></a>      <span class="n">enddo</span>
<a name="ln-798"></a>      <span class="n">enddo</span>
<a name="ln-799"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">)</span>
<a name="ln-800"></a>   <span class="k">return</span>
<a name="ln-801"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">trans_surf_tab</span>
<a name="ln-802"></a>
<a name="ln-803"></a>
<a name="ln-804"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-805"></a>   <span class="c">!&lt; @note</span>
<a name="ln-806"></a>   <span class="c">!   Subroutine that opens a surface file ```.sur``` or ```.dat```</span>
<a name="ln-807"></a>   <span class="c">!</span>
<a name="ln-808"></a>   <span class="c">!   The heights are centred, scaled then put into a vector.</span>
<a name="ln-809"></a>   <span class="c">! @endnote</span>
<a name="ln-810"></a>   <span class="c">! @warning</span>
<a name="ln-811"></a>   <span class="c">!    If the scale factor ```sq``` is negative, the heights are not scaled when reading ```.sur```</span>
<a name="ln-812"></a>   <span class="c">! @endwarning</span>
<a name="ln-813"></a>   <span class="c">! @warning</span>
<a name="ln-814"></a>   <span class="c">!    By default, the ```.sur``` header is dumped</span>
<a name="ln-815"></a>   <span class="c">! @endwarning</span>
<a name="ln-816"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-817"></a>   <span class="k">subroutine </span><span class="n">read_surf</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sq</span><span class="p">,</span> <span class="n">tab_s</span><span class="p">,</span> <span class="n">scal</span><span class="p">)</span>
<a name="ln-818"></a>   <span class="k">implicit none</span>
<a name="ln-819"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nom_fic</span>                     <span class="c">!! *file name*</span>
<a name="ln-820"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">mu</span>                          <span class="c">!! *if &gt; 0, values are centered*</span>
<a name="ln-821"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">sq</span>                          <span class="c">!! *desired height standard deviation*</span>
<a name="ln-822"></a>   <span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal</span>                        <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-823"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tab_s</span>  <span class="c">!! *height array*</span>
<a name="ln-824"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">style</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">eof</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-825"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">sqs</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">lz</span>
<a name="ln-826"></a>      <span class="k">type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">surf</span>
<a name="ln-827"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ext</span>
<a name="ln-828"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
<a name="ln-829"></a>
<a name="ln-830"></a>      <span class="n">i</span>   <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">)</span>
<a name="ln-831"></a>      <span class="n">ext</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span> <span class="n">nom_fic</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-832"></a>
<a name="ln-833"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;dat&#39;</span><span class="p">)</span> <span class="n">style</span> <span class="o">=</span> <span class="n">SURF_DAT</span>
<a name="ln-834"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;sur&#39;</span><span class="p">)</span> <span class="n">style</span> <span class="o">=</span> <span class="n">SURF_SUR</span>
<a name="ln-835"></a>
<a name="ln-836"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">style</span><span class="p">)</span>
<a name="ln-837"></a>         <span class="k">case</span> <span class="p">(</span><span class="n">SURF_SUR</span><span class="p">)</span>
<a name="ln-838"></a>            <span class="k">call </span><span class="n">open_surffile</span><span class="p">(</span><span class="n">fichier</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">),</span> <span class="n">surf</span><span class="o">=</span><span class="n">surf</span><span class="p">,</span> <span class="n">scal</span><span class="o">=</span><span class="n">scal</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-839"></a>            <span class="k">call </span><span class="n">trans_surf_tab</span><span class="p">(</span><span class="n">surf</span><span class="o">=</span><span class="n">surf</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">tab_s</span><span class="p">)</span>
<a name="ln-840"></a>
<a name="ln-841"></a>         <span class="k">case</span> <span class="p">(</span><span class="n">SURF_DAT</span><span class="p">)</span>
<a name="ln-842"></a>            <span class="k">call </span><span class="n">get_unit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-843"></a>            <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-844"></a>               <span class="n">nb</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-845"></a>               <span class="k">do</span>
<a name="ln-846"></a><span class="k">                  read</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">eof</span><span class="p">)</span>
<a name="ln-847"></a>                  <span class="k">if</span> <span class="p">(</span> <span class="n">eof</span><span class="o">/=</span><span class="mi">0</span> <span class="p">)</span> <span class="k">exit</span>
<a name="ln-848"></a><span class="k">                  </span><span class="n">nb</span> <span class="o">=</span> <span class="n">nb</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-849"></a>               <span class="n">enddo</span>
<a name="ln-850"></a>            <span class="k">rewind</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-851"></a>               <span class="k">allocate</span><span class="p">(</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-852"></a>               <span class="k">allocate</span><span class="p">(</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-853"></a>               <span class="k">allocate</span><span class="p">(</span> <span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-854"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-855"></a>                  <span class="k">read</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-856"></a>               <span class="n">enddo</span>
<a name="ln-857"></a>            <span class="k">close</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-858"></a>
<a name="ln-859"></a>            <span class="c">! the triplet x, y, z is sorted according x</span>
<a name="ln-860"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-861"></a>            <span class="k">call </span><span class="n">sort_real_2real</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">nb</span><span class="p">,</span> <span class="n">rtabref</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb</span><span class="p">),</span> <span class="n">rtab1</span><span class="o">=</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb</span><span class="p">),</span> <span class="n">rtab2</span><span class="o">=</span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb</span><span class="p">))</span>
<a name="ln-862"></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-863"></a>            <span class="k">do</span>
<a name="ln-864"></a><span class="k">               if</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">*</span><span class="n">EPS_R8</span> <span class="p">)</span> <span class="k">exit</span>
<a name="ln-865"></a><span class="k">               </span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-866"></a>            <span class="n">enddo</span>
<a name="ln-867"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">dx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-868"></a>
<a name="ln-869"></a>            <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-870"></a>            <span class="k">do</span>
<a name="ln-871"></a><span class="k">               if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">&gt;</span><span class="mf">1.0e-10</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-872"></a><span class="k">               </span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-873"></a>            <span class="n">enddo</span>
<a name="ln-874"></a>
<a name="ln-875"></a>            <span class="n">ny</span> <span class="o">=</span> <span class="n">j</span> <span class="c">! number of same abscissae for a given column</span>
<a name="ln-876"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="o">/=</span><span class="mi">0</span> <span class="p">)</span> <span class="k">STOP</span> <span class="s1">&#39;READ_SURF, non rectangular mesh&#39;</span>
<a name="ln-877"></a>
<a name="ln-878"></a>            <span class="n">nx</span> <span class="o">=</span> <span class="n">nb</span><span class="o">/</span><span class="n">ny</span>
<a name="ln-879"></a>
<a name="ln-880"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">xres</span> <span class="o">=</span> <span class="n">nx</span>
<a name="ln-881"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">yres</span> <span class="o">=</span> <span class="n">ny</span>
<a name="ln-882"></a>
<a name="ln-883"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nx</span>
<a name="ln-884"></a>               <span class="n">ii</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-885"></a>               <span class="n">jj</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span><span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-886"></a>               <span class="k">call </span><span class="n">sort_real_1real</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">ny</span><span class="p">,</span> <span class="n">rtabref</span><span class="o">=</span><span class="n">y</span><span class="p">(</span><span class="n">ii</span><span class="p">:</span><span class="n">jj</span><span class="p">),</span> <span class="n">rtab1</span><span class="o">=</span><span class="n">z</span><span class="p">(</span><span class="n">ii</span><span class="p">:</span><span class="n">jj</span><span class="p">))</span>
<a name="ln-887"></a>            <span class="n">enddo</span>
<a name="ln-888"></a>
<a name="ln-889"></a>            <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-890"></a>            <span class="k">do</span>
<a name="ln-891"></a><span class="k">               if</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">*</span><span class="n">EPS_R8</span> <span class="p">)</span> <span class="k">exit</span>
<a name="ln-892"></a><span class="k">               </span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-893"></a>            <span class="n">enddo</span>
<a name="ln-894"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">dy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-895"></a>
<a name="ln-896"></a>            <span class="k">allocate</span><span class="p">(</span> <span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-897"></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-898"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nx</span>
<a name="ln-899"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-900"></a>                  <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-901"></a>                  <span class="n">tab_s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">z</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-902"></a>               <span class="n">enddo</span>
<a name="ln-903"></a>            <span class="n">enddo</span>
<a name="ln-904"></a>
<a name="ln-905"></a>            <span class="n">lx</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-906"></a>            <span class="n">ly</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>     <span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a name="ln-907"></a>            <span class="n">lz</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">tab_s</span><span class="p">)</span> <span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">tab_s</span><span class="p">)</span>
<a name="ln-908"></a>
<a name="ln-909"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">dz</span> <span class="o">=</span> <span class="n">lz</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>
<a name="ln-910"></a>
<a name="ln-911"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">xlength_unit</span> <span class="o">=</span> <span class="s1">&#39;m &#39;</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx_unit</span> <span class="o">=</span> <span class="s1">&#39;m &#39;</span>
<a name="ln-912"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">ylength_unit</span> <span class="o">=</span> <span class="s1">&#39;m &#39;</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy_unit</span> <span class="o">=</span> <span class="s1">&#39;m &#39;</span>
<a name="ln-913"></a>            <span class="n">scal</span><span class="p">%</span><span class="n">zlength_unit</span> <span class="o">=</span> <span class="s1">&#39;m &#39;</span> <span class="p">;</span> <span class="n">scal</span><span class="p">%</span><span class="n">dz_unit</span> <span class="o">=</span> <span class="s1">&#39;m &#39;</span>
<a name="ln-914"></a>            <span class="c">!call sort_real(g=1, d=nx*ny, rtabref=z(1:nx*ny))</span>
<a name="ln-915"></a>            <span class="c">!scal%dz = 1.e+10</span>
<a name="ln-916"></a>            <span class="c">!do i = 2, nx*ny</span>
<a name="ln-917"></a>            <span class="c">!   dz = z(i) -z(i-1)</span>
<a name="ln-918"></a>            <span class="c">!   if (abs(dz) &lt; 100*EPS_R8) cycle</span>
<a name="ln-919"></a>            <span class="c">!   scal%dz = min(scal%dz, dz)</span>
<a name="ln-920"></a>            <span class="c">!enddo</span>
<a name="ln-921"></a>            <span class="c">!scal%dz = dz</span>
<a name="ln-922"></a>
<a name="ln-923"></a>            <span class="k">deallocate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<a name="ln-924"></a>      <span class="n">endselect</span>
<a name="ln-925"></a>
<a name="ln-926"></a>      <span class="n">nx</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">xres</span>
<a name="ln-927"></a>      <span class="n">ny</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">yres</span>
<a name="ln-928"></a>
<a name="ln-929"></a>      <span class="c">! centering ?</span>
<a name="ln-930"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mu</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-931"></a><span class="k">         </span><span class="n">mean</span>    <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">)</span>
<a name="ln-932"></a>         <span class="n">scal</span><span class="p">%</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mean</span>
<a name="ln-933"></a>         <span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="o">=</span> <span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="o">-</span><span class="n">mean</span>
<a name="ln-934"></a>      <span class="n">endif</span>
<a name="ln-935"></a>
<a name="ln-936"></a>      <span class="c">! scaling ?</span>
<a name="ln-937"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">sq</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-938"></a><span class="k">         </span><span class="n">sqs</span>     <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.5_R8</span><span class="p">)</span>
<a name="ln-939"></a>         <span class="n">scal</span><span class="p">%</span><span class="n">si</span> <span class="o">=</span> <span class="n">sqs</span>
<a name="ln-940"></a>         <span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="o">=</span> <span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span> <span class="n">sq</span> <span class="o">/</span> <span class="n">sqs</span>
<a name="ln-941"></a>      <span class="n">endif</span>
<a name="ln-942"></a>
<a name="ln-943"></a>   <span class="k">return</span>
<a name="ln-944"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">read_surf</span>
<a name="ln-945"></a>
<a name="ln-946"></a>
<a name="ln-947"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-948"></a>   <span class="c">!&lt; @note</span>
<a name="ln-949"></a>   <span class="c">!   Subroutine that creates an object [[OBJ_SURF]]</span>
<a name="ln-950"></a>   <span class="c">! @endnote</span>
<a name="ln-951"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-952"></a>   <span class="k">subroutine </span><span class="n">build_surf</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">tab</span><span class="p">)</span>
<a name="ln-953"></a>   <span class="k">implicit none</span>
<a name="ln-954"></a><span class="k">   type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">surf</span>  <span class="c">!! *resulting object ```OBJ_SURF```*</span>
<a name="ln-955"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">surf</span><span class="p">%</span><span class="n">xres</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">surf</span><span class="p">%</span><span class="n">yres</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tab</span>
<a name="ln-956"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-957"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">max_n</span><span class="p">,</span> <span class="n">min_t</span><span class="p">,</span> <span class="n">max_t</span><span class="p">,</span> <span class="n">mil_t</span><span class="p">,</span> <span class="n">amp_t</span><span class="p">,</span> <span class="n">unit_x</span><span class="p">,</span> <span class="n">unit_y</span><span class="p">,</span> <span class="n">unit_z</span>
<a name="ln-958"></a>
<a name="ln-959"></a>      <span class="n">nx</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span>
<a name="ln-960"></a>      <span class="n">ny</span> <span class="o">=</span> <span class="n">surf</span><span class="p">%</span><span class="n">yres</span>
<a name="ln-961"></a>
<a name="ln-962"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span> <span class="o">=</span> <span class="n">nx</span><span class="o">*</span><span class="n">ny</span>
<a name="ln-963"></a>
<a name="ln-964"></a>      <span class="n">unit_x</span> <span class="o">=</span> <span class="n">unit2IUc</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">)</span>
<a name="ln-965"></a>      <span class="n">unit_y</span> <span class="o">=</span> <span class="n">unit2IUc</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">)</span>
<a name="ln-966"></a>      <span class="n">unit_z</span> <span class="o">=</span> <span class="n">unit2IUc</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">)</span>
<a name="ln-967"></a>
<a name="ln-968"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">)</span>
<a name="ln-969"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span><span class="p">))</span>
<a name="ln-970"></a>
<a name="ln-971"></a>      <span class="n">min_t</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span> <span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="n">unit_z</span>
<a name="ln-972"></a>      <span class="n">max_t</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span> <span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="n">unit_z</span>
<a name="ln-973"></a>
<a name="ln-974"></a>      <span class="n">mil_t</span> <span class="o">=</span> <span class="mf">0.5_R8</span><span class="o">*</span><span class="p">(</span><span class="n">min_t</span> <span class="o">+</span><span class="n">max_t</span><span class="p">)</span> <span class="c">! middle of the range</span>
<a name="ln-975"></a>      <span class="n">amp_t</span> <span class="o">=</span> <span class="n">max_t</span> <span class="o">-</span><span class="n">min_t</span>          <span class="c">! range amplitude</span>
<a name="ln-976"></a>
<a name="ln-977"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span> <span class="o">=</span> <span class="n">mil_t</span>
<a name="ln-978"></a>
<a name="ln-979"></a>      <span class="n">max_n</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">huge</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="c">! the heights are integers, allowed to span</span>
<a name="ln-980"></a>                              <span class="c">! half the positive integer range.</span>
<a name="ln-981"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">dz</span> <span class="o">=</span> <span class="n">amp_t</span><span class="o">/</span><span class="n">max_n</span>   <span class="c">! subsequent dz</span>
<a name="ln-982"></a>
<a name="ln-983"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-984"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-985"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nx</span>
<a name="ln-986"></a>         <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-987"></a>         <span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="p">(</span><span class="n">tab</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">unit_z</span> <span class="o">-</span><span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span><span class="p">)</span><span class="o">/</span><span class="n">surf</span><span class="p">%</span><span class="n">dz</span> <span class="p">)</span> <span class="c">!</span>
<a name="ln-988"></a>      <span class="n">enddo</span>
<a name="ln-989"></a>      <span class="n">enddo</span>
<a name="ln-990"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">zmin</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">)</span>
<a name="ln-991"></a>      <span class="n">surf</span><span class="p">%</span><span class="n">zmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">)</span>
<a name="ln-992"></a>
<a name="ln-993"></a>   <span class="k">return</span>
<a name="ln-994"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">build_surf</span>
<a name="ln-995"></a>
<a name="ln-996"></a>
<a name="ln-997"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-998"></a>   <span class="c">!&lt; @note</span>
<a name="ln-999"></a>   <span class="c">!   Subroutine that writes an object [[OBJ_SURF]] in a file</span>
<a name="ln-1000"></a>   <span class="c">! @endnote</span>
<a name="ln-1001"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1002"></a>   <span class="k">subroutine </span><span class="n">write_surffile</span><span class="p">(</span><span class="n">fichier</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>
<a name="ln-1003"></a>   <span class="k">implicit none</span>
<a name="ln-1004"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fichier</span>  <span class="c">!! *file to be written*</span>
<a name="ln-1005"></a>   <span class="k">type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">surf</span>     <span class="c">!! *object ```OBJ_SURF``` to write*</span>
<a name="ln-1006"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-1007"></a>
<a name="ln-1008"></a>      <span class="k">call </span><span class="n">get_unit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1009"></a>      <span class="k">open</span><span class="p">(</span><span class="n">k</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">fichier</span><span class="p">),</span>     <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1010"></a>               <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1011"></a>               <span class="nb">access</span><span class="o">=</span><span class="s2">&quot;stream&quot;</span><span class="p">,</span>        <span class="p">&amp;</span> <span class="c">! beware the &quot;frecord-marker&quot; in other modes</span>
<a name="ln-1012"></a>               <span class="n">action</span><span class="o">=</span><span class="s2">&quot;write&quot;</span><span class="p">,</span>         <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1013"></a>               <span class="n">position</span><span class="o">=</span><span class="s2">&quot;rewind&quot;</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1014"></a>               <span class="n">status</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1015"></a>               <span class="n">convert</span><span class="o">=</span><span class="s1">&#39;little_endian&#39;</span><span class="p">)</span>
<a name="ln-1016"></a>
<a name="ln-1017"></a>         <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="n">surf</span><span class="p">%</span><span class="n">signature</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="k">format</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">nobjects</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">version</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="k">type</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">object_name</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-1018"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">operator_name</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">material_code</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">acquisition</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="nb">range</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">special_points</span><span class="p">,</span>            <span class="p">&amp;</span>
<a name="ln-1019"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">absolute</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">reserved</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">pointsize</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmin</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zmax</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xres</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">yres</span><span class="p">,</span>             <span class="p">&amp;</span>
<a name="ln-1020"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dy</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dx_unit</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-1021"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">dy_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dz_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">xlength_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">ylength_unit</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zlength_unit</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-1022"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">xunit_ratio</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">yunit_ratio</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">zunit_ratio</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">imprint</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">inversion</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">leveling</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1023"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">obsolete</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">seconds</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">minutes</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">hours</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">day</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">month</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">year</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">dayof</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1024"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">measurement_duration</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">obsolete2</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">comment_size</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">private_size</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">client_zone</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1025"></a>                  <span class="n">surf</span><span class="p">%</span><span class="n">XOffset</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">YOffset</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">ZOffset</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">reservedzone</span><span class="p">,</span>                                          <span class="p">&amp;</span>
<a name="ln-1026"></a>                  <span class="p">(</span><span class="n">surf</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">surf</span><span class="p">%</span><span class="n">nofpoints</span><span class="p">)</span>
<a name="ln-1027"></a>      <span class="k">close</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1028"></a>
<a name="ln-1029"></a>   <span class="k">return</span>
<a name="ln-1030"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">write_surffile</span>
<a name="ln-1031"></a>
<a name="ln-1032"></a>
<a name="ln-1033"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1034"></a>   <span class="c">!&lt; @note</span>
<a name="ln-1035"></a>   <span class="c">!   Subroutine that writes a height array into a surface file ```.sur``` or ```.dat```</span>
<a name="ln-1036"></a>   <span class="c">! @endnote</span>
<a name="ln-1037"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1038"></a>   <span class="k">subroutine </span><span class="n">write_surf</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">,</span> <span class="n">tab_s</span><span class="p">,</span> <span class="n">scal</span><span class="p">)</span>
<a name="ln-1039"></a>   <span class="k">implicit none</span>
<a name="ln-1040"></a><span class="k">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">nom_fic</span>   <span class="c">!! *file name*</span>
<a name="ln-1041"></a>   <span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal</span>      <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-1042"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">scal</span><span class="p">%</span><span class="n">xres</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">scal</span><span class="p">%</span><span class="n">yres</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tab_s</span>
<a name="ln-1043"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ext</span>
<a name="ln-1044"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">style</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-1045"></a>      <span class="k">type</span><span class="p">(</span><span class="n">OBJ_SURF</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">surf_s</span>
<a name="ln-1046"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span>
<a name="ln-1047"></a>
<a name="ln-1048"></a>      <span class="n">i</span>   <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">)</span>
<a name="ln-1049"></a>      <span class="n">ext</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span> <span class="n">nom_fic</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1050"></a>
<a name="ln-1051"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;dat&#39;</span><span class="p">)</span> <span class="n">style</span> <span class="o">=</span> <span class="n">SURF_DAT</span>
<a name="ln-1052"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;sur&#39;</span><span class="p">)</span> <span class="n">style</span> <span class="o">=</span> <span class="n">SURF_SUR</span>
<a name="ln-1053"></a>
<a name="ln-1054"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">style</span><span class="p">)</span>
<a name="ln-1055"></a>         <span class="k">case</span> <span class="p">(</span><span class="n">SURF_SUR</span><span class="p">)</span>
<a name="ln-1056"></a>            <span class="k">call </span><span class="n">scal2surf</span><span class="p">(</span><span class="n">scal</span><span class="p">,</span> <span class="n">surf_s</span><span class="p">)</span>
<a name="ln-1057"></a>            <span class="k">call </span><span class="n">build_surf</span><span class="p">(</span><span class="n">surf</span><span class="o">=</span><span class="n">surf_s</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">scal</span><span class="p">%</span><span class="n">xres</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">scal</span><span class="p">%</span><span class="n">yres</span><span class="p">))</span>
<a name="ln-1058"></a>            <span class="n">surf_s</span><span class="p">%</span><span class="n">comment_size</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! to increase compatibility with mountains</span>
<a name="ln-1059"></a>            <span class="k">call </span><span class="n">write_surffile</span><span class="p">(</span><span class="n">fichier</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">),</span> <span class="n">surf</span><span class="o">=</span><span class="n">surf_s</span><span class="p">)</span>
<a name="ln-1060"></a>            <span class="k">call </span><span class="n">surf2scal</span><span class="p">(</span><span class="n">surf_s</span><span class="p">,</span> <span class="n">scal</span><span class="p">)</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a>         <span class="k">case</span> <span class="p">(</span><span class="n">SURF_DAT</span><span class="p">)</span>
<a name="ln-1063"></a>            <span class="n">dx</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dx</span>
<a name="ln-1064"></a>            <span class="n">dy</span> <span class="o">=</span> <span class="n">scal</span><span class="p">%</span><span class="n">dy</span>
<a name="ln-1065"></a>            <span class="k">call </span><span class="n">get_unit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1066"></a>            <span class="k">open</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nom_fic</span><span class="p">))</span>
<a name="ln-1067"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scal</span><span class="p">%</span><span class="n">xres</span>
<a name="ln-1068"></a>                  <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scal</span><span class="p">%</span><span class="n">yres</span>
<a name="ln-1069"></a>                     <span class="k">write</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">tab_s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-1070"></a>                  <span class="n">enddo</span>
<a name="ln-1071"></a>               <span class="n">enddo</span>
<a name="ln-1072"></a>            <span class="k">close</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1073"></a>      <span class="n">endselect</span>
<a name="ln-1074"></a>   <span class="k">return</span>
<a name="ln-1075"></a>
<a name="ln-1076"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">write_surf</span>
<a name="ln-1077"></a>
<a name="ln-1078"></a>
<a name="ln-1079"></a><span class="n">endmodule</span> <span class="n">surfile</span>
<a name="ln-1080"></a>
<a name="ln-1081"></a><span class="c">!============ EN TETE TYPIQUE</span>
<a name="ln-1082"></a><span class="c">!~  &quot;DIGITAL SURF&quot;</span>
<a name="ln-1083"></a><span class="c">!~  0</span>
<a name="ln-1084"></a><span class="c">!~  1</span>
<a name="ln-1085"></a><span class="c">!~  1</span>
<a name="ln-1086"></a><span class="c">!~  2</span>
<a name="ln-1087"></a><span class="c">!~  &quot;* 16-774-lm1-pnm bouches *&quot;</span>
<a name="ln-1088"></a><span class="c">!~  &quot;&quot;</span>
<a name="ln-1089"></a><span class="c">!~  0</span>
<a name="ln-1090"></a><span class="c">!~  0</span>
<a name="ln-1091"></a><span class="c">!~  0</span>
<a name="ln-1092"></a><span class="c">!~  0</span>
<a name="ln-1093"></a><span class="c">!~  1</span>
<a name="ln-1094"></a><span class="c">!~  &quot;&quot;</span>
<a name="ln-1095"></a><span class="c">!~  32</span>
<a name="ln-1096"></a><span class="c">!~  -19122091</span>
<a name="ln-1097"></a><span class="c">!~  4341882</span>
<a name="ln-1098"></a><span class="c">!~  512</span>
<a name="ln-1099"></a><span class="c">!~  512</span>
<a name="ln-1100"></a><span class="c">!~  262144</span>
<a name="ln-1101"></a><span class="c">!~  3.55476077E-04</span>
<a name="ln-1102"></a><span class="c">!~  3.54291551E-04</span>
<a name="ln-1103"></a><span class="c">!~  3.25564076E-10</span>
<a name="ln-1104"></a><span class="c">!~  &quot;X&quot;</span>
<a name="ln-1105"></a><span class="c">!~  &quot;Y&quot;</span>
<a name="ln-1106"></a><span class="c">!~  &quot;Z&quot;</span>
<a name="ln-1107"></a><span class="c">!~  &quot;mm&quot;</span>
<a name="ln-1108"></a><span class="c">!~  &quot;mm&quot;</span>
<a name="ln-1109"></a><span class="c">!~  &quot;mm&quot;</span>
<a name="ln-1110"></a><span class="c">!~  &quot;mm&quot;</span>
<a name="ln-1111"></a><span class="c">!~  &quot;mm&quot;</span>
<a name="ln-1112"></a><span class="c">!~  &quot;mm&quot;</span>
<a name="ln-1113"></a><span class="c">!~  1.00000000</span>
<a name="ln-1114"></a><span class="c">!~  1.00000000</span>
<a name="ln-1115"></a><span class="c">!~  1.00000000</span>
<a name="ln-1116"></a><span class="c">!~  0</span>
<a name="ln-1117"></a><span class="c">!~  0</span>
<a name="ln-1118"></a><span class="c">!~  0</span>
<a name="ln-1119"></a><span class="c">!~  &quot;&quot;</span>
<a name="ln-1120"></a><span class="c">!~  0</span>
<a name="ln-1121"></a><span class="c">!~  0</span>
<a name="ln-1122"></a><span class="c">!~  0</span>
<a name="ln-1123"></a><span class="c">!~  0</span>
<a name="ln-1124"></a><span class="c">!~  0</span>
<a name="ln-1125"></a><span class="c">!~  0</span>
<a name="ln-1126"></a><span class="c">!~  0</span>
<a name="ln-1127"></a><span class="c">!~  0.00000000</span>
<a name="ln-1128"></a><span class="c">!~  &quot;&quot;</span>
<a name="ln-1129"></a><span class="c">!~  0</span>
<a name="ln-1130"></a><span class="c">!~  0</span>
<a name="ln-1131"></a><span class="c">!~  &quot;&quot;</span>
<a name="ln-1132"></a><span class="c">!~   0.00000000</span>
<a name="ln-1133"></a><span class="c">!~   0.00000000</span>
<a name="ln-1134"></a><span class="c">!~  -0.00000000</span>
<a name="ln-1135"></a><span class="c">!~  &quot;&quot;</span>
<a name="ln-1136"></a><span class="c">!~</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-04-16 15:48  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> MUSST was developed by Noël Brunetière - Arthur Francisco</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>