<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="MUSST – A modern Fortran MUltiScale Simulation Tribology solver">
    
    <meta name="author" content="Noël Brunetière - Arthur Francisco" >
    <link rel="icon" href="../favicon.png">

    <title>mod_film.f90 &ndash; MUSST</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    
    <link href="../css/user.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">MUSST </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>mod_film.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     <li><i class="fa fa-pencil"></i> Noël Brunetière<br/>&emsp;Arthur Francisco</li>
     
     
    <li><i class="fa fa-calendar-o"></i> April,17 2017</li>
     
     
     
    <li><i class="fa fa-barcode"></i> 1.0.0</li>
    
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 8.2% of total for source files.">782 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/mod_film.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">mod_film.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/film.html">film</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_film.f90.html#src">mod_film.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~mod_film.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemod_filmf90EfferentGraph" width="501pt" height="454pt"
 viewBox="0.00 0.00 501.00 454.36" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_film.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 450.3616)">
<title>sourcefile~~mod_film.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-450.3616 497,-450.3616 497,4 -4,4"/>
<!-- sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~mod_film.f90</title>
<polygon fill="none" stroke="#000000" points="493,-302.3616 421,-302.3616 421,-278.3616 493,-278.3616 493,-302.3616"/>
<text text-anchor="middle" x="457" y="-287.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">mod_film.f90</text>
</g>
<!-- sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~mod_fluid.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mod_fluid.f90.html" xlink:title="mod_fluid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="232.5,-363.3616 157.5,-363.3616 157.5,-339.3616 232.5,-339.3616 232.5,-363.3616"/>
<text text-anchor="middle" x="195" y="-348.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_fluid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M420.9396,-298.4432C386.3108,-306.2377 332.5394,-318.4293 286,-329.3616 271.8668,-332.6815 256.5179,-336.363 242.5223,-339.7495"/>
<polygon fill="#ff0000" stroke="#ff0000" points="241.5006,-336.3957 232.6071,-342.1539 243.1503,-343.1986 241.5006,-336.3957"/>
</g>
<!-- sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mod_num_par.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mod_num_par.f90.html" xlink:title="mod_num_par.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-446.3616 287,-446.3616 287,-422.3616 384,-422.3616 384,-446.3616"/>
<text text-anchor="middle" x="335.5" y="-431.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_num_par.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_num_par.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_num_par.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M452.8564,-302.5577C444.0442,-326.812 421.236,-381.502 385,-413.3616 383.5278,-414.656 381.964,-415.8794 380.3335,-417.0347"/>
<polygon fill="#ff0000" stroke="#ff0000" points="378.469,-414.0721 371.7416,-422.2571 382.1048,-420.0538 378.469,-414.0721"/>
</g>
<!-- sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~mod_surfile.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/mod_surfile.f90.html" xlink:title="mod_surfile.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-282.3616 293.5,-282.3616 293.5,-258.3616 377.5,-258.3616 377.5,-282.3616"/>
<text text-anchor="middle" x="335.5" y="-267.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_surfile.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_surfile.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M420.875,-284.4151C410.4851,-282.7048 398.9384,-280.8041 387.7805,-278.9674"/>
<polygon fill="#ff0000" stroke="#ff0000" points="388.1228,-275.4768 377.6871,-277.306 386.9858,-282.3838 388.1228,-275.4768"/>
</g>
<!-- sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~mod_mesh.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/mod_mesh.f90.html" xlink:title="mod_mesh.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="376.5,-404.3616 294.5,-404.3616 294.5,-380.3616 376.5,-380.3616 376.5,-404.3616"/>
<text text-anchor="middle" x="335.5" y="-389.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_mesh.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_mesh.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_mesh.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M448.8022,-302.6063C436.6587,-319.9441 412.3577,-351.7193 385,-371.3616 382.9431,-372.8384 380.7664,-374.238 378.5183,-375.5602"/>
<polygon fill="#ff0000" stroke="#ff0000" points="376.8018,-372.5086 369.5962,-380.2758 380.0728,-378.6973 376.8018,-372.5086"/>
</g>
<!-- sourcefile~mod_elements.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~mod_elements.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/mod_elements.f90.html" xlink:title="mod_elements.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="385,-77.3616 286,-77.3616 286,-53.3616 385,-53.3616 385,-77.3616"/>
<text text-anchor="middle" x="335.5" y="-62.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_elements.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_elements.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_elements.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M450.4676,-278.2646C430.7722,-241.7916 371.7957,-132.5758 346.8458,-86.3724"/>
<polygon fill="#ff0000" stroke="#ff0000" points="349.8959,-84.6544 342.0647,-77.5184 343.7365,-87.9805 349.8959,-84.6544"/>
</g>
<!-- sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~mod_data_arch.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/mod_data_arch.f90.html" xlink:title="mod_data_arch.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="104,-283.3616 0,-283.3616 0,-259.3616 104,-259.3616 104,-283.3616"/>
<text text-anchor="middle" x="52" y="-268.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_data_arch.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M455.2257,-278.0713C448.4101,-232.6676 422.4062,-75.415 385,-44.3616 319.7029,9.846 271.3645,11.6605 195,-25.3616"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M195,-25.3616C171.7881,-36.7655 158.6242,-26.4178 140,-44.3616 80.3716,-101.8116 60.4713,-204.2622 54.4139,-249.2007"/>
<polygon fill="#ff0000" stroke="#ff0000" points="50.9158,-248.9691 53.1563,-259.3243 57.8625,-249.832 50.9158,-248.9691"/>
</g>
<!-- sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~mod_solver.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/mod_solver.f90.html" xlink:title="mod_solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="378,-201.3616 293,-201.3616 293,-177.3616 378,-177.3616 378,-201.3616"/>
<text text-anchor="middle" x="335.5" y="-186.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_solver.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M442.1017,-277.977C421.0371,-260.4665 382.3884,-228.3388 357.8686,-207.9561"/>
<polygon fill="#ff0000" stroke="#ff0000" points="360.068,-205.233 350.1406,-201.532 355.5933,-210.616 360.068,-205.233"/>
</g>
<!-- sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~mod_data.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/mod_data.f90.html" xlink:title="mod_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-362.3616 297,-362.3616 297,-338.3616 374,-338.3616 374,-362.3616"/>
<text text-anchor="middle" x="335.5" y="-347.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~mod_film.f90&#45;&gt;sourcefile~mod_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M432.4127,-302.5035C414.2149,-311.49 389.2106,-323.8379 369.1585,-333.7401"/>
<polygon fill="#ff0000" stroke="#ff0000" points="367.4673,-330.6717 360.0508,-338.2378 370.5668,-336.9481 367.4673,-330.6717"/>
</g>
<!-- sourcefile~mod_fluid.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~mod_fluid.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M167.8525,-339.2428C158.8813,-335.0495 148.9175,-330.1869 140,-325.3616 119.0573,-314.0294 96.1533,-299.9172 78.9629,-288.9616"/>
<polygon fill="#ff0000" stroke="#ff0000" points="80.841,-286.0082 70.5349,-283.5518 77.0598,-291.8991 80.841,-286.0082"/>
</g>
<!-- sourcefile~mod_num_par.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~mod_num_par.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M290.1184,-422.3047C262.3731,-414.5621 226.3162,-403.833 195,-392.3616"/>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M297.168,-282.4186C282.5619,-286.4303 265.6621,-290.3789 250,-292.3616 201.4982,-298.5016 188.5539,-298.0747 140,-292.3616 128.0569,-290.9563 115.3864,-288.5132 103.4919,-285.7788"/>
<polygon fill="#7fff00" stroke="#7fff00" points="104.2569,-282.3631 93.7159,-283.4298 102.6214,-289.1694 104.2569,-282.3631"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~mod_sort_arrays.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/mod_sort_arrays.f90.html" xlink:title="mod_sort_arrays.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="250,-283.3616 140,-283.3616 140,-259.3616 250,-259.3616 250,-283.3616"/>
<text text-anchor="middle" x="195" y="-268.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_sort_arrays.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~mod_surfile.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M293.3454,-270.6616C282.9486,-270.7356 271.5688,-270.8166 260.3561,-270.8964"/>
<polygon fill="#7fff00" stroke="#7fff00" points="260.1135,-267.398 250.1387,-270.9691 260.1634,-274.3978 260.1135,-267.398"/>
</g>
<!-- sourcefile~mod_mesh.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mod_mesh.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ff3f" stroke-dasharray="5,2" d="M294.2333,-399.6694C265.5222,-403.0214 226.8367,-404.0236 195,-392.3616"/>
</g>
<!-- sourcefile~mod_elements.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~mod_elements.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M309.0932,-53.3599C274.2947,-38.3111 215.1396,-15.5977 195,-25.3616"/>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M292.8894,-187.2468C252.2975,-186.663 190.1233,-189.5463 140,-208.3616 113.9986,-218.122 88.6856,-237.6143 71.9344,-252.3463"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="69.5009,-249.8281 64.4334,-259.1325 74.1971,-255.019 69.5009,-249.8281"/>
</g>
<!-- sourcefile~superlu.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~superlu.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/superlu.f90.html" xlink:title="superlu.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="227,-77.3616 163,-77.3616 163,-53.3616 227,-53.3616 227,-77.3616"/>
<text text-anchor="middle" x="195" y="-62.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">superlu.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~superlu.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~superlu.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M328.335,-177.1433C315.2966,-155.8868 285.714,-111.9312 250,-86.3616 245.8473,-83.3885 241.2203,-80.7759 236.4623,-78.4964"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="237.8097,-75.2659 227.2414,-74.5162 235.0355,-81.6927 237.8097,-75.2659"/>
</g>
<!-- sourcefile~dmumps_struc.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~dmumps_struc.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/dmumps_struc.f90.html" xlink:title="dmumps_struc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="243.5,-161.3616 146.5,-161.3616 146.5,-137.3616 243.5,-137.3616 243.5,-161.3616"/>
<text text-anchor="middle" x="195" y="-146.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dmumps_struc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~dmumps_struc.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~dmumps_struc.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M293.3454,-177.3603C278.8906,-173.245 262.5358,-168.5889 247.3717,-164.2717"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="248.1867,-160.8647 237.6105,-161.4927 246.2699,-167.5972 248.1867,-160.8647"/>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_sort_arrays.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_sort_arrays.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M321.1189,-201.3746C304.7066,-214.655 276.6757,-236.0571 250,-250.3616 246.746,-252.1065 243.3152,-253.7771 239.8222,-255.3597"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="238.3335,-252.1895 230.5097,-259.3336 241.081,-258.6278 238.3335,-252.1895"/>
</g>
<!-- sourcefile~mod_gen_par.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~mod_gen_par.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/mod_gen_par.f90.html" xlink:title="mod_gen_par.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="243,-241.3616 147,-241.3616 147,-217.3616 243,-217.3616 243,-241.3616"/>
<text text-anchor="middle" x="195" y="-226.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_gen_par.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_gen_par.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~mod_gen_par.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M293.3454,-201.3629C278.8906,-205.4781 262.5358,-210.1343 247.3717,-214.4515"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="246.2699,-211.126 237.6105,-217.2305 248.1867,-217.8585 246.2699,-211.126"/>
</g>
<!-- sourcefile~umfpack.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~umfpack.f90</title>
<g id="a_sourcefile~~mod_film.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/umfpack.f90.html" xlink:title="umfpack.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="229.5,-119.3616 160.5,-119.3616 160.5,-95.3616 229.5,-95.3616 229.5,-119.3616"/>
<text text-anchor="middle" x="195" y="-104.9616" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">umfpack.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_solver.f90&#45;&gt;sourcefile~umfpack.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~mod_solver.f90&#45;&gt;sourcefile~umfpack.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M321.1189,-177.3486C304.7066,-164.0682 276.6757,-142.6661 250,-128.3616 246.5025,-126.4861 242.8007,-124.6964 239.0371,-123.0097"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="240.2091,-119.7054 229.6353,-119.0387 237.4855,-126.1538 240.2091,-119.7054"/>
</g>
<!-- sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_fluid.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_fluid.f90</title>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M296.7358,-350.6375C280.0327,-350.7564 260.3353,-350.8966 242.7433,-351.0218"/>
<polygon fill="#ff00bf" stroke="#ff00bf" points="242.6421,-347.5223 232.6673,-351.0935 242.692,-354.5221 242.6421,-347.5223"/>
</g>
<!-- sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~mod_data.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M302.6977,-362.4157C264.4751,-376.1079 205.2196,-396.1051 195,-392.3616"/>
<path fill="none" stroke="#ff00bf" stroke-dasharray="5,2" d="M195,-392.3616C170.5766,-383.4151 161.4464,-387.0787 140,-372.3616 108.1462,-350.5027 80.579,-314.4858 65.1473,-291.8882"/>
<polygon fill="#ff00bf" stroke="#ff00bf" points="67.9384,-289.765 59.4805,-283.3842 62.1133,-293.6467 67.9384,-289.765"/>
</g>
<!-- sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~mod_sort_arrays.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M139.7125,-271.3616C131.4429,-271.3616 122.8679,-271.3616 114.4622,-271.3616"/>
<polygon fill="#00ff66" stroke="#00ff66" points="114.3251,-267.8617 104.3251,-271.3616 114.3251,-274.8617 114.3251,-267.8617"/>
</g>
<!-- sourcefile~mod_gen_par.f90&#45;&gt;sourcefile~mod_data_arch.f90 -->
<g id="sourcefile~~mod_film.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~mod_gen_par.f90&#45;&gt;sourcefile~mod_data_arch.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M154.0219,-241.3971C138.0159,-246.0982 119.4977,-251.5371 102.667,-256.4804"/>
<polygon fill="#0066ff" stroke="#0066ff" points="101.5924,-253.1481 92.984,-259.3243 103.5651,-259.8644 101.5924,-253.1481"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65,-24 0,-24 0,0 65,0 65,-24"/>
<text text-anchor="middle" x="32.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="180,-24 83,-24 83,0 180,0 180,-24"/>
<text text-anchor="middle" x="131.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~mod_film.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemod_filmf90AfferentGraph" width="578pt" height="73pt"
 viewBox="0.00 0.00 578.00 73.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~mod_film.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 69.4007)">
<title>sourcefile~~mod_film.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-69.4007 574,-69.4007 574,4 -4,4"/>
<!-- sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~mod_film.f90</title>
<polygon fill="none" stroke="#000000" points="72,-57.2014 0,-57.2014 0,-33.2014 72,-33.2014 72,-57.2014"/>
<text text-anchor="middle" x="36" y="-42.8014" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">mod_film.f90</text>
</g>
<!-- sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~mod_inout_files.f90</title>
<g id="a_sourcefile~~mod_film.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/mod_inout_files.f90.html" xlink:title="mod_inout_files.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="338,-37.2014 235,-37.2014 235,-13.2014 338,-13.2014 338,-37.2014"/>
<text text-anchor="middle" x="286.5" y="-22.8014" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_inout_files.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M262.1555,-37.3532C235.974,-49.2611 192.8006,-65.5815 153.5,-65.2014"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M153.5,-65.2014C129.7425,-64.9717 103.66,-60.925 82.1169,-56.5313"/>
<polygon fill="#ff0000" stroke="#ff0000" points="82.7599,-53.0898 72.2504,-54.4315 81.3027,-59.9365 82.7599,-53.0898"/>
</g>
<!-- sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~mod_ms_film.f90</title>
<g id="a_sourcefile~~mod_film.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/mod_ms_film.f90.html" xlink:title="mod_ms_film.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="199,-37.2014 108,-37.2014 108,-13.2014 199,-13.2014 199,-37.2014"/>
<text text-anchor="middle" x="153.5" y="-22.8014" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_ms_film.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~mod_inout_files.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M234.6979,-25.2014C226.4012,-25.2014 217.7832,-25.2014 209.3962,-25.2014"/>
<polygon fill="#0000ff" stroke="#0000ff" points="209.3176,-21.7015 199.3176,-25.2014 209.3176,-28.7015 209.3176,-21.7015"/>
</g>
<!-- sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~mod_test_musst.f90</title>
<g id="a_sourcefile~~mod_film.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/mod_test_musst.f90.html" xlink:title="mod_test_musst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="480,-37.2014 374,-37.2014 374,-13.2014 480,-13.2014 480,-37.2014"/>
<text text-anchor="middle" x="427" y="-22.8014" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mod_test_musst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M381.0377,-37.2409C367.2717,-40.5227 352.0889,-43.824 338,-46.2014 256.7155,-59.9176 235.9298,-65.9985 153.5,-65.2014"/>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_inout_files.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M373.883,-25.2014C365.596,-25.2014 356.9703,-25.2014 348.5064,-25.2014"/>
<polygon fill="#ff0000" stroke="#ff0000" points="348.2964,-21.7015 338.2963,-25.2014 348.2963,-28.7015 348.2964,-21.7015"/>
</g>
<!-- sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~mod_test_musst.f90&#45;&gt;sourcefile~mod_ms_film.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M384.802,-13.1329C370.1184,-9.4989 353.4539,-5.9999 338,-4.2014 292.5291,1.0905 280.4143,1.5555 235,-4.2014 224.1239,-5.5801 212.6221,-7.9546 201.7957,-10.6227"/>
<polygon fill="#0000ff" stroke="#0000ff" points="200.8853,-7.2429 192.0803,-13.1354 202.6381,-14.0199 200.8853,-7.2429"/>
</g>
<!-- sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~mod_ms_film.f90&#45;&gt;sourcefile~mod_film.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M107.735,-32.9912C99.3057,-34.426 90.5011,-35.9246 82.0631,-37.3609"/>
<polygon fill="#ff0000" stroke="#ff0000" points="81.2732,-33.9449 72.0024,-39.0734 82.4479,-40.8457 81.2732,-33.9449"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~mod_film.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="570,-37.2014 516,-37.2014 516,-13.2014 570,-13.2014 570,-37.2014"/>
<text text-anchor="middle" x="543" y="-22.8014" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90 -->
<g id="sourcefile~~mod_film.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~mod_test_musst.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M515.8032,-25.2014C508.0185,-25.2014 499.1908,-25.2014 490.1952,-25.2014"/>
<polygon fill="#00ff00" stroke="#00ff00" points="490.0141,-21.7015 480.014,-25.2014 490.014,-28.7015 490.0141,-21.7015"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65,-24 0,-24 0,0 65,0 65,-24"/>
<text text-anchor="middle" x="32.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="180,-24 83,-24 83,0 180,0 180,-24"/>
<text text-anchor="middle" x="131.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/film.html">film</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/mod_film.f90.html#src">mod_film.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!! author: Noël Brunetière&lt;br/&gt;&amp;emsp;Arthur Francisco</span>
<a name="ln-2"></a><span class="c">!! version: 1.0.0</span>
<a name="ln-3"></a><span class="c">!! date: April,17 2017</span>
<a name="ln-4"></a><span class="c">!! summary: Definition of a fluid film by FEM</span>
<a name="ln-5"></a>
<a name="ln-6"></a><span class="c">!&lt; &lt;span style=&quot;color: #337ab7; font-family: cabin; font-size: 1.5em;&quot;&gt;</span>
<a name="ln-7"></a><span class="c">!        **FE solution of the Reynolds equation**</span>
<a name="ln-8"></a><span class="c">!  &lt;/span&gt;</span>
<a name="ln-9"></a>
<a name="ln-10"></a><span class="c">!&lt;# Description of the film module</span>
<a name="ln-11"></a><span class="c">!  This is the main module for the finite element solution of the Reynolds equation.</span>
<a name="ln-12"></a><span class="c">!</span>
<a name="ln-13"></a><span class="c">!&lt;## Definition of FE_film</span>
<a name="ln-14"></a><span class="c">! [[FE_FILM]] is a data structure containing a [[FE_MESH]] and some data describing a lubrication problem</span>
<a name="ln-15"></a><span class="c">!&lt;## Solution procedure</span>
<a name="ln-16"></a><span class="c">! This module can be used to create a FE_FILM, assemble the FE_FIM and solve it. Some post-treatements like fluxes, forces are available.</span>
<a name="ln-17"></a>
<a name="ln-18"></a><span class="k">module </span><span class="n">film</span>
<a name="ln-19"></a><span class="k">use </span><span class="n">data_arch</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">EPS_R8</span>
<a name="ln-20"></a><span class="k">use </span><span class="n">data_film_hd</span>
<a name="ln-21"></a><span class="k">use </span><span class="n">fluid_law</span>
<a name="ln-22"></a><span class="k">use </span><span class="n">num_param</span>
<a name="ln-23"></a><span class="k">use </span><span class="n">mesh</span>
<a name="ln-24"></a><span class="k">use </span><span class="n">solver</span>
<a name="ln-25"></a><span class="k">use </span><span class="n">elements</span>
<a name="ln-26"></a><span class="k">use </span><span class="n">omp_lib</span>
<a name="ln-27"></a><span class="k">use </span><span class="n">surfile</span>
<a name="ln-28"></a>
<a name="ln-29"></a><span class="k">implicit none</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="k">private</span>
<a name="ln-32"></a>
<a name="ln-33"></a><span class="k">type </span><span class="n">PRC_TAB</span>
<a name="ln-34"></a><span class="c">!! &lt;span style=&quot;color:green&quot;&gt;</span>
<a name="ln-35"></a><span class="c">!!   *PRC_TAB* stores some precomputed coefficients for the finite element matrices</span>
<a name="ln-36"></a><span class="c">!! &lt;/span&gt;</span>
<a name="ln-37"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span>                             <span class="kd">::</span> <span class="n">ng</span>          <span class="c">!! *Gauss point number along a direction*</span>
<a name="ln-38"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>     <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">pg</span>          <span class="c">!! *point coordinates in a direction*</span>
<a name="ln-39"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>     <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">wg</span>          <span class="c">!! *point weight*</span>
<a name="ln-40"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vni4</span>        <span class="c">!! *for each node, shape function at Gauss points*</span>
<a name="ln-41"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vni4x</span>       <span class="c">!! *for each node, shape function derivative at Gauss points*</span>
<a name="ln-42"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vni4y</span>       <span class="c">!! *for each node, shape function derivative at Gauss points*</span>
<a name="ln-43"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vni4d</span>       <span class="c">!! *for each node, upwind shape function at Gauss points*</span>
<a name="ln-44"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vcal</span>        <span class="c">!! *14 values calculated at the Gauss points*</span>
<a name="ln-45"></a><span class="n">endtype</span> <span class="n">PRC_TAB</span>
<a name="ln-46"></a>
<a name="ln-47"></a><span class="k">type </span><span class="n">FE_FILM</span>
<a name="ln-48"></a><span class="c">!! &lt;span style=&quot;color:green&quot;&gt;</span>
<a name="ln-49"></a><span class="c">!!   *FE_FILM* stores the whole stuff related to a film: the nodal variables, the mesh, etc.</span>
<a name="ln-50"></a><span class="c">!! &lt;/span&gt;</span>
<a name="ln-51"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">n_vn</span>          <span class="c">!! *number of nodal variables*</span>
<a name="ln-52"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">n_vc</span>          <span class="c">!! *number of variables on cells*</span>
<a name="ln-53"></a>   <span class="k">type</span><span class="p">(</span><span class="n">FE_MESH</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">m</span>             <span class="c">!! *mesh of the film*</span>
<a name="ln-54"></a>   <span class="k">type</span><span class="p">(</span><span class="n">DATA_FILM</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">data_f</span>        <span class="c">!! *data of the problem*</span>
<a name="ln-55"></a>   <span class="k">type</span><span class="p">(</span><span class="n">PRC_TAB</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">prc</span>           <span class="c">!! *precomputation*</span>
<a name="ln-56"></a>   <span class="k">type</span><span class="p">(</span><span class="n">NUM_PAR</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">num_p</span>         <span class="c">!! *numerical param for iterative solution*</span>
<a name="ln-57"></a>
<a name="ln-58"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>     <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vn</span>      <span class="c">!! *nodal variables table*</span>
<a name="ln-59"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>     <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vc</span>      <span class="c">!! *cell variables table*</span>
<a name="ln-60"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span>  <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bc</span>      <span class="c">!! *boundary nodes code*</span>
<a name="ln-61"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vn_name</span> <span class="c">!! *nodal variable names*</span>
<a name="ln-62"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">vc_name</span> <span class="c">!! *cell variable names*</span>
<a name="ln-63"></a>   <span class="k">contains</span>
<a name="ln-64"></a><span class="k">      procedure</span> <span class="kd">::</span> <span class="n">fx</span>                                        <span class="c">!! *force computation along* \(x\)</span>
<a name="ln-65"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">fy</span>                                        <span class="c">!! *force computation along* \(y\)</span>
<a name="ln-66"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">fz</span>                                        <span class="c">!! *force computation along* \(z\)</span>
<a name="ln-67"></a><span class="n">endtype</span> <span class="n">FE_FILM</span>
<a name="ln-68"></a>
<a name="ln-69"></a><span class="c">! codes for variables</span>
<a name="ln-70"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">H1_N</span>     <span class="o">=</span>  <span class="mi">1</span>  <span class="c">!! *code for bottom surface height* \(h_1\)</span>
<a name="ln-71"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">H2_N</span>     <span class="o">=</span>  <span class="mi">2</span>  <span class="c">!! *code for top surface height* \(h_2\)</span>
<a name="ln-72"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">H_N</span>      <span class="o">=</span>  <span class="mi">3</span>  <span class="c">!! *code for film thickness* \(h\)</span>
<a name="ln-73"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">P_N</span>      <span class="o">=</span>  <span class="mi">4</span>  <span class="c">!! *code for film absolute pressure* \(p\)</span>
<a name="ln-74"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">RHO_N</span>    <span class="o">=</span>  <span class="mi">5</span>  <span class="c">!! *code for fluid density* \(\rho\)</span>
<a name="ln-75"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">T_N</span>      <span class="o">=</span>  <span class="mi">6</span>  <span class="c">!! *code for film absolute temperature* \(T\)</span>
<a name="ln-76"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DRHODP_N</span> <span class="o">=</span>  <span class="mi">7</span>  <span class="c">!! *code for film compressibility* \(\frac{\partial \rho}{\partial p}\)</span>
<a name="ln-77"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MU_N</span>     <span class="o">=</span>  <span class="mi">8</span>  <span class="c">!! *code for fluid viscosity* \(\mu\)</span>
<a name="ln-78"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">VX_N</span>     <span class="o">=</span>  <span class="mi">9</span>  <span class="c">!! *code for surface velocity along* \(x\) \(V_x\). *Should be modified (surfaces 1 and 2)*</span>
<a name="ln-79"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">VY_N</span>     <span class="o">=</span> <span class="mi">10</span>  <span class="c">!! *code for surface velocity along* \(y\) \(V_y\). *Should be modified (surfaces 1 and 2)*</span>
<a name="ln-80"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">HG_C</span>     <span class="o">=</span>  <span class="mi">1</span>  <span class="c">!! *code for groove depth on the stationnary surface* \(h_g\), *cell variable*</span>
<a name="ln-81"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">PEK_C</span>    <span class="o">=</span>  <span class="mi">2</span>  <span class="c">!! *code for Peclet number along* \(\xi\)</span>
<a name="ln-82"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">PEE_C</span>    <span class="o">=</span>  <span class="mi">3</span>  <span class="c">!! *code for Peclet number along* \(\eta\)</span>
<a name="ln-83"></a>
<a name="ln-84"></a><span class="c">! codes for boundary conditions</span>
<a name="ln-85"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">REY</span>      <span class="o">=</span>  <span class="mi">1</span>  <span class="c">!! *code for imposed pressure at the boundary*</span>
<a name="ln-86"></a>
<a name="ln-87"></a><span class="c">! codes for assembly</span>
<a name="ln-88"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ASS</span>      <span class="o">=</span>  <span class="mi">1</span>  <span class="c">!! *code for assembly of the system*</span>
<a name="ln-89"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NO_ASS</span>   <span class="o">=</span>  <span class="mi">0</span>  <span class="c">!! *code for no assemble, computation of the residual only*</span>
<a name="ln-90"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NO_BC</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c">!! *code for computation of the residual everywhere, even at the boundaries (fluxes computations)*</span>
<a name="ln-91"></a>
<a name="ln-92"></a><span class="c">! private variable for a &#39;.sur&#39; file creation</span>
<a name="ln-93"></a><span class="k">type</span><span class="p">(</span><span class="n">SCALE_SURF</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scal_tmp</span> <span class="c">!! *object [[SCALE_SURF]]*</span>
<a name="ln-94"></a>
<a name="ln-95"></a><span class="c">! parameters controlling the iterative process</span>
<a name="ln-96"></a><span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">BC_SPLINE</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!! *instead of linearly interpolating the boundary pressures, it can be done in a smoother way. NOT TO BE USED YET.*</span>
<a name="ln-97"></a><span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">SMOOTH_MS</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!! *at the end of the iterative process, the pressure field can be smoothed*</span>
<a name="ln-98"></a>
<a name="ln-99"></a>
<a name="ln-100"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">ASS</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">,</span> <span class="n">FE_FILM</span><span class="p">,</span> <span class="n">H1_N</span><span class="p">,</span> <span class="n">H2_N</span><span class="p">,</span> <span class="n">HG_C</span><span class="p">,</span> <span class="n">H_N</span><span class="p">,</span> <span class="n">MU_N</span><span class="p">,</span> <span class="n">NO_ASS</span><span class="p">,</span> <span class="n">NO_BC</span><span class="p">,</span> <span class="n">PEE_C</span><span class="p">,</span> <span class="n">PEK_C</span><span class="p">,</span> <span class="n">PRC_TAB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-101"></a>          <span class="n">P_N</span><span class="p">,</span> <span class="n">REY</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">,</span> <span class="n">T_N</span><span class="p">,</span> <span class="n">VX_N</span><span class="p">,</span> <span class="n">VY_N</span><span class="p">,</span> <span class="n">apply_bc_FE_film</span><span class="p">,</span> <span class="n">apply_bc_FE_film_simple</span><span class="p">,</span> <span class="n">assemble_in_mat_sol</span><span class="p">,</span> <span class="n">assembly_FE_film_reynolds</span><span class="p">,</span> <span class="n">compute_corner_fluxes</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-102"></a>          <span class="n">elementary_full_domain_FE_film_reynolds</span><span class="p">,</span> <span class="n">init_prc_tab</span><span class="p">,</span> <span class="n">solve_FE_film</span><span class="p">,</span> <span class="n">create_rect_FE_film</span><span class="p">,</span> <span class="n">save_fe_field</span><span class="p">,</span> <span class="n">BC_SPLINE</span><span class="p">,</span> <span class="n">SMOOTH_MS</span>
<a name="ln-103"></a>
<a name="ln-104"></a><span class="k">contains</span>
<a name="ln-105"></a>
<a name="ln-106"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-107"></a>   <span class="c">!&lt; @note Subroutine to create a [[FE_FILM]]</span>
<a name="ln-108"></a>   <span class="c">!&lt;</span>
<a name="ln-109"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-110"></a>   <span class="k">subroutine </span><span class="n">create_rect_FE_film</span><span class="p">(</span><span class="n">data_f</span><span class="p">,</span> <span class="n">num_p</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">)</span>
<a name="ln-111"></a>   <span class="k">implicit none</span>
<a name="ln-112"></a><span class="k">   type</span><span class="p">(</span><span class="n">DATA_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">data_f</span> <span class="c">!! *data of the film*</span>
<a name="ln-113"></a>   <span class="k">type</span><span class="p">(</span><span class="n">NUM_PAR</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">num_p</span>  <span class="c">!! *numerical param for iterative solution*</span>
<a name="ln-114"></a>   <span class="k">type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span>   <span class="c">!! *FE film data type*</span>
<a name="ln-115"></a>
<a name="ln-116"></a>      <span class="c">! mesh creation</span>
<a name="ln-117"></a>      <span class="k">call </span><span class="n">create_rect_x_ymesh</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">)</span>
<a name="ln-118"></a>      <span class="c">! copy of data</span>
<a name="ln-119"></a>      <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span> <span class="o">=</span> <span class="n">data_f</span>
<a name="ln-120"></a>      <span class="c">! allocation and initialisation of the variables and bc table</span>
<a name="ln-121"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">pb_type</span><span class="p">)</span>
<a name="ln-122"></a>         <span class="k">case</span><span class="p">(</span><span class="n">HD</span><span class="p">)</span>
<a name="ln-123"></a>            <span class="c">! nodal tables</span>
<a name="ln-124"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">n_vn</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-125"></a>            <span class="k">allocate</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">n_vn</span><span class="p">),</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">n_vn</span><span class="p">))</span>
<a name="ln-126"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">H1_N</span><span class="p">)</span>  <span class="o">=</span> <span class="s1">&#39;h1(m)&#39;</span>
<a name="ln-127"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">H2_N</span><span class="p">)</span>  <span class="o">=</span> <span class="s1">&#39;h2(m)&#39;</span>
<a name="ln-128"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">H_N</span><span class="p">)</span>   <span class="o">=</span> <span class="s1">&#39;h(m)&#39;</span>
<a name="ln-129"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">P_N</span><span class="p">)</span>   <span class="o">=</span> <span class="s1">&#39;p(Pa)&#39;</span>
<a name="ln-130"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;rho(kg.m-3)&#39;</span>
<a name="ln-131"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">T_N</span><span class="p">)</span>   <span class="o">=</span> <span class="s1">&#39;T(K)&#39;</span>
<a name="ln-132"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;drhodp(kg.m-3.Pa-1)&#39;</span>
<a name="ln-133"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">MU_N</span><span class="p">)</span>     <span class="o">=</span> <span class="s1">&#39;mu(Pa.s)&#39;</span>
<a name="ln-134"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">VX_N</span><span class="p">)</span>     <span class="o">=</span> <span class="s1">&#39;Vx(m.s-1)&#39;</span>
<a name="ln-135"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">VY_N</span><span class="p">)</span>     <span class="o">=</span> <span class="s1">&#39;Vy(m.s-1)&#39;</span>
<a name="ln-136"></a>
<a name="ln-137"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span>           <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-138"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">H2_N</span><span class="p">)</span>  <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">h_0</span>
<a name="ln-139"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">H_N</span><span class="p">)</span>   <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">H2_N</span><span class="p">)</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">H1_N</span><span class="p">)</span>
<a name="ln-140"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span>   <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span>
<a name="ln-141"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">T_0</span><span class="p">)</span>
<a name="ln-142"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">T_N</span><span class="p">)</span>   <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">T_0</span>
<a name="ln-143"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">MU_N</span><span class="p">)</span>  <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">mu_0</span>
<a name="ln-144"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">VX_N</span><span class="p">)</span>  <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">v_x</span>
<a name="ln-145"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">VY_N</span><span class="p">)</span>  <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">v_y</span>
<a name="ln-146"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">T_0</span><span class="p">)</span>
<a name="ln-147"></a>            <span class="c">! bondary condition table</span>
<a name="ln-148"></a>            <span class="k">allocate</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">bc</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-149"></a>            <span class="c">! all the nodes are initialized as unknown</span>
<a name="ln-150"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">bc</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-151"></a>            <span class="c">! cell variable</span>
<a name="ln-152"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">n_vc</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-153"></a>            <span class="k">allocate</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">n_vc</span><span class="p">),</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">n_vc</span><span class="p">))</span>
<a name="ln-154"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">HG_C</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;h_grv(m)&#39;</span>
<a name="ln-155"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">PEK_C</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;Pek&#39;</span>
<a name="ln-156"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">PEE_C</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;Pee&#39;</span>
<a name="ln-157"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-158"></a>            <span class="c">! numerical parameters for iterative problems</span>
<a name="ln-159"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">num_p</span> <span class="o">=</span> <span class="n">num_p</span>
<a name="ln-160"></a>         <span class="k">case </span><span class="n">default</span>
<a name="ln-161"></a>            <span class="k">stop</span> <span class="s1">&#39;the problem type is undefined in create_rect_FE_film&#39;</span>
<a name="ln-162"></a>      <span class="n">endselect</span>
<a name="ln-163"></a>   <span class="k">return</span>
<a name="ln-164"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">create_rect_FE_film</span>
<a name="ln-165"></a>
<a name="ln-166"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-167"></a>   <span class="c">!&lt; @note Subroutine to solve a [[FE_FILM]]</span>
<a name="ln-168"></a>   <span class="c">!&lt;</span>
<a name="ln-169"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-170"></a>   <span class="k">subroutine </span><span class="n">solve_FE_film</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">flag_ass</span><span class="p">)</span>
<a name="ln-171"></a>   <span class="k">implicit none</span>
<a name="ln-172"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">fe_f</span>     <span class="c">!! *FE film data type*</span>
<a name="ln-173"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MAT_SOLV</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">mat</span>      <span class="c">!! *matrices for solving*</span>
<a name="ln-174"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>       <span class="c">!! *boundary conditions at the corners*</span>
<a name="ln-175"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">optional</span>           <span class="kd">::</span> <span class="n">flag_ass</span> <span class="c">!! *optional flag for assembly*</span>
<a name="ln-176"></a>
<a name="ln-177"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">decomp</span>
<a name="ln-178"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ass_c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">e</span>
<a name="ln-179"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">conv</span>
<a name="ln-180"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">error</span>
<a name="ln-181"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compt</span>
<a name="ln-182"></a>
<a name="ln-183"></a>      <span class="c">! solution parameters</span>
<a name="ln-184"></a>      <span class="n">ass_c</span> <span class="o">=</span> <span class="n">ASS</span>
<a name="ln-185"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">flag_ass</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-186"></a><span class="k">         if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">flag_ass</span><span class="p">)</span> <span class="n">ass_c</span> <span class="o">=</span> <span class="n">NO_ASS</span>
<a name="ln-187"></a>      <span class="n">endif</span>
<a name="ln-188"></a>      <span class="n">decomp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span>
<a name="ln-189"></a>
<a name="ln-190"></a>      <span class="c">! apply boundary conditions</span>
<a name="ln-191"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">BC_SPLINE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-192"></a><span class="k">         call </span><span class="n">apply_bc_FE_film</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-193"></a>                                 <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-194"></a>      <span class="k">else</span>
<a name="ln-195"></a><span class="k">         call </span><span class="n">apply_bc_FE_film_simple</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-196"></a>                                        <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-197"></a>      <span class="n">endif</span>
<a name="ln-198"></a>
<a name="ln-199"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;bc applied&#39;</span>
<a name="ln-200"></a>
<a name="ln-201"></a>      <span class="c">! update fluid properties</span>
<a name="ln-202"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-203"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span>    <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span>   <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">))</span>
<a name="ln-204"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">))</span>
<a name="ln-205"></a>      <span class="n">enddo</span>
<a name="ln-206"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;fluid properties updated&#39;</span>
<a name="ln-207"></a>
<a name="ln-208"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">first</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-209"></a><span class="k">         </span><span class="n">mat</span><span class="p">%</span><span class="n">nn</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-210"></a>         <span class="n">mat</span><span class="p">%</span><span class="n">ne</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-211"></a>         <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-212"></a>                        <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;ini&#39;</span><span class="p">)</span>
<a name="ln-213"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Matrix initialized, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-214"></a>
<a name="ln-215"></a>         <span class="c">! matrices allocation</span>
<a name="ln-216"></a>         <span class="n">compt</span><span class="p">(:)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-217"></a>         <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-218"></a>            <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_n</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>       <span class="c">! for each element, the number of lines is added</span>
<a name="ln-219"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-220"></a>               <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>   <span class="c">! &quot; &quot;, for each node, the number of contributions is added</span>
<a name="ln-221"></a>            <span class="n">enddo</span>
<a name="ln-222"></a>         <span class="n">enddo</span>
<a name="ln-223"></a>         <span class="n">mat</span><span class="p">%</span><span class="n">nvar</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-224"></a>         <span class="n">mat</span><span class="p">%</span><span class="n">nt</span>   <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-225"></a>         <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">eltvar</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span> <span class="n">mat</span><span class="p">%</span><span class="n">eltvar</span><span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">nvar</span>  <span class="p">)</span> <span class="p">)</span>
<a name="ln-226"></a>         <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">a_elt</span> <span class="p">))</span> <span class="k">allocate</span><span class="p">(</span> <span class="n">mat</span><span class="p">%</span><span class="n">a_elt</span><span class="p">(</span> <span class="n">mat</span><span class="p">%</span><span class="n">nt</span>    <span class="p">)</span> <span class="p">)</span>
<a name="ln-227"></a>         <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span> <span class="n">mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">ne</span> <span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-228"></a>      <span class="n">endif</span>
<a name="ln-229"></a>
<a name="ln-230"></a>      <span class="c">! check of precomputed tables allocation</span>
<a name="ln-231"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">))</span> <span class="k">call </span><span class="n">init_prc_tab</span><span class="p">(</span><span class="n">fe_f</span><span class="p">)</span>
<a name="ln-232"></a>
<a name="ln-233"></a>      <span class="c">! convergence is false at zero iteration</span>
<a name="ln-234"></a>      <span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-235"></a>      <span class="n">it</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-236"></a>      <span class="c">! solution loop</span>
<a name="ln-237"></a>      <span class="k">do</span>
<a name="ln-238"></a><span class="k">         if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Loop FE &#39;</span><span class="p">,</span> <span class="n">it</span>
<a name="ln-239"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">conv</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-240"></a>
<a name="ln-241"></a>         <span class="c">! assembly of the system</span>
<a name="ln-242"></a>         <span class="k">call </span><span class="n">assembly_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-243"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   System assembled, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-244"></a>
<a name="ln-245"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-246"></a>            <span class="c">! some stuff can be saved here, provided the reloading of jptr, irow, ... (instead of convert_matrice_format)</span>
<a name="ln-247"></a>            <span class="k">call </span><span class="n">convert_matrice_format</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<a name="ln-248"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Matrix converted, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-249"></a>         <span class="n">endif</span>
<a name="ln-250"></a>
<a name="ln-251"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">first</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-252"></a><span class="k">            call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-253"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;ana&#39;</span><span class="p">)</span>
<a name="ln-254"></a>            <span class="n">mat</span><span class="p">%</span><span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!ù</span>
<a name="ln-255"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Matrix analyzed, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-256"></a>         <span class="n">endif</span>
<a name="ln-257"></a>
<a name="ln-258"></a>         <span class="c">! solution of the system</span>
<a name="ln-259"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-260"></a><span class="k">            call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-261"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;fac&#39;</span><span class="p">)</span>
<a name="ln-262"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Matrix factorized, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-263"></a>         <span class="n">endif</span>
<a name="ln-264"></a>
<a name="ln-265"></a>         <span class="k">call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-266"></a>                        <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;sol&#39;</span><span class="p">)</span>
<a name="ln-267"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   System solved, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-268"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-269"></a><span class="k">            call </span><span class="n">solve_syst</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-270"></a>                           <span class="n">step</span> <span class="o">=</span> <span class="s1">&#39;fre&#39;</span><span class="p">)</span>
<a name="ln-271"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Matrix factors freed, thread &#39;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">()</span>
<a name="ln-272"></a>         <span class="n">endif</span>
<a name="ln-273"></a>
<a name="ln-274"></a>         <span class="c">! error computation</span>
<a name="ln-275"></a>         <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.5_R8</span><span class="p">)</span>
<a name="ln-276"></a>         <span class="n">it</span> <span class="o">=</span> <span class="n">it</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-277"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;   Error &#39;</span><span class="p">,</span> <span class="n">error</span>
<a name="ln-278"></a>
<a name="ln-279"></a>         <span class="c">! convergence check</span>
<a name="ln-280"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">eps</span><span class="p">)</span> <span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-281"></a>
<a name="ln-282"></a>         <span class="c">! update of variables</span>
<a name="ln-283"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-284"></a><span class="k">            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-285"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-286"></a><span class="k">                  </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">*</span> <span class="n">mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">relax</span>
<a name="ln-287"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-288"></a><span class="k">                      </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">P_0</span><span class="o">/</span><span class="mi">100</span>
<a name="ln-289"></a>                  <span class="k">else</span>
<a name="ln-290"></a><span class="k">                      </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">pres</span><span class="p">(</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-291"></a>                                                               <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>   <span class="n">T_N</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-292"></a>                  <span class="n">endif</span>
<a name="ln-293"></a>               <span class="k">else</span>
<a name="ln-294"></a><span class="k">                  </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">mat</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">relax</span>
<a name="ln-295"></a>               <span class="n">endif</span>
<a name="ln-296"></a>            <span class="n">enddo</span>
<a name="ln-297"></a>         <span class="k">else</span>
<a name="ln-298"></a><span class="k">            </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">+</span> <span class="n">mat</span><span class="p">%</span><span class="n">x</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">relax</span>
<a name="ln-299"></a>         <span class="n">endif</span>
<a name="ln-300"></a>
<a name="ln-301"></a>         <span class="c">! check pressure</span>
<a name="ln-302"></a>         <span class="k">if</span> <span class="p">(</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span> <span class="o">==</span> <span class="n">GP</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-303"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0._R8</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-304"></a><span class="k">               if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;P negative&#39;</span>
<a name="ln-305"></a>            <span class="n">endif</span>
<a name="ln-306"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0._R8</span><span class="p">)</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">p_0</span> <span class="o">/</span> <span class="mf">1.e3_R8</span>
<a name="ln-307"></a>         <span class="n">endif</span>
<a name="ln-308"></a>
<a name="ln-309"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">n</span>
<a name="ln-310"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span>    <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">rho</span><span class="p">(</span>   <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">))</span>
<a name="ln-311"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">drhodp</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span> <span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">T_N</span><span class="p">))</span>
<a name="ln-312"></a>         <span class="n">enddo</span>
<a name="ln-313"></a>
<a name="ln-314"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">&gt;=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">num_p</span><span class="p">%</span><span class="n">it_max</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-315"></a><span class="k">            </span><span class="n">conv</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-316"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">OPU</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;maximum number of iteration reached before convergence&#39;</span>
<a name="ln-317"></a>         <span class="n">endif</span>
<a name="ln-318"></a>      <span class="n">enddo</span>
<a name="ln-319"></a>
<a name="ln-320"></a>   <span class="k">return</span>
<a name="ln-321"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">solve_FE_film</span>
<a name="ln-322"></a>
<a name="ln-323"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-324"></a>   <span class="c">!&lt; @note Subroutine to apply boundary conditions on a [[FE_FILM]]</span>
<a name="ln-325"></a>   <span class="c">!&lt;</span>
<a name="ln-326"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-327"></a>   <span class="k">subroutine </span><span class="n">apply_bc_FE_film</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-328"></a>   <span class="k">implicit none</span>
<a name="ln-329"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">fe_f</span>    <span class="c">!! *FE film data type*</span>
<a name="ln-330"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>      <span class="c">!! *boundary conditions at the corners*</span>
<a name="ln-331"></a>
<a name="ln-332"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span>
<a name="ln-333"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mixture</span>
<a name="ln-334"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">v</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-335"></a>
<a name="ln-336"></a>      <span class="n">mixture</span> <span class="o">=</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span>
<a name="ln-337"></a>
<a name="ln-338"></a>      <span class="c">! case of hd problem: unknown is p</span>
<a name="ln-339"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">pb_type</span> <span class="o">==</span> <span class="n">HD</span><span class="p">)</span> <span class="n">ind_var</span> <span class="o">=</span> <span class="n">P_N</span>
<a name="ln-340"></a>
<a name="ln-341"></a>      <span class="c">! copy of the bc values on the node values</span>
<a name="ln-342"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nc</span>
<a name="ln-343"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">ind_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">ind_var</span><span class="p">)</span> <span class="o">+</span> <span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-344"></a>      <span class="n">enddo</span>
<a name="ln-345"></a>
<a name="ln-346"></a>      <span class="c">! loop on edges</span>
<a name="ln-347"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-348"></a><span class="k">         </span><span class="n">v1</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ind_var</span><span class="p">)</span>
<a name="ln-349"></a>      <span class="k">else</span>
<a name="ln-350"></a><span class="k">         </span><span class="n">v1</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-351"></a>      <span class="n">endif</span>
<a name="ln-352"></a>
<a name="ln-353"></a>      <span class="n">x1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-354"></a>      <span class="n">y1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-355"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ned</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-356"></a>         <span class="n">v2</span> <span class="o">=</span> <span class="n">v1</span>
<a name="ln-357"></a>         <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
<a name="ln-358"></a>         <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span>
<a name="ln-359"></a>
<a name="ln-360"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-361"></a><span class="k">            </span><span class="n">v1</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="n">ind_var</span><span class="p">)</span>
<a name="ln-362"></a>         <span class="k">else</span>
<a name="ln-363"></a><span class="k">            </span><span class="n">v1</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-364"></a>         <span class="n">endif</span>
<a name="ln-365"></a>
<a name="ln-366"></a>         <span class="n">x1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-367"></a>         <span class="n">y1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-368"></a>         <span class="c">! length of the edge</span>
<a name="ln-369"></a>         <span class="n">l</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5_R8</span>
<a name="ln-370"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-371"></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-372"></a>            <span class="c">! distance to point 2</span>
<a name="ln-373"></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5_R8</span>
<a name="ln-374"></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">l</span>
<a name="ln-375"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">v1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1._R8</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span>
<a name="ln-376"></a>            <span class="c">! linear distribution along the edge</span>
<a name="ln-377"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-378"></a><span class="k">               </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span><span class="p">)</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span> <span class="nb">log</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
<a name="ln-379"></a>            <span class="k">else</span>
<a name="ln-380"></a><span class="k">               </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
<a name="ln-381"></a>            <span class="n">endif</span>
<a name="ln-382"></a>         <span class="n">enddo</span>
<a name="ln-383"></a>
<a name="ln-384"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">n</span>
<a name="ln-385"></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-386"></a>            <span class="c">! boundary nodes are set as imposed</span>
<a name="ln-387"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">bc</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-388"></a>         <span class="n">enddo</span>
<a name="ln-389"></a>      <span class="n">enddo</span>
<a name="ln-390"></a>
<a name="ln-391"></a>   <span class="k">return</span>
<a name="ln-392"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">apply_bc_FE_film</span>
<a name="ln-393"></a>
<a name="ln-394"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-395"></a>   <span class="c">!&lt; @note Subroutine to apply boundary conditions on a [[FE_FILM]]</span>
<a name="ln-396"></a>   <span class="c">!&lt;</span>
<a name="ln-397"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-398"></a>   <span class="k">subroutine </span><span class="n">apply_bc_FE_film_simple</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-399"></a>   <span class="k">implicit none</span>
<a name="ln-400"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">fe_f</span>    <span class="c">!! *FE film data type*</span>
<a name="ln-401"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>      <span class="c">!! *boundary conditions at the corners*</span>
<a name="ln-402"></a>
<a name="ln-403"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span>
<a name="ln-404"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mixture</span>
<a name="ln-405"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">v</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span>
<a name="ln-406"></a>
<a name="ln-407"></a>      <span class="n">mixture</span> <span class="o">=</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span> <span class="o">==</span> <span class="n">MIXT</span><span class="p">)</span>
<a name="ln-408"></a>
<a name="ln-409"></a>      <span class="c">! case of hd problem: unknown is p</span>
<a name="ln-410"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">pb_type</span> <span class="o">==</span> <span class="n">HD</span><span class="p">)</span> <span class="n">ind_var</span> <span class="o">=</span> <span class="n">P_N</span>
<a name="ln-411"></a>
<a name="ln-412"></a>      <span class="c">! copy of the bc values on the node values</span>
<a name="ln-413"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nc</span>
<a name="ln-414"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">ind_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-415"></a>      <span class="n">enddo</span>
<a name="ln-416"></a>
<a name="ln-417"></a>      <span class="c">! loop on edges</span>
<a name="ln-418"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-419"></a><span class="k">         </span><span class="n">v1</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ind_var</span><span class="p">))</span>
<a name="ln-420"></a>      <span class="k">else</span>
<a name="ln-421"></a><span class="k">         </span><span class="n">v1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ind_var</span><span class="p">)</span>
<a name="ln-422"></a>      <span class="n">endif</span>
<a name="ln-423"></a>
<a name="ln-424"></a>      <span class="n">x1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-425"></a>      <span class="n">y1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-426"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ned</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-427"></a>         <span class="n">v2</span> <span class="o">=</span> <span class="n">v1</span>
<a name="ln-428"></a>         <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
<a name="ln-429"></a>         <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span>
<a name="ln-430"></a>
<a name="ln-431"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-432"></a><span class="k">            </span><span class="n">v1</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">ind_var</span><span class="p">))</span>
<a name="ln-433"></a>         <span class="k">else</span>
<a name="ln-434"></a><span class="k">            </span><span class="n">v1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">ind_var</span><span class="p">)</span>
<a name="ln-435"></a>         <span class="n">endif</span>
<a name="ln-436"></a>
<a name="ln-437"></a>         <span class="n">x1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-438"></a>         <span class="n">y1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-439"></a>         <span class="c">! length of the edge</span>
<a name="ln-440"></a>         <span class="n">l</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5_R8</span>
<a name="ln-441"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-442"></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-443"></a>            <span class="c">! distance to point 2</span>
<a name="ln-444"></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5_R8</span>
<a name="ln-445"></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">l</span>
<a name="ln-446"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">v1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1._R8</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span>
<a name="ln-447"></a>            <span class="c">! linear distribution along the edge</span>
<a name="ln-448"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">mixture</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-449"></a><span class="k">               </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span><span class="p">)</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a name="ln-450"></a>            <span class="k">else</span>
<a name="ln-451"></a><span class="k">               </span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span>
<a name="ln-452"></a>            <span class="n">endif</span>
<a name="ln-453"></a>         <span class="n">enddo</span>
<a name="ln-454"></a>
<a name="ln-455"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">n</span>
<a name="ln-456"></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-457"></a>            <span class="c">! boundary nodes are set as imposed</span>
<a name="ln-458"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">bc</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-459"></a>         <span class="n">enddo</span>
<a name="ln-460"></a>      <span class="n">enddo</span>
<a name="ln-461"></a>   <span class="k">return</span>
<a name="ln-462"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">apply_bc_FE_film_simple</span>
<a name="ln-463"></a>
<a name="ln-464"></a>
<a name="ln-465"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-466"></a>   <span class="c">!&lt; @note Subroutine to to solve a [[FE_FILM]]</span>
<a name="ln-467"></a>   <span class="c">!&lt;</span>
<a name="ln-468"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-469"></a>   <span class="k">subroutine </span><span class="n">assembly_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-470"></a>   <span class="k">implicit none</span>
<a name="ln-471"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span>     <span class="c">!! *FE_film data type*</span>
<a name="ln-472"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MAT_SOLV</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mat</span>      <span class="c">!! *matrices for solving*</span>
<a name="ln-473"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">ass_c</span>    <span class="c">!! *assembly type*</span>
<a name="ln-474"></a>
<a name="ln-475"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">compt</span>
<a name="ln-476"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">tind4</span>
<a name="ln-477"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">b4</span>
<a name="ln-478"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">,</span> <span class="n">MAX_NNE</span><span class="p">)</span> <span class="kd">::</span> <span class="n">k4</span>
<a name="ln-479"></a>
<a name="ln-480"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">el_t</span><span class="p">,</span> <span class="n">el_n</span>
<a name="ln-481"></a>
<a name="ln-482"></a>      <span class="c">! assembly</span>
<a name="ln-483"></a>      <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-484"></a>      <span class="n">mat</span><span class="p">%</span><span class="n">b</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-485"></a>
<a name="ln-486"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-487"></a>         <span class="k">call </span><span class="n">elementary_assembly_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>   <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-488"></a>                                                  <span class="n">ke_ij</span> <span class="o">=</span> <span class="n">k4</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">! elementary matrix         : OUT</span>
<a name="ln-489"></a>                                                   <span class="n">be_i</span> <span class="o">=</span> <span class="n">b4</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">! elementary rhs member     : OUT</span>
<a name="ln-490"></a>                                                  <span class="n">ind_e</span> <span class="o">=</span> <span class="n">tind4</span><span class="p">,</span>  <span class="p">&amp;</span> <span class="c">! elementary index member   : OUT</span>
<a name="ln-491"></a>                                                      <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">! element number</span>
<a name="ln-492"></a>                                                  <span class="n">ass_c</span> <span class="o">=</span> <span class="n">ass_c</span><span class="p">)</span>    <span class="c">! assembly type</span>
<a name="ln-493"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-494"></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">tind4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-495"></a>            <span class="n">mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">+</span> <span class="n">b4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-496"></a>         <span class="n">enddo</span>
<a name="ln-497"></a>
<a name="ln-498"></a>         <span class="n">el_t</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-499"></a>         <span class="n">el_n</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_n</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-500"></a>
<a name="ln-501"></a>         <span class="c">! assembly of the elemental matrix in the solver matrix</span>
<a name="ln-502"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-503"></a><span class="k">            call </span><span class="n">assemble_in_mat_sol</span><span class="p">(</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-504"></a>                                     <span class="n">num</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span>      <span class="p">&amp;</span>
<a name="ln-505"></a>                                    <span class="n">nelt</span> <span class="o">=</span> <span class="n">el_t</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-506"></a>                                   <span class="n">nline</span> <span class="o">=</span> <span class="n">el_n</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-507"></a>                                    <span class="n">tind</span> <span class="o">=</span> <span class="n">tind4</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-508"></a>                                   <span class="n">m_elt</span> <span class="o">=</span> <span class="n">k4</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-509"></a>                                   <span class="n">compt</span> <span class="o">=</span> <span class="n">compt</span><span class="p">)</span>
<a name="ln-510"></a>         <span class="n">endif</span>
<a name="ln-511"></a>
<a name="ln-512"></a>      <span class="n">enddo</span>
<a name="ln-513"></a>
<a name="ln-514"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">==</span> <span class="n">ASS</span><span class="p">)</span> <span class="n">mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-515"></a>   <span class="k">return</span>
<a name="ln-516"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">assembly_FE_film_reynolds</span>
<a name="ln-517"></a>
<a name="ln-518"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-519"></a>   <span class="c">!&lt; @note Subroutine to assemble elemental matrices in the solver matrices</span>
<a name="ln-520"></a>   <span class="c">!&lt;</span>
<a name="ln-521"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-522"></a>   <span class="k">subroutine </span><span class="n">assemble_in_mat_sol</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">nelt</span><span class="p">,</span> <span class="n">nline</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">m_elt</span><span class="p">,</span> <span class="n">compt</span><span class="p">)</span>
<a name="ln-523"></a>   <span class="k">implicit none</span>
<a name="ln-524"></a><span class="k">   type</span><span class="p">(</span><span class="n">MAT_SOLV</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">mat</span>     <span class="c">!! *mat_solv type*</span>
<a name="ln-525"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                        <span class="kd">::</span> <span class="n">num</span>     <span class="c">!! *element number*</span>
<a name="ln-526"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                        <span class="kd">::</span> <span class="n">nelt</span>    <span class="c">!! *size of elemental matrix*</span>
<a name="ln-527"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                        <span class="kd">::</span> <span class="n">nline</span>   <span class="c">!! *number of lines*</span>
<a name="ln-528"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nelt</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">tind</span>    <span class="c">!! *index table of elemental matrix*</span>
<a name="ln-529"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nelt</span><span class="p">,</span> <span class="n">nelt</span><span class="p">)</span> <span class="kd">::</span> <span class="n">m_elt</span>   <span class="c">!! *elemental matrix*</span>
<a name="ln-530"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">compt</span>   <span class="c">!! *number to index the position in the solver matrix*</span>
<a name="ln-531"></a>
<a name="ln-532"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-533"></a>
<a name="ln-534"></a>      <span class="c">! check compt</span>
<a name="ln-535"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mat</span><span class="p">%</span><span class="n">nt</span><span class="p">)</span> <span class="k">stop</span> <span class="s1">&#39;compt &gt; matrix size in assemble_in_mat_sol&#39;</span>
<a name="ln-536"></a>
<a name="ln-537"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nline</span>
<a name="ln-538"></a>         <span class="n">mat</span><span class="p">%</span><span class="n">eltvar</span><span class="p">(</span><span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">tind</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-539"></a>         <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-540"></a>      <span class="n">enddo</span>
<a name="ln-541"></a>      <span class="n">mat</span><span class="p">%</span><span class="n">eltptr</span><span class="p">(</span><span class="n">num</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-542"></a>
<a name="ln-543"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nelt</span>
<a name="ln-544"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nelt</span>
<a name="ln-545"></a>            <span class="n">mat</span><span class="p">%</span><span class="n">a_elt</span><span class="p">(</span><span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">m_elt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-546"></a>            <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">compt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-547"></a>         <span class="n">enddo</span>
<a name="ln-548"></a>      <span class="n">enddo</span>
<a name="ln-549"></a>   <span class="k">return</span>
<a name="ln-550"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">assemble_in_mat_sol</span>
<a name="ln-551"></a>
<a name="ln-552"></a>
<a name="ln-553"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-554"></a>   <span class="c">!&lt; @note Subroutine to solve a [[FE_FILM]]</span>
<a name="ln-555"></a>   <span class="c">!&lt;</span>
<a name="ln-556"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-557"></a>   <span class="k">subroutine </span><span class="n">elementary_assembly_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">ke_ij</span><span class="p">,</span> <span class="n">be_i</span><span class="p">,</span> <span class="n">ind_e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ass_c</span><span class="p">)</span>
<a name="ln-558"></a>   <span class="k">implicit none</span>
<a name="ln-559"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                              <span class="kd">::</span> <span class="n">fe_f</span>      <span class="c">!! *FE film*</span>
<a name="ln-560"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">out</span>  <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">,</span> <span class="n">MAX_NNE</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ke_ij</span>     <span class="c">!! *elementary matrix*</span>
<a name="ln-561"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">out</span>  <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">be_i</span>      <span class="c">!! *elementary rhs member*</span>
<a name="ln-562"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span>  <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ind_e</span>     <span class="c">!! *elementary index member*</span>
<a name="ln-563"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                              <span class="kd">::</span> <span class="n">e</span>         <span class="c">!! *element number*</span>
<a name="ln-564"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span>                              <span class="kd">::</span> <span class="n">ass_c</span>     <span class="c">!! *assembly type*</span>
<a name="ln-565"></a>
<a name="ln-566"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNG</span><span class="p">,</span> <span class="n">MAX_NNG</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vni4x</span><span class="p">,</span> <span class="n">vni4y</span>
<a name="ln-567"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">con</span>
<a name="ln-568"></a>
<a name="ln-569"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-570"></a>
<a name="ln-571"></a>      <span class="n">ng</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">ng</span>
<a name="ln-572"></a>      <span class="n">ne</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-573"></a>      <span class="c">! check of precomputed tables allocation</span>
<a name="ln-574"></a>      <span class="c">!~ if (.not.allocated(fe_f%prc%vcal)) call init_prc_tab(fe_f)</span>
<a name="ln-575"></a>      <span class="c">! assembly</span>
<a name="ln-576"></a>      <span class="k">call </span><span class="n">compute_prc_tables_reynolds_supg</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a name="ln-577"></a>
<a name="ln-578"></a>      <span class="n">con</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ne</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ne</span><span class="p">)</span>
<a name="ln-579"></a>
<a name="ln-580"></a>      <span class="n">ke_ij</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-581"></a>      <span class="n">ind_e</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-582"></a>      <span class="n">be_i</span>  <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-583"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ne</span>
<a name="ln-584"></a>         <span class="n">ii</span> <span class="o">=</span> <span class="n">con</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-585"></a>         <span class="n">ind_e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ii</span>
<a name="ln-586"></a>         <span class="c">! case of nodes on the boundary</span>
<a name="ln-587"></a>         <span class="k">if</span>  <span class="p">((</span><span class="n">fe_f</span><span class="p">%</span><span class="n">bc</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">REY</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">ass_c</span> <span class="o">/=</span> <span class="n">NO_BC</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-588"></a><span class="k">            </span><span class="n">ke_ij</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="mf">1.0e10</span>
<a name="ln-589"></a>          <span class="c">! case of nodes where the pressure is unknown</span>
<a name="ln-590"></a>         <span class="k">else</span>
<a name="ln-591"></a>
<a name="ln-592"></a><span class="k">            </span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>
<a name="ln-593"></a>            <span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>
<a name="ln-594"></a>
<a name="ln-595"></a>            <span class="n">be_i</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">be_i</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">))</span> <span class="p">)</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-596"></a>                              <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-597"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-598"></a>               <span class="n">jj</span> <span class="o">=</span> <span class="n">con</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-599"></a>               <span class="n">ke_ij</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4x</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>   <span class="p">&amp;</span>
<a name="ln-600"></a>                                  <span class="o">+</span><span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4y</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">))</span><span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-601"></a>                           <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>    <span class="p">&amp;</span>
<a name="ln-602"></a>                                 <span class="o">+</span> <span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">))</span><span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">))</span><span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-603"></a>                           <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>                             <span class="p">&amp;</span>
<a name="ln-604"></a>                                 <span class="o">+</span> <span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">))</span>                            <span class="p">&amp;</span>
<a name="ln-605"></a>                                 <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4d</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">*</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="p">)</span> <span class="c">!better convergence</span>
<a name="ln-606"></a>              <span class="n">enddo</span>
<a name="ln-607"></a>          <span class="n">endif</span>
<a name="ln-608"></a>      <span class="n">enddo</span>
<a name="ln-609"></a>   <span class="k">return</span>
<a name="ln-610"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">elementary_assembly_FE_film_reynolds</span>
<a name="ln-611"></a>
<a name="ln-612"></a>
<a name="ln-613"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-614"></a>   <span class="c">!&lt; @note Calculate the elementary matrices on a full domain</span>
<a name="ln-615"></a>   <span class="c">!&lt;</span>
<a name="ln-616"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-617"></a>   <span class="k">subroutine </span><span class="n">elementary_full_domain_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">ke_ij</span><span class="p">,</span> <span class="n">be_i</span><span class="p">,</span> <span class="n">ind_e</span><span class="p">)</span>
<a name="ln-618"></a>   <span class="k">implicit none</span>
<a name="ln-619"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                              <span class="kd">::</span> <span class="n">fe_f</span>   <span class="c">!! *FE film*</span>
<a name="ln-620"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MAT_SOLV</span><span class="p">),</span>   <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                              <span class="kd">::</span> <span class="n">mat</span>    <span class="c">!! *solver type matrices*</span>
<a name="ln-621"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">out</span>  <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">,</span> <span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ke_ij</span>  <span class="c">!! *elementary matrix*</span>
<a name="ln-622"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span>         <span class="p">)</span> <span class="kd">::</span> <span class="n">be_i</span>   <span class="c">!! *elementary rhs member*</span>
<a name="ln-623"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span>  <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span>         <span class="p">)</span> <span class="kd">::</span> <span class="n">ind_e</span>  <span class="c">!! *elementary index member*</span>
<a name="ln-624"></a>
<a name="ln-625"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">nbc</span><span class="p">,</span> <span class="n">nc</span>
<a name="ln-626"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flag</span>
<a name="ln-627"></a>
<a name="ln-628"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NBS</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ind_n</span>
<a name="ln-629"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NBS</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sav_vn</span>
<a name="ln-630"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span><span class="p">,</span> <span class="n">dp</span>
<a name="ln-631"></a>
<a name="ln-632"></a>      <span class="n">nc</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nc</span>
<a name="ln-633"></a>
<a name="ln-634"></a>      <span class="c">! check of precomputed tables allocation</span>
<a name="ln-635"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">))</span> <span class="k">call </span><span class="n">init_prc_tab</span><span class="p">(</span><span class="n">fe_f</span><span class="p">)</span>
<a name="ln-636"></a>
<a name="ln-637"></a>      <span class="c">! boundary condition initialization</span>
<a name="ln-638"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">BC_SPLINE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-639"></a><span class="k">         </span><span class="n">bc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">)</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-640"></a>      <span class="k">else</span>
<a name="ln-641"></a><span class="k">         </span><span class="n">bc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">)</span> <span class="o">=</span> <span class="n">be_i</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">)</span>
<a name="ln-642"></a>      <span class="n">endif</span>
<a name="ln-643"></a>
<a name="ln-644"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-645"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ned</span>
<a name="ln-646"></a>      <span class="k">do </span><span class="n">ee</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">n</span>
<a name="ln-647"></a>         <span class="n">ind_n</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>  <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>
<a name="ln-648"></a>         <span class="n">sav_vn</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind_n</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">P_N</span><span class="p">)</span>
<a name="ln-649"></a>         <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-650"></a>      <span class="n">enddo</span>
<a name="ln-651"></a>      <span class="n">enddo</span>
<a name="ln-652"></a>      <span class="n">nbc</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-653"></a>
<a name="ln-654"></a>      <span class="c">! matrices</span>
<a name="ln-655"></a>      <span class="n">ke_ij</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-656"></a>      <span class="n">ind_e</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-657"></a>      <span class="n">be_i</span>  <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-658"></a>
<a name="ln-659"></a>      <span class="c">! calculation of the elementary matrix</span>
<a name="ln-660"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nc</span> <span class="c">! number of corners</span>
<a name="ln-661"></a>         <span class="n">ii</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-662"></a>         <span class="n">ind_e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ii</span>
<a name="ln-663"></a>
<a name="ln-664"></a>         <span class="n">dp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
<a name="ln-665"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">BC_SPLINE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-666"></a><span class="k">            </span><span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">dp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-667"></a>         <span class="k">else</span>
<a name="ln-668"></a><span class="k">            </span><span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">dp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-669"></a>         <span class="n">endif</span>
<a name="ln-670"></a>
<a name="ln-671"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">flag</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-672"></a>
<a name="ln-673"></a>         <span class="k">call </span><span class="n">solve_FE_film</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>     <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-674"></a>                             <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>      <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-675"></a>                              <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">,</span>       <span class="p">&amp;</span>  <span class="c">! in</span>
<a name="ln-676"></a>                        <span class="n">flag_ass</span> <span class="o">=</span> <span class="n">flag</span><span class="p">)</span>        <span class="c">!</span>
<a name="ln-677"></a>
<a name="ln-678"></a>         <span class="n">flag</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-679"></a>
<a name="ln-680"></a>         <span class="k">call </span><span class="n">compute_corner_fluxes</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>      <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-681"></a>                                     <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>       <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-682"></a>                                      <span class="n">bf</span> <span class="o">=</span> <span class="n">be_i</span><span class="p">)</span>         <span class="c">! out</span>
<a name="ln-683"></a>
<a name="ln-684"></a>         <span class="n">ke_ij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span> <span class="n">be_i</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">)</span> <span class="o">/</span> <span class="n">dp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-685"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">BC_SPLINE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-686"></a><span class="k">            </span><span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-687"></a>         <span class="k">else</span>
<a name="ln-688"></a><span class="k">            </span><span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">bc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span><span class="n">dp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-689"></a>         <span class="n">endif</span>
<a name="ln-690"></a>
<a name="ln-691"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbc</span>
<a name="ln-692"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(</span><span class="n">ind_n</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">P_N</span><span class="p">)</span> <span class="o">=</span> <span class="n">sav_vn</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-693"></a>         <span class="n">enddo</span>
<a name="ln-694"></a>
<a name="ln-695"></a>      <span class="n">enddo</span>
<a name="ln-696"></a>
<a name="ln-697"></a>      <span class="c">! calculation of the RHS table</span>
<a name="ln-698"></a>      <span class="k">call </span><span class="n">solve_FE_film</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>     <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-699"></a>                          <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>      <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-700"></a>                           <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">,</span>       <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-701"></a>                     <span class="n">flag_ass</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.)</span>     <span class="c">!</span>
<a name="ln-702"></a>
<a name="ln-703"></a>      <span class="k">call </span><span class="n">compute_corner_fluxes</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>      <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-704"></a>                                  <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>       <span class="p">&amp;</span>  <span class="c">!</span>
<a name="ln-705"></a>                                   <span class="n">bf</span> <span class="o">=</span> <span class="n">be_i</span><span class="p">)</span>         <span class="c">! out</span>
<a name="ln-706"></a>
<a name="ln-707"></a>      <span class="c">! update of the matrix: the derivative is the difference</span>
<a name="ln-708"></a>      <span class="c">! between the residuals divided by the delta p</span>
<a name="ln-709"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nc</span>
<a name="ln-710"></a>         <span class="n">ke_ij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ke_ij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">be_i</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="p">)</span><span class="o">/</span><span class="n">dp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-711"></a>      <span class="n">enddo</span>
<a name="ln-712"></a>   <span class="k">return</span>
<a name="ln-713"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">elementary_full_domain_FE_film_reynolds</span>
<a name="ln-714"></a>
<a name="ln-715"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-716"></a>   <span class="c">!&lt; @note Subroutine to calculate the precomputed tables on a FE_film</span>
<a name="ln-717"></a>   <span class="c">!&lt;</span>
<a name="ln-718"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-719"></a>   <span class="k">subroutine </span><span class="n">init_prc_tab</span><span class="p">(</span><span class="n">fe_f</span><span class="p">)</span>
<a name="ln-720"></a>   <span class="k">implicit none</span>
<a name="ln-721"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span>         <span class="c">! *FE film*</span>
<a name="ln-722"></a>
<a name="ln-723"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ng</span>
<a name="ln-724"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">pg</span><span class="p">,</span> <span class="n">wg</span>
<a name="ln-725"></a>
<a name="ln-726"></a>      <span class="c">! number of Gauss points</span>
<a name="ln-727"></a>      <span class="n">ng</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-728"></a>
<a name="ln-729"></a>      <span class="c">! table allocation</span>
<a name="ln-730"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">pg</span><span class="p">(</span><span class="n">ng</span><span class="p">),</span> <span class="n">wg</span><span class="p">(</span><span class="n">ng</span><span class="p">))</span>
<a name="ln-731"></a>      <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">ng</span> <span class="o">=</span> <span class="n">ng</span>
<a name="ln-732"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">pg</span><span class="p">(</span><span class="n">ng</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-733"></a>                <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">wg</span><span class="p">(</span><span class="n">ng</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-734"></a>                <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-735"></a>                <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4y</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-737"></a>                <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4d</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-738"></a>                <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-739"></a>      <span class="c">! Gauss points definition</span>
<a name="ln-740"></a>      <span class="n">pg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">1._R8</span> <span class="o">/</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mf">3._R8</span><span class="p">)</span>
<a name="ln-741"></a>      <span class="n">pg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span> <span class="n">pg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-742"></a>      <span class="n">wg</span>    <span class="o">=</span> <span class="mf">1._R8</span>
<a name="ln-743"></a>
<a name="ln-744"></a>      <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">pg</span> <span class="o">=</span> <span class="n">pg</span>
<a name="ln-745"></a>      <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">wg</span> <span class="o">=</span> <span class="n">wg</span>
<a name="ln-746"></a>
<a name="ln-747"></a>      <span class="c">! precomputation of shape functions and derivatives at the Gauss points</span>
<a name="ln-748"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ng</span>
<a name="ln-749"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ng</span>
<a name="ln-750"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
<a name="ln-751"></a>               <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">ni4</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">pg</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a name="ln-752"></a>            <span class="n">enddo</span>
<a name="ln-753"></a>         <span class="n">enddo</span>
<a name="ln-754"></a>      <span class="n">enddo</span>
<a name="ln-755"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">pg</span><span class="p">,</span> <span class="n">wg</span><span class="p">)</span>
<a name="ln-756"></a>   <span class="k">return</span>
<a name="ln-757"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">init_prc_tab</span>
<a name="ln-758"></a>
<a name="ln-759"></a>
<a name="ln-760"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-761"></a>   <span class="c">!&gt; @note Subroutine to calculate the precomputed tables on a [[FE_FILM]]</span>
<a name="ln-762"></a>   <span class="c">!  @endnote</span>
<a name="ln-763"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-764"></a>   <span class="k">subroutine </span><span class="n">compute_prc_tables_reynolds_supg</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a name="ln-765"></a>   <span class="k">implicit none</span>
<a name="ln-766"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_film</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span>      <span class="c">!! *FE film*</span>
<a name="ln-767"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span>   <span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>         <span class="c">!! *element number*</span>
<a name="ln-768"></a>
<a name="ln-769"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">nne</span>
<a name="ln-770"></a>      <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gaz</span>
<a name="ln-771"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tvx</span><span class="p">,</span> <span class="n">tvy</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">trho</span><span class="p">,</span> <span class="n">tmu</span><span class="p">,</span> <span class="n">tdrdp</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tnix</span><span class="p">,</span> <span class="n">tniy</span>
<a name="ln-772"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNG</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wg</span><span class="p">,</span> <span class="n">pg</span>
<a name="ln-773"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c5</span><span class="p">,</span> <span class="n">vc1</span>
<a name="ln-774"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pe_ux</span><span class="p">,</span> <span class="n">Pe_uy</span><span class="p">,</span> <span class="n">Pe_u</span><span class="p">,</span> <span class="n">Pe_vx</span><span class="p">,</span> <span class="n">Pe_vy</span><span class="p">,</span> <span class="n">Pe_v</span><span class="p">,</span> <span class="n">coeff_x</span><span class="p">,</span> <span class="n">coeff_y</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-775"></a>
<a name="ln-776"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">alpha_u</span><span class="p">,</span> <span class="n">alpha_ux</span><span class="p">,</span> <span class="n">alpha_uy</span><span class="p">,</span> <span class="n">alpha_vx</span><span class="p">,</span> <span class="n">alpha_vy</span><span class="p">,</span> <span class="n">alpha_v</span>
<a name="ln-777"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dNidx_p</span><span class="p">,</span> <span class="n">dNidy_p</span><span class="p">,</span> <span class="n">Nid_rho_h</span><span class="p">,</span> <span class="n">Ni_p</span><span class="p">,</span> <span class="n">Ni_h</span><span class="p">,</span> <span class="n">Ni_h3</span><span class="p">,</span> <span class="n">Ni_vx</span><span class="p">,</span> <span class="n">Ni_vy</span><span class="p">,</span> <span class="n">Ni_mu</span><span class="p">,</span> <span class="n">Ni_rho</span><span class="p">,</span> <span class="n">Ni_inv_h</span><span class="p">,</span> <span class="n">Ni_inv_mu</span>
<a name="ln-778"></a>
<a name="ln-779"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lu</span><span class="p">,</span> <span class="n">wu</span><span class="p">,</span> <span class="n">lv</span><span class="p">,</span> <span class="n">wv</span>
<a name="ln-780"></a>
<a name="ln-781"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ni_drhodp</span><span class="p">,</span> <span class="n">gradh</span><span class="p">,</span> <span class="n">gradhx</span><span class="p">,</span> <span class="n">gradhy</span><span class="p">,</span> <span class="n">gradp</span><span class="p">,</span> <span class="n">gradpx</span><span class="p">,</span> <span class="n">gradpy</span>
<a name="ln-782"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">drdp</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span>
<a name="ln-783"></a>
<a name="ln-784"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNE</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vni4</span><span class="p">,</span> <span class="n">vni4x</span><span class="p">,</span> <span class="n">vni4y</span><span class="p">,</span> <span class="n">vni4d</span>
<a name="ln-785"></a>
<a name="ln-786"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vcal</span>
<a name="ln-787"></a>
<a name="ln-788"></a>      <span class="c">!============================================</span>
<a name="ln-789"></a>      <span class="c">!&gt; {!src/inc_doc/Reynolds_discretization.md!}</span>
<a name="ln-790"></a>      <span class="c">!============================================</span>
<a name="ln-791"></a>
<a name="ln-792"></a>
<a name="ln-793"></a>      <span class="c">!============================================</span>
<a name="ln-794"></a>      <span class="c">!&gt; {!src/inc_doc/upwinding_coefficients.md!}</span>
<a name="ln-795"></a>      <span class="c">!============================================</span>
<a name="ln-796"></a>
<a name="ln-797"></a>      <span class="n">gaz</span> <span class="o">=</span> <span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">data_f</span><span class="p">%</span><span class="n">fl</span><span class="p">%</span><span class="n">fluid_type</span><span class="o">==</span><span class="n">GP</span><span class="p">)</span>
<a name="ln-798"></a>      <span class="n">nne</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">el_t</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="ln-799"></a>
<a name="ln-800"></a>      <span class="c">! values on the nodes</span>
<a name="ln-801"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nne</span>
<a name="ln-802"></a>         <span class="n">j</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">con</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-803"></a>         <span class="n">tx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>           <span class="c">! coordinates</span>
<a name="ln-804"></a>         <span class="n">ty</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-805"></a>         <span class="n">tvx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">VX_N</span><span class="p">)</span>     <span class="c">! velocities</span>
<a name="ln-806"></a>         <span class="n">tvy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">VY_N</span><span class="p">)</span>
<a name="ln-807"></a>         <span class="n">th</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">H_N</span><span class="p">)</span>      <span class="c">! heigth</span>
<a name="ln-808"></a>         <span class="n">tp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">P_N</span><span class="p">)</span>      <span class="c">! pressure</span>
<a name="ln-809"></a>         <span class="n">trho</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">RHO_N</span><span class="p">)</span>    <span class="c">! density</span>
<a name="ln-810"></a>         <span class="n">tmu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">MU_N</span><span class="p">)</span>     <span class="c">! viscosity</span>
<a name="ln-811"></a>         <span class="n">tdrdp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">DRHODP_N</span><span class="p">)</span> <span class="c">! viscosity derivative regarding P</span>
<a name="ln-812"></a>      <span class="n">enddo</span>
<a name="ln-813"></a>
<a name="ln-814"></a>      <span class="n">c5</span> <span class="o">=</span> <span class="n">dj4</span><span class="p">(</span><span class="n">ksi</span><span class="o">=</span><span class="mf">0._R8</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">0._R8</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-815"></a>      <span class="k">call </span><span class="n">calc_ni4_xy_derivatives</span><span class="p">(</span><span class="n">ni4x</span> <span class="o">=</span> <span class="n">tnix</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-816"></a>                                   <span class="n">ni4y</span> <span class="o">=</span> <span class="n">tniy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-817"></a>                                    <span class="n">ksi</span> <span class="o">=</span> <span class="mf">0._R8</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-818"></a>                                    <span class="n">eta</span> <span class="o">=</span> <span class="mf">0._R8</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-819"></a>                                      <span class="n">x</span> <span class="o">=</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span>   <span class="p">&amp;</span>
<a name="ln-820"></a>                                      <span class="n">y</span> <span class="o">=</span> <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span>   <span class="p">&amp;</span>
<a name="ln-821"></a>                                     <span class="n">dj</span> <span class="o">=</span> <span class="n">c5</span><span class="p">)</span>
<a name="ln-822"></a>
<a name="ln-823"></a>      <span class="c">! addition of the groove depth</span>
<a name="ln-824"></a>      <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">=</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">+</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">HG_C</span><span class="p">)</span>
<a name="ln-825"></a>
<a name="ln-826"></a>      <span class="n">ux</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tvx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span><span class="o">/</span><span class="n">nne</span>
<a name="ln-827"></a>      <span class="n">uy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tvy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span><span class="o">/</span><span class="n">nne</span>
<a name="ln-828"></a>      <span class="n">u</span>  <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<a name="ln-829"></a>
<a name="ln-830"></a>      <span class="n">h</span>    <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">th</span>   <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span><span class="o">/</span><span class="n">nne</span>
<a name="ln-831"></a>      <span class="n">drdp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tdrdp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span><span class="o">/</span><span class="n">nne</span>
<a name="ln-832"></a>      <span class="n">mu</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmu</span>  <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span><span class="o">/</span><span class="n">nne</span>
<a name="ln-833"></a>      <span class="n">rho</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">trho</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span><span class="o">/</span><span class="n">nne</span>
<a name="ln-834"></a>
<a name="ln-835"></a>      <span class="n">gradpx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">tp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span><span class="o">*</span><span class="n">tnix</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-836"></a>      <span class="n">gradpy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">tp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span><span class="o">*</span><span class="n">tniy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-837"></a>
<a name="ln-838"></a>      <span class="n">gradp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span> <span class="n">gradpx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">gradpy</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<a name="ln-839"></a>
<a name="ln-840"></a>      <span class="n">gradhx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span><span class="o">*</span><span class="n">tnix</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-841"></a>      <span class="n">gradhy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span><span class="o">*</span><span class="n">tniy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-842"></a>
<a name="ln-843"></a>      <span class="n">gradh</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span> <span class="n">gradhx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">gradhy</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<a name="ln-844"></a>
<a name="ln-845"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">drdp</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-846"></a>
<a name="ln-847"></a>      <span class="c">! Gauss points</span>
<a name="ln-848"></a>      <span class="n">ng</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">ng</span>
<a name="ln-849"></a>
<a name="ln-850"></a>      <span class="n">pg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">pg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>
<a name="ln-851"></a>      <span class="n">wg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">wg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">)</span>
<a name="ln-852"></a>
<a name="ln-853"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">gaz</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-854"></a>
<a name="ln-855"></a><span class="k">         </span><span class="n">v</span>  <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">mu</span><span class="p">)</span>
<a name="ln-856"></a>         <span class="n">vx</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">gradpx</span>
<a name="ln-857"></a>         <span class="n">vy</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">gradpy</span>
<a name="ln-858"></a>         <span class="n">v</span>  <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span> <span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<a name="ln-859"></a>
<a name="ln-860"></a>         <span class="k">call </span><span class="n">length_width_elem</span><span class="p">(</span><span class="n">spdx</span> <span class="o">=</span> <span class="n">ux</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, speed u along x</span>
<a name="ln-861"></a>                                <span class="n">spdy</span> <span class="o">=</span> <span class="n">uy</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, speed u along y</span>
<a name="ln-862"></a>                                   <span class="n">x</span> <span class="o">=</span> <span class="n">tx</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, element x coordinates</span>
<a name="ln-863"></a>                                   <span class="n">y</span> <span class="o">=</span> <span class="n">ty</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, element y coordinates</span>
<a name="ln-864"></a>                              <span class="n">length</span> <span class="o">=</span> <span class="n">lu</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">! out, length along u</span>
<a name="ln-865"></a>                               <span class="n">width</span> <span class="o">=</span> <span class="n">wu</span><span class="p">)</span>   <span class="c">! out,  width</span>
<a name="ln-866"></a>
<a name="ln-867"></a>         <span class="k">call </span><span class="n">length_width_elem</span><span class="p">(</span><span class="n">spdx</span> <span class="o">=</span> <span class="n">vx</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, speed v along x</span>
<a name="ln-868"></a>                                <span class="n">spdy</span> <span class="o">=</span> <span class="n">vy</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, speed v along y</span>
<a name="ln-869"></a>                                   <span class="n">x</span> <span class="o">=</span> <span class="n">tx</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, element x coordinates</span>
<a name="ln-870"></a>                                   <span class="n">y</span> <span class="o">=</span> <span class="n">ty</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!  in, element y coordinates</span>
<a name="ln-871"></a>                              <span class="n">length</span> <span class="o">=</span> <span class="n">lv</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">! out, length along v</span>
<a name="ln-872"></a>                               <span class="n">width</span> <span class="o">=</span> <span class="n">wv</span><span class="p">)</span>   <span class="c">! out,  width</span>
<a name="ln-873"></a>
<a name="ln-874"></a>         <span class="c">! Peclet number related to u</span>
<a name="ln-875"></a>         <span class="n">Pe_ux</span> <span class="o">=</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">lu</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">kk</span>
<a name="ln-876"></a>         <span class="n">Pe_uy</span> <span class="o">=</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">lu</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">kk</span>
<a name="ln-877"></a>         <span class="n">Pe_u</span>  <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">Pe_ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">Pe_uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-878"></a>
<a name="ln-879"></a>         <span class="c">! Peclet number related to v</span>
<a name="ln-880"></a>         <span class="n">Pe_vx</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">*</span> <span class="p">(</span><span class="n">wu</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">kk</span>
<a name="ln-881"></a>         <span class="n">Pe_vy</span> <span class="o">=</span> <span class="n">vy</span> <span class="o">*</span> <span class="p">(</span><span class="n">wu</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">kk</span>
<a name="ln-882"></a>         <span class="n">Pe_v</span>  <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">Pe_vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">Pe_vy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-883"></a>
<a name="ln-884"></a>         <span class="n">alpha_ux</span> <span class="o">=</span> <span class="n">Pe_ux</span>
<a name="ln-885"></a>         <span class="n">alpha_uy</span> <span class="o">=</span> <span class="n">Pe_uy</span>
<a name="ln-886"></a>         <span class="n">alpha_u</span>  <span class="o">=</span> <span class="n">Pe_u</span>
<a name="ln-887"></a>
<a name="ln-888"></a>         <span class="n">alpha_v</span>  <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mf">1.e6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">/</span><span class="mf">1.e2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="o">/</span><span class="mf">1.e-5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">wu</span><span class="o">/</span><span class="n">lu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">Pe_vx</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">uy</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pe_vy</span> <span class="o">*</span> <span class="p">(</span><span class="o">+</span><span class="n">ux</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="n">u</span>
<a name="ln-889"></a>         <span class="n">alpha_vx</span> <span class="o">=</span> <span class="n">alpha_v</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">uy</span><span class="p">)</span><span class="o">/</span><span class="n">u</span>
<a name="ln-890"></a>         <span class="n">alpha_vy</span> <span class="o">=</span> <span class="n">alpha_v</span> <span class="o">*</span> <span class="p">(</span><span class="o">+</span><span class="n">ux</span><span class="p">)</span><span class="o">/</span><span class="n">u</span>
<a name="ln-891"></a>         <span class="n">alpha_v</span>  <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">alpha_vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">alpha_vy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-892"></a>
<a name="ln-893"></a>         <span class="n">coeff_x</span> <span class="o">=</span> <span class="n">alpha_ux</span> <span class="o">+</span><span class="n">alpha_vx</span> <span class="p">;</span> <span class="n">sx</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span><span class="mf">1._R8</span><span class="p">,</span> <span class="n">coeff_x</span><span class="p">)</span> <span class="p">;</span> <span class="n">coeff_x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeff_x</span><span class="p">)</span>
<a name="ln-894"></a>         <span class="n">coeff_y</span> <span class="o">=</span> <span class="n">alpha_uy</span> <span class="o">+</span><span class="n">alpha_vy</span> <span class="p">;</span> <span class="n">sy</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span><span class="mf">1._R8</span><span class="p">,</span> <span class="n">coeff_y</span><span class="p">)</span> <span class="p">;</span> <span class="n">coeff_y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeff_y</span><span class="p">)</span>
<a name="ln-895"></a>
<a name="ln-896"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">PEK_C</span><span class="p">)</span> <span class="o">=</span> <span class="n">sx</span><span class="o">*</span><span class="n">coeff_x</span>
<a name="ln-897"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">PEE_C</span><span class="p">)</span> <span class="o">=</span> <span class="n">sy</span><span class="o">*</span><span class="n">coeff_y</span>
<a name="ln-898"></a>
<a name="ln-899"></a>      <span class="k">else</span>
<a name="ln-900"></a>
<a name="ln-901"></a><span class="k">         </span><span class="n">lu</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span> <span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-902"></a>         <span class="n">wu</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span> <span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-903"></a>         <span class="n">lv</span> <span class="o">=</span> <span class="n">lu</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">wu</span> <span class="o">*</span> <span class="n">uy</span>
<a name="ln-904"></a>         <span class="n">Pe_ux</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="p">(</span><span class="n">lv</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-905"></a>         <span class="n">Pe_uy</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-906"></a>         <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Pe_ux</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-2_R8</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-907"></a><span class="k">            </span><span class="n">Pe_ux</span> <span class="o">=</span> <span class="n">Pe_ux</span> <span class="o">/</span> <span class="mi">3</span>
<a name="ln-908"></a>         <span class="k">else</span>
<a name="ln-909"></a><span class="k">            </span><span class="n">Pe_ux</span> <span class="o">=</span> <span class="mf">1._R8</span> <span class="o">/</span> <span class="p">(</span><span class="nb">tanh</span><span class="p">(</span><span class="n">Pe_ux</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1._R8</span> <span class="o">/</span> <span class="n">Pe_ux</span>
<a name="ln-910"></a>         <span class="n">endif</span>
<a name="ln-911"></a>         <span class="n">alpha_vx</span> <span class="o">=</span> <span class="mf">1._r8</span>
<a name="ln-912"></a>         <span class="n">alpha_vy</span> <span class="o">=</span> <span class="mf">1._r8</span>
<a name="ln-913"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="mf">0._r8</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-914"></a><span class="k">            </span><span class="n">alpha_vx</span> <span class="o">=</span> <span class="n">lv</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<a name="ln-915"></a>            <span class="n">alpha_vy</span> <span class="o">=</span> <span class="n">lv</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<a name="ln-916"></a>         <span class="n">endif</span>
<a name="ln-917"></a>
<a name="ln-918"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Pek_c</span><span class="p">)</span> <span class="o">=</span> <span class="n">alpha_vx</span>
<a name="ln-919"></a>         <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Pee_c</span><span class="p">)</span> <span class="o">=</span> <span class="n">alpha_vy</span>
<a name="ln-920"></a>
<a name="ln-921"></a>      <span class="n">endif</span>
<a name="ln-922"></a>
<a name="ln-923"></a>      <span class="c">!=============================================</span>
<a name="ln-924"></a>      <span class="c">!&gt; {!src/inc_doc/precomputed_integrations.md!}</span>
<a name="ln-925"></a>      <span class="c">!=============================================</span>
<a name="ln-926"></a>
<a name="ln-927"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ng</span>
<a name="ln-928"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ng</span>
<a name="ln-929"></a>
<a name="ln-930"></a>            <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-931"></a>
<a name="ln-932"></a>            <span class="c">! computation of the shape function derivatives</span>
<a name="ln-933"></a>            <span class="n">c5</span> <span class="o">=</span> <span class="n">dj4</span><span class="p">(</span><span class="n">ksi</span><span class="o">=</span><span class="n">pg</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">eta</span><span class="o">=</span><span class="n">pg</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-934"></a>            <span class="k">call </span><span class="n">calc_ni4_xy_derivatives</span><span class="p">(</span><span class="n">ni4x</span> <span class="o">=</span> <span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-935"></a>                                         <span class="n">ni4y</span> <span class="o">=</span> <span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-936"></a>                                          <span class="n">ksi</span> <span class="o">=</span> <span class="n">pg</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>        <span class="p">&amp;</span>
<a name="ln-937"></a>                                          <span class="n">eta</span> <span class="o">=</span> <span class="n">pg</span><span class="p">(</span><span class="n">j</span><span class="p">),</span>        <span class="p">&amp;</span>
<a name="ln-938"></a>                                            <span class="n">x</span> <span class="o">=</span> <span class="n">tx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span>    <span class="p">&amp;</span>
<a name="ln-939"></a>                                            <span class="n">y</span> <span class="o">=</span> <span class="n">ty</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">),</span>    <span class="p">&amp;</span>
<a name="ln-940"></a>                                           <span class="n">dj</span> <span class="o">=</span> <span class="n">c5</span><span class="p">)</span>
<a name="ln-941"></a>
<a name="ln-942"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">c5</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">stop</span> <span class="s1">&#39;compute_prc_tables_reynolds_supg: jacobian negative for elt&#39;</span>
<a name="ln-943"></a>
<a name="ln-944"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">gaz</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-945"></a><span class="k">               do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nne</span>
<a name="ln-946"></a>                  <span class="n">vni4d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">ni4_up_2d</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">pg</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">pg</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">coeff_x</span><span class="p">,</span> <span class="n">coeff_y</span><span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="o">/</span><span class="p">))</span>
<a name="ln-947"></a>               <span class="n">enddo</span>
<a name="ln-948"></a>            <span class="k">else</span>
<a name="ln-949"></a><span class="k">               </span><span class="n">vni4d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">=</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">-</span><span class="n">alpha_vx</span><span class="o">*</span><span class="n">Pe_ux</span><span class="o">*</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">-</span><span class="n">alpha_vy</span><span class="o">*</span><span class="n">Pe_ux</span><span class="o">*</span><span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span>
<a name="ln-950"></a>            <span class="n">endif</span>
<a name="ln-951"></a>
<a name="ln-952"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span>
<a name="ln-953"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span>
<a name="ln-954"></a>
<a name="ln-955"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vni4d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">vni4d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span>
<a name="ln-956"></a>
<a name="ln-957"></a>            <span class="c">! computation of the coefficients for the Reynolds equation</span>
<a name="ln-958"></a>            <span class="n">vc1</span> <span class="o">=</span> <span class="n">wg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">wg</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">c5</span>
<a name="ln-959"></a>
<a name="ln-960"></a>            <span class="n">dNidx_p</span>     <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vni4x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-961"></a>            <span class="n">dNidy_p</span>     <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vni4y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-962"></a>
<a name="ln-963"></a>            <span class="n">Nid_rho_h</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vni4d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">trho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-964"></a>
<a name="ln-965"></a>            <span class="n">Ni_p</span>        <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-966"></a>            <span class="n">Ni_h</span>        <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-967"></a>            <span class="n">Ni_h3</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-968"></a>
<a name="ln-969"></a>            <span class="n">Ni_vx</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tvx</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-970"></a>            <span class="n">Ni_vy</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tvy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-971"></a>            <span class="n">Ni_mu</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tmu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-972"></a>            <span class="n">Ni_rho</span>      <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">trho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-973"></a>
<a name="ln-974"></a>            <span class="n">Ni_inv_h</span>    <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1._R8</span> <span class="o">/</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)))</span>
<a name="ln-975"></a>            <span class="n">Ni_inv_mu</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1._R8</span> <span class="o">/</span> <span class="n">tmu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)))</span>
<a name="ln-976"></a>
<a name="ln-977"></a>            <span class="n">Ni_drhodp</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">vni4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">)</span> <span class="o">*</span> <span class="n">tdrdp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nne</span><span class="p">))</span>
<a name="ln-978"></a>
<a name="ln-979"></a>
<a name="ln-980"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span>
<a name="ln-981"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="n">Ni_h3</span> <span class="o">*</span> <span class="n">Ni_rho</span> <span class="o">*</span> <span class="n">Ni_inv_mu</span>
<a name="ln-982"></a>
<a name="ln-983"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="mi">6</span><span class="o">*</span><span class="n">Ni_vx</span> <span class="o">*</span> <span class="n">Ni_h</span>
<a name="ln-984"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="mi">6</span><span class="o">*</span><span class="n">Ni_vy</span> <span class="o">*</span> <span class="n">Ni_h</span>
<a name="ln-985"></a>
<a name="ln-986"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-987"></a>
<a name="ln-988"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="n">Ni_h3</span> <span class="o">*</span> <span class="n">Ni_inv_mu</span> <span class="o">*</span> <span class="n">Ni_rho</span> <span class="o">*</span> <span class="n">dNidx_p</span>
<a name="ln-989"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="n">Ni_h3</span> <span class="o">*</span> <span class="n">Ni_inv_mu</span> <span class="o">*</span> <span class="n">Ni_rho</span> <span class="o">*</span> <span class="n">dNidy_p</span>
<a name="ln-990"></a>
<a name="ln-991"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="mi">6</span><span class="o">*</span><span class="n">Ni_vx</span> <span class="o">*</span> <span class="n">Nid_rho_h</span>
<a name="ln-992"></a>            <span class="n">vcal</span><span class="p">(</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="mi">6</span><span class="o">*</span><span class="n">Ni_vy</span> <span class="o">*</span> <span class="n">Nid_rho_h</span>
<a name="ln-993"></a>
<a name="ln-994"></a>            <span class="n">vcal</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="n">Ni_h3</span> <span class="o">*</span> <span class="n">Ni_inv_mu</span> <span class="o">*</span> <span class="n">dNidx_p</span>
<a name="ln-995"></a>            <span class="n">vcal</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="n">Ni_h3</span> <span class="o">*</span> <span class="n">Ni_inv_mu</span> <span class="o">*</span> <span class="n">dNidy_p</span>
<a name="ln-996"></a>
<a name="ln-997"></a>            <span class="n">vcal</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="n">Ni_p</span>
<a name="ln-998"></a>
<a name="ln-999"></a>            <span class="n">vcal</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">dNidx_p</span> <span class="o">*</span> <span class="n">Ni_h</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Ni_mu</span> <span class="o">*</span> <span class="n">Ni_vx</span> <span class="o">*</span> <span class="n">Ni_inv_h</span><span class="p">)</span>
<a name="ln-1000"></a>            <span class="n">vcal</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="n">vc1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">dNidy_p</span> <span class="o">*</span> <span class="n">Ni_h</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Ni_mu</span> <span class="o">*</span> <span class="n">Ni_vy</span> <span class="o">*</span> <span class="n">Ni_inv_h</span><span class="p">)</span>
<a name="ln-1001"></a>
<a name="ln-1002"></a>            <span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="n">i</span> <span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">vcal</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">14</span><span class="p">)</span>
<a name="ln-1003"></a>         <span class="n">enddo</span>
<a name="ln-1004"></a>      <span class="n">enddo</span>
<a name="ln-1005"></a>
<a name="ln-1006"></a>      <span class="c">!=============================================</span>
<a name="ln-1007"></a>      <span class="c">!&gt; {!css/button.html!}</span>
<a name="ln-1008"></a>      <span class="c">!=============================================</span>
<a name="ln-1009"></a>   <span class="k">return</span>
<a name="ln-1010"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">compute_prc_tables_reynolds_supg</span>
<a name="ln-1011"></a>
<a name="ln-1012"></a>
<a name="ln-1013"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1014"></a>   <span class="c">!&gt; @note Subroutine to calculate the characteristic length of an element, giving</span>
<a name="ln-1015"></a>   <span class="c">!        \(x\) and \(y\) velocities</span>
<a name="ln-1016"></a>   <span class="c">!  @endnote</span>
<a name="ln-1017"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1018"></a>   <span class="k">subroutine </span><span class="n">length_width_elem</span><span class="p">(</span><span class="n">spdx</span><span class="p">,</span> <span class="n">spdy</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<a name="ln-1019"></a>   <span class="k">implicit none</span>
<a name="ln-1020"></a><span class="k">   </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="p">)</span>               <span class="kd">::</span> <span class="n">spdx</span>   <span class="c">!! *fluid velocity along \(x\) axis*</span>
<a name="ln-1021"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="p">)</span>               <span class="kd">::</span> <span class="n">spdy</span>   <span class="c">!! *fluid velocity along \(y\) axis*</span>
<a name="ln-1022"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>      <span class="c">!! *corner abscissae*</span>
<a name="ln-1023"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y</span>      <span class="c">!! *corner ordinates*</span>
<a name="ln-1024"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">length</span> <span class="c">!! *fluid element length*</span>
<a name="ln-1025"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">width</span>  <span class="c">!! *fluid element width*</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">abx</span><span class="p">,</span> <span class="n">adx</span><span class="p">,</span> <span class="n">cbx</span><span class="p">,</span> <span class="n">cdx</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-1028"></a>                        <span class="n">aby</span><span class="p">,</span> <span class="n">ady</span><span class="p">,</span> <span class="n">cby</span><span class="p">,</span> <span class="n">cdy</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-1029"></a>                        <span class="n">acx</span><span class="p">,</span> <span class="n">bdx</span><span class="p">,</span> <span class="n">acy</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-1030"></a>                        <span class="n">el_S</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pm</span><span class="p">,</span> <span class="n">spd</span><span class="p">,</span>            <span class="p">&amp;</span>
<a name="ln-1031"></a>                        <span class="n">ac_dot_p</span><span class="p">,</span> <span class="n">bd_dot_p</span><span class="p">,</span> <span class="n">ab_dot_p</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-1032"></a>                        <span class="n">ad_dot_p</span><span class="p">,</span> <span class="n">cb_dot_p</span><span class="p">,</span> <span class="n">cd_dot_p</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-1033"></a>                        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y4</span>
<a name="ln-1034"></a>
<a name="ln-1035"></a>      <span class="n">length</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1036"></a>      <span class="n">width</span>  <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1037"></a>
<a name="ln-1038"></a>      <span class="n">spd</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">spdx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">spdy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1039"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">spd</span> <span class="o">&gt;</span> <span class="n">EPS_R8</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1040"></a>
<a name="ln-1041"></a><span class="k">         </span><span class="n">px</span> <span class="o">=</span> <span class="o">-</span><span class="n">spdy</span>  <span class="c">! direction perpendicular to vector v</span>
<a name="ln-1042"></a>         <span class="n">py</span> <span class="o">=</span> <span class="o">+</span><span class="n">spdx</span>
<a name="ln-1043"></a>         <span class="n">pm</span> <span class="o">=</span>  <span class="n">spd</span>
<a name="ln-1044"></a>
<a name="ln-1045"></a>         <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">;</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1046"></a>         <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">;</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1047"></a>         <span class="n">x3</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">;</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1048"></a>         <span class="n">x4</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">;</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1049"></a>
<a name="ln-1050"></a>         <span class="n">acx</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">-</span><span class="n">x1</span> <span class="p">;</span> <span class="n">acy</span> <span class="o">=</span> <span class="n">y3</span> <span class="o">-</span><span class="n">y1</span>
<a name="ln-1051"></a>         <span class="n">bdx</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">-</span><span class="n">x2</span> <span class="p">;</span> <span class="n">bdy</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span><span class="n">y2</span>
<a name="ln-1052"></a>         <span class="n">abx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span><span class="n">x1</span> <span class="p">;</span> <span class="n">aby</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span><span class="n">y1</span>
<a name="ln-1053"></a>         <span class="n">adx</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">-</span><span class="n">x1</span> <span class="p">;</span> <span class="n">ady</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span><span class="n">y1</span>
<a name="ln-1054"></a>         <span class="n">cbx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span><span class="n">x3</span> <span class="p">;</span> <span class="n">cby</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span><span class="n">y3</span>
<a name="ln-1055"></a>         <span class="n">cdx</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">-</span><span class="n">x3</span> <span class="p">;</span> <span class="n">cdy</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span><span class="n">y3</span>
<a name="ln-1056"></a>
<a name="ln-1057"></a>         <span class="n">ac_dot_p</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">px</span><span class="o">*</span><span class="n">acx</span> <span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">acy</span> <span class="p">)</span>
<a name="ln-1058"></a>         <span class="n">bd_dot_p</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">px</span><span class="o">*</span><span class="n">bdx</span> <span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">bdy</span> <span class="p">)</span>
<a name="ln-1059"></a>         <span class="n">ab_dot_p</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">px</span><span class="o">*</span><span class="n">abx</span> <span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">aby</span> <span class="p">)</span>
<a name="ln-1060"></a>         <span class="n">ad_dot_p</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">px</span><span class="o">*</span><span class="n">adx</span> <span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">ady</span> <span class="p">)</span>
<a name="ln-1061"></a>         <span class="n">cb_dot_p</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">px</span><span class="o">*</span><span class="n">cbx</span> <span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">cby</span> <span class="p">)</span>
<a name="ln-1062"></a>         <span class="n">cd_dot_p</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">px</span><span class="o">*</span><span class="n">cdx</span> <span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">cdy</span> <span class="p">)</span>
<a name="ln-1063"></a>
<a name="ln-1064"></a>         <span class="c">! quadrangle projection on the perpendicular to v</span>
<a name="ln-1065"></a>         <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ac_dot_p</span><span class="p">,</span> <span class="n">bd_dot_p</span><span class="p">,</span> <span class="n">ab_dot_p</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1066"></a>                     <span class="n">ad_dot_p</span><span class="p">,</span> <span class="n">cb_dot_p</span><span class="p">,</span> <span class="n">cd_dot_p</span><span class="p">)</span><span class="o">/</span><span class="n">pm</span>
<a name="ln-1067"></a>
<a name="ln-1068"></a>         <span class="c">! quadrangle area</span>
<a name="ln-1069"></a>         <span class="n">el_S</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cbx</span><span class="o">*</span><span class="n">cdy</span> <span class="o">-</span><span class="n">cdx</span><span class="o">*</span><span class="n">cby</span><span class="p">)</span> <span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">abx</span><span class="o">*</span><span class="n">ady</span> <span class="o">-</span><span class="n">adx</span><span class="o">*</span><span class="n">aby</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1070"></a>
<a name="ln-1071"></a>         <span class="c">! element length</span>
<a name="ln-1072"></a>         <span class="n">length</span> <span class="o">=</span> <span class="n">el_S</span><span class="o">/</span><span class="n">width</span>
<a name="ln-1073"></a>
<a name="ln-1074"></a>      <span class="n">endif</span>
<a name="ln-1075"></a>   <span class="k">return</span>
<a name="ln-1076"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">length_width_elem</span>
<a name="ln-1077"></a>
<a name="ln-1078"></a>
<a name="ln-1079"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1080"></a>   <span class="c">!&lt; @note Subroutine to calculate the fluxes at the corner of the domain</span>
<a name="ln-1081"></a>   <span class="c">!&lt;</span>
<a name="ln-1082"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1083"></a>   <span class="k">subroutine </span><span class="n">compute_corner_fluxes</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">bf</span><span class="p">)</span>
<a name="ln-1084"></a>   <span class="k">implicit none</span>
<a name="ln-1085"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">fe_f</span>      <span class="c">!! *FE film*</span>
<a name="ln-1086"></a>   <span class="k">type</span><span class="p">(</span><span class="n">MAT_SOLV</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">mat</span>       <span class="c">!! *solver type matrices*</span>
<a name="ln-1087"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span>  <span class="k">intent</span><span class="p">(</span><span class="n">out</span>  <span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MAX_NNC</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bf</span>        <span class="c">!! *table of fluxes at the corner*</span>
<a name="ln-1088"></a>
<a name="ln-1089"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ind2</span><span class="p">,</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span>
<a name="ln-1090"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span>
<a name="ln-1091"></a>
<a name="ln-1092"></a>      <span class="c">! calculation of the fluxes on the boundaries by assembly ass_c = no_bc</span>
<a name="ln-1093"></a>      <span class="k">call </span><span class="n">assembly_FE_film_reynolds</span><span class="p">(</span><span class="n">fe_f</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1094"></a>                                      <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1095"></a>                                    <span class="n">ass_c</span> <span class="o">=</span> <span class="n">NO_BC</span><span class="p">)</span>      <span class="c">!</span>
<a name="ln-1096"></a>
<a name="ln-1097"></a>      <span class="c">! projection of the fluxes on the corners</span>
<a name="ln-1098"></a>      <span class="c">! loop on edges</span>
<a name="ln-1099"></a>      <span class="n">bf</span>   <span class="o">=</span> <span class="mf">0.0_R8</span>
<a name="ln-1100"></a>      <span class="n">ind1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1101"></a>      <span class="n">x1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1102"></a>      <span class="n">y1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1103"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ned</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1104"></a>         <span class="n">ind2</span> <span class="o">=</span> <span class="n">ind1</span>
<a name="ln-1105"></a>         <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
<a name="ln-1106"></a>         <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span>
<a name="ln-1107"></a>         <span class="n">ind1</span> <span class="o">=</span> <span class="n">e</span>
<a name="ln-1108"></a>         <span class="n">x1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-1109"></a>         <span class="n">y1</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">cor</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a name="ln-1110"></a>         <span class="c">! length of the edge</span>
<a name="ln-1111"></a>         <span class="n">l</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5_R8</span>
<a name="ln-1112"></a>         <span class="c">! loop on all the nodes - 1 on the edge</span>
<a name="ln-1113"></a>         <span class="c">! without -1, the corner contribution is counted two times</span>
<a name="ln-1114"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1115"></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ed</span><span class="p">(</span><span class="n">e</span><span class="p">)%</span><span class="n">nm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1116"></a>            <span class="c">! distance to point 2</span>
<a name="ln-1117"></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">x</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">y</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5_R8</span>
<a name="ln-1118"></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">l</span>
<a name="ln-1119"></a>            <span class="c">! linear projection along the edge of the local flux</span>
<a name="ln-1120"></a>            <span class="n">bf</span><span class="p">(</span><span class="n">ind1</span><span class="p">)</span> <span class="o">=</span> <span class="n">bf</span><span class="p">(</span><span class="n">ind1</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
<a name="ln-1121"></a>            <span class="n">bf</span><span class="p">(</span><span class="n">ind2</span><span class="p">)</span> <span class="o">=</span> <span class="n">bf</span><span class="p">(</span><span class="n">ind2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1._R8</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">mat</span><span class="p">%</span><span class="n">b</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
<a name="ln-1122"></a>         <span class="n">enddo</span>
<a name="ln-1123"></a>      <span class="n">enddo</span>
<a name="ln-1124"></a>   <span class="k">return</span>
<a name="ln-1125"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">compute_corner_fluxes</span>
<a name="ln-1126"></a>
<a name="ln-1127"></a>
<a name="ln-1128"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1129"></a>   <span class="c">!&lt; @note function to calculate the generated load in a fluid film</span>
<a name="ln-1130"></a>   <span class="c">!&lt; \( \int_\Omega p d\Omega \)</span>
<a name="ln-1131"></a>   <span class="c">!&lt;</span>
<a name="ln-1132"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1133"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">fz</span><span class="p">(</span><span class="n">fe_f</span><span class="p">)</span>
<a name="ln-1134"></a>   <span class="k">implicit none</span>
<a name="ln-1135"></a><span class="k">   class</span><span class="p">(</span><span class="n">FE_film</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span> <span class="c">!! *fluid type*</span>
<a name="ln-1136"></a>
<a name="ln-1137"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-1138"></a>      <span class="n">fz</span> <span class="o">=</span> <span class="mf">0.0_R8</span>
<a name="ln-1139"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-1140"></a>          <span class="k">call </span><span class="n">compute_prc_tables_reynolds_supg</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a name="ln-1141"></a>          <span class="n">fz</span> <span class="o">=</span> <span class="n">fz</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:))</span>
<a name="ln-1142"></a>      <span class="n">enddo</span>
<a name="ln-1143"></a>   <span class="k">return</span>
<a name="ln-1144"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">fz</span>
<a name="ln-1145"></a>
<a name="ln-1146"></a>
<a name="ln-1147"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1148"></a>   <span class="c">!&lt; @note function to calculate the friction force along \(x\) in a fluid film</span>
<a name="ln-1149"></a>   <span class="c">!&lt; \( \int_\Omega \tau_{xz} d\Omega \)</span>
<a name="ln-1150"></a>   <span class="c">!&lt;</span>
<a name="ln-1151"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1152"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">fx</span><span class="p">(</span><span class="n">fe_f</span><span class="p">)</span>
<a name="ln-1153"></a>   <span class="k">implicit none</span>
<a name="ln-1154"></a><span class="k">   class</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span> <span class="c">!! *FE film*</span>
<a name="ln-1155"></a>
<a name="ln-1156"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-1157"></a>      <span class="n">fx</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-1158"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-1159"></a>         <span class="k">call </span><span class="n">compute_prc_tables_reynolds_supg</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a name="ln-1160"></a>         <span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:))</span>
<a name="ln-1161"></a>      <span class="n">enddo</span>
<a name="ln-1162"></a>   <span class="k">return</span>
<a name="ln-1163"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">fx</span>
<a name="ln-1164"></a>
<a name="ln-1165"></a>
<a name="ln-1166"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1167"></a>   <span class="c">!&lt; @note function to calculate the friction force along \(y\) in a fluid film</span>
<a name="ln-1168"></a>   <span class="c">!&lt; \( \int_\Omega \tau_{yz} d\Omega \)</span>
<a name="ln-1169"></a>   <span class="c">!&lt;</span>
<a name="ln-1170"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1171"></a>   <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="k">function </span><span class="n">fy</span><span class="p">(</span><span class="n">fe_f</span><span class="p">)</span>
<a name="ln-1172"></a>   <span class="k">implicit none</span>
<a name="ln-1173"></a><span class="k">   class</span><span class="p">(</span><span class="n">FE_film</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span> <span class="c">!! *FE film*</span>
<a name="ln-1174"></a>
<a name="ln-1175"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>
<a name="ln-1176"></a>      <span class="n">fy</span> <span class="o">=</span> <span class="mf">0._R8</span>
<a name="ln-1177"></a>      <span class="k">do </span><span class="n">e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ne</span>
<a name="ln-1178"></a>         <span class="k">call </span><span class="n">compute_prc_tables_reynolds_supg</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a name="ln-1179"></a>         <span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">prc</span><span class="p">%</span><span class="n">vcal</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:))</span>
<a name="ln-1180"></a>      <span class="n">enddo</span>
<a name="ln-1181"></a>   <span class="k">return</span>
<a name="ln-1182"></a><span class="k">   </span><span class="n">endfunction</span> <span class="n">fy</span>
<a name="ln-1183"></a>
<a name="ln-1184"></a>
<a name="ln-1185"></a>   <span class="c">!=========================================================================================</span>
<a name="ln-1186"></a>   <span class="c">!&gt; @note Subroutine to save a [[FE_FILM]] in a ```.sur``` file</span>
<a name="ln-1187"></a>   <span class="c">!  @endnote</span>
<a name="ln-1188"></a>   <span class="c">!-----------------------------------------------------------------------------------------</span>
<a name="ln-1189"></a>   <span class="k">subroutine </span><span class="n">save_fe_field</span><span class="p">(</span><span class="n">fe_f</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">nodal</span><span class="p">)</span>
<a name="ln-1190"></a>   <span class="k">implicit none</span>
<a name="ln-1191"></a><span class="k">   type</span><span class="p">(</span><span class="n">FE_FILM</span><span class="p">),</span>    <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fe_f</span>
<a name="ln-1192"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">file_name</span>
<a name="ln-1193"></a>   <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">code</span>
<a name="ln-1194"></a>   <span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nodal</span> <span class="c">!! if false : cell value, if true : nodal value</span>
<a name="ln-1195"></a>
<a name="ln-1196"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
<a name="ln-1197"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-1198"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">tab_s</span>
<a name="ln-1199"></a>      <span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span>
<a name="ln-1200"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_z</span>
<a name="ln-1201"></a>
<a name="ln-1202"></a>      <span class="n">nx</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">nx</span>
<a name="ln-1203"></a>      <span class="n">ny</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ny</span>
<a name="ln-1204"></a>      <span class="n">lx</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">lx</span>
<a name="ln-1205"></a>      <span class="n">ly</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">m</span><span class="p">%</span><span class="n">ly</span>
<a name="ln-1206"></a>
<a name="ln-1207"></a>      <span class="k">call </span><span class="n">empty</span><span class="p">(</span><span class="n">unit_z</span><span class="p">)</span>
<a name="ln-1208"></a>
<a name="ln-1209"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1210"></a><span class="k">         </span><span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1211"></a>         <span class="n">ny</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1212"></a>      <span class="n">endif</span>
<a name="ln-1213"></a>
<a name="ln-1214"></a>      <span class="k">allocate</span><span class="p">(</span> <span class="n">tab_s</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="p">)</span> <span class="p">)</span> <span class="p">;</span> <span class="n">tab_s</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<a name="ln-1215"></a>
<a name="ln-1216"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nodal</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1217"></a><span class="k">         </span><span class="n">tab_s</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn</span><span class="p">(:,</span> <span class="n">code</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1218"></a>         <span class="n">i1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-1219"></a>         <span class="n">i2</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1220"></a>         <span class="n">unit_z</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vn_name</span><span class="p">(</span><span class="n">code</span><span class="p">)(</span><span class="n">i1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">i2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1221"></a>      <span class="k">else</span>
<a name="ln-1222"></a><span class="k">         </span><span class="n">tab_s</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vc</span><span class="p">(:,</span> <span class="n">code</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1223"></a>         <span class="n">i1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-1224"></a>         <span class="n">i2</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1225"></a>         <span class="n">unit_z</span> <span class="o">=</span> <span class="n">fe_f</span><span class="p">%</span><span class="n">vc_name</span><span class="p">(</span><span class="n">code</span><span class="p">)(</span><span class="n">i1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">i2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1226"></a>      <span class="n">endif</span>
<a name="ln-1227"></a>
<a name="ln-1228"></a>      <span class="k">call </span><span class="n">init_scal</span><span class="p">(</span><span class="n">scal</span> <span class="o">=</span> <span class="n">scal_tmp</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1229"></a>                       <span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1230"></a>                       <span class="n">ny</span> <span class="o">=</span> <span class="n">ny</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1231"></a>                       <span class="n">lx</span> <span class="o">=</span> <span class="n">lx</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">! default unit : m</span>
<a name="ln-1232"></a>                       <span class="n">ly</span> <span class="o">=</span> <span class="n">ly</span><span class="p">,</span>       <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1233"></a>                   <span class="n">unit_z</span> <span class="o">=</span> <span class="n">unit_z</span>    <span class="p">)</span> <span class="c">!</span>
<a name="ln-1234"></a>
<a name="ln-1235"></a>      <span class="k">call </span><span class="n">write_surf</span><span class="p">(</span><span class="n">nom_fic</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span>  <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1236"></a>                        <span class="n">tab_s</span> <span class="o">=</span> <span class="n">tab_s</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">!</span>
<a name="ln-1237"></a>                         <span class="n">scal</span> <span class="o">=</span> <span class="n">scal_tmp</span>    <span class="p">)</span>
<a name="ln-1238"></a>
<a name="ln-1239"></a>      <span class="k">deallocate</span><span class="p">(</span><span class="n">tab_s</span><span class="p">)</span>
<a name="ln-1240"></a>   <span class="k">return</span>
<a name="ln-1241"></a><span class="k">   </span><span class="n">endsubroutine</span> <span class="n">save_fe_field</span>
<a name="ln-1242"></a>
<a name="ln-1243"></a><span class="n">endmodule</span> <span class="n">film</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-04-03 16:35  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> MUSST was developed by Noël Brunetière - Arthur Francisco</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>